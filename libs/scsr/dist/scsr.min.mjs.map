{"version":3,"file":"scsr.min.mjs","sources":["../scsr.mjs","../../router/init-router.mjs"],"sourcesContent":["import initRouter from \"../router/init-router.mjs\";\n\n(() => {\n  async function ready() {\n    const app = $(\"o-app\");\n    $(\"o-app template[page]\").remove();\n\n    app.push(`<o-page src=\"${location.pathname}\"></o-page>`);\n\n    initRouter(app, (pathname, search) => {\n      return `${pathname}${search}`;\n    });\n  }\n\n  if (document.readyState === \"complete\") {\n    ready();\n  } else {\n    $(window).one(\"load\", () => {\n      ready();\n    });\n  }\n})();\n","export default function initRouter(app, getStateUrl) {\n  if (history.state && history.state.routerMode) {\n    app.routers = history.state.routers;\n  }\n\n  let _isFixState = 0;\n  let _isGoto;\n  let _isBack;\n\n  app.on(\"router-change\", (e) => {\n    let methodName = \"pushState\";\n    switch (e.name) {\n      case \"replace\":\n        methodName = \"replaceState\";\n      case \"goto\":\n        const { routers } = app;\n        const { pathname, search } = new URL(e.src, location.href);\n\n        if (_isGoto) {\n          _isGoto = null;\n          return;\n        }\n\n        const hUrl = getStateUrl\n          ? getStateUrl(pathname, search, methodName)\n          : `#${pathname}${search}`;\n\n        history[methodName](\n          {\n            routerMode: 1,\n            routers,\n          },\n          \"\",\n          hUrl\n        );\n        break;\n      case \"back\":\n        if (_isBack) {\n          _isBack = null;\n          return;\n        }\n\n        _isFixState = 1;\n        history.go(-e.delta);\n\n        console.log(\"back => \", e);\n        break;\n    }\n  });\n\n  let popstateFunc;\n  window.addEventListener(\n    \"popstate\",\n    (popstateFunc = (e) => {\n      const { state } = e;\n\n      if (_isFixState) {\n        _isFixState = 0;\n        return;\n      }\n\n      if (!state) {\n        _isBack = 1;\n        app.back(app.routers.length - 1);\n        return;\n      }\n\n      const { routers: hisRouters } = state;\n      const { routers: appRouters } = app;\n\n      if (hisRouters.length < appRouters.length) {\n        // history back\n        _isBack = 1;\n        app.back(appRouters.length - hisRouters.length);\n      } else if (hisRouters.length > appRouters.length) {\n        // history forward\n        const moreRouters = hisRouters.slice();\n\n        const target = moreRouters.pop();\n\n        if (moreRouters.length > appRouters.length) {\n          const canPushRouters = moreRouters.slice(app._history.length);\n          app._history.push(...canPushRouters);\n        }\n\n        _isGoto = 1;\n\n        app.goto(target.src);\n      } else {\n        console.error(`o-router error occurred`);\n      }\n    })\n  );\n\n  return popstateFunc;\n}\n"],"names":["async","ready","app","$","remove","push","location","pathname","getStateUrl","history","state","routerMode","routers","_isGoto","_isBack","popstateFunc","_isFixState","on","e","methodName","name","search","URL","src","href","hUrl","go","delta","console","log","window","addEventListener","back","length","hisRouters","appRouters","moreRouters","slice","target","pop","canPushRouters","_history","goto","error","initRouter","document","readyState","one"],"mappings":";AAEA,MACEA,eAAeC,IACb,MAAMC,EAAMC,EAAE,SACdA,EAAE,wBAAwBC,SAE1BF,EAAIG,KAAK,gBAAgBC,SAASC,uBCPvB,SAAoBL,EAAKM,GAClCC,QAAQC,OAASD,QAAQC,MAAMC,aACjCT,EAAIU,QAAUH,QAAQC,MAAME,SAG9B,IACIC,EACAC,EA2CAC,EA7CAC,EAAc,EAIlBd,EAAIe,GAAG,iBAAkBC,IACvB,IAAIC,EAAa,YACjB,OAAQD,EAAEE,MACR,IAAK,UACHD,EAAa,eACf,IAAK,OACH,MAAMP,QAAEA,GAAYV,GACdK,SAAEA,EAAQc,OAAEA,GAAW,IAAIC,IAAIJ,EAAEK,IAAKjB,SAASkB,MAErD,GAAIX,EAEF,YADAA,EAAU,MAIZ,MAAMY,EAAOjB,EACTA,EAAYD,EAAUc,EAAQF,GAC9B,IAAIZ,IAAWc,IAEnBZ,QAAQU,GACN,CACER,WAAY,EACZC,WAEF,GACAa,GAEF,MACF,IAAK,OACH,GAAIX,EAEF,YADAA,EAAU,MAIZE,EAAc,EACdP,QAAQiB,IAAIR,EAAES,OAEdC,QAAQC,IAAI,WAAYX,GAE3B,IAIHY,OAAOC,iBACL,WACChB,EAAgBG,IACf,MAAMR,MAAEA,GAAUQ,EAElB,GAAIF,EAEF,YADAA,EAAc,GAIhB,IAAKN,EAGH,OAFAI,EAAU,OACVZ,EAAI8B,KAAK9B,EAAIU,QAAQqB,OAAS,GAIhC,MAAQrB,QAASsB,GAAexB,GACxBE,QAASuB,GAAejC,EAEhC,GAAIgC,EAAWD,OAASE,EAAWF,OAEjCnB,EAAU,EACVZ,EAAI8B,KAAKG,EAAWF,OAASC,EAAWD,aACnC,GAAIC,EAAWD,OAASE,EAAWF,OAAQ,CAEhD,MAAMG,EAAcF,EAAWG,QAEzBC,EAASF,EAAYG,MAE3B,GAAIH,EAAYH,OAASE,EAAWF,OAAQ,CAC1C,MAAMO,EAAiBJ,EAAYC,MAAMnC,EAAIuC,SAASR,QACtD/B,EAAIuC,SAASpC,QAAQmC,EACtB,CAED3B,EAAU,EAEVX,EAAIwC,KAAKJ,EAAOf,IACxB,MACQK,QAAQe,MAAM,0BACf,EAKP,CDtFIC,CAAW1C,GAAK,CAACK,EAAUc,IAClB,GAAGd,IAAWc,KAExB,CAE2B,aAAxBwB,SAASC,WACX7C,IAEAE,EAAE2B,QAAQiB,IAAI,QAAQ,KACpB9C,GAAO,GAGZ,EAnBD"}