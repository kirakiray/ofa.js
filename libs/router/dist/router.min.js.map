{"version":3,"file":"router.min.js","sources":["../../../packages/stanz/public.mjs","../router.mjs"],"sourcesContent":["export const getRandomId = () => Math.random().toString(32).slice(2);\n\nconst objectToString = Object.prototype.toString;\nexport const getType = (value) =>\n  objectToString\n    .call(value)\n    .toLowerCase()\n    .replace(/(\\[object )|(])/g, \"\");\n\nexport const isObject = (obj) => {\n  const type = getType(obj);\n  return type === \"array\" || type === \"object\";\n};\n\nconst tickSets = new Set();\nexport function nextTick(callback) {\n  const tickId = `t-${getRandomId()}`;\n  tickSets.add(tickId);\n  Promise.resolve().then(() => {\n    if (tickSets.has(tickId)) {\n      callback();\n      tickSets.delete(tickId);\n    }\n  });\n  return tickId;\n}\nexport const clearTick = (id) => tickSets.delete(id);\n\nexport function debounce(func, wait = 0) {\n  let timeout = null;\n  let hisArgs = [];\n\n  return function (...args) {\n    hisArgs.push(...args);\n\n    if (wait > 0) {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        func.call(this, hisArgs);\n        hisArgs = [];\n        timeout = null;\n      }, wait);\n    } else {\n      if (timeout === null) {\n        timeout = 1;\n        nextTick(() => {\n          func.call(this, hisArgs);\n          hisArgs = [];\n          timeout = null;\n        });\n      }\n    }\n  };\n}\n\n// Enhanced methods for extending objects\nexport const extend = (_this, proto, descriptor = {}) => {\n  [\n    ...Object.getOwnPropertyNames(proto),\n    ...Object.getOwnPropertySymbols(proto),\n  ].forEach((k) => {\n    const result = Object.getOwnPropertyDescriptor(proto, k);\n    const { configurable, enumerable, writable, get, set, value } = result;\n\n    if (\"value\" in result) {\n      if (_this.hasOwnProperty(k)) {\n        _this[k] = value;\n      } else {\n        Object.defineProperty(_this, k, {\n          enumerable,\n          configurable,\n          writable,\n          ...descriptor,\n          value,\n        });\n      }\n    } else {\n      Object.defineProperty(_this, k, {\n        enumerable,\n        configurable,\n        ...descriptor,\n        get,\n        set,\n      });\n    }\n  });\n\n  return _this;\n};\n","import { getRandomId } from \"../../packages/stanz/public.mjs\";\n\nconst FIXBODY = `f-${getRandomId()}`;\n\n$.register({\n  tag: \"o-router\",\n  temp: `<style>:host{display:block;width:100%;height:100%;overflow:hidden}::slotted(o-app){display:block;width:100%;height:100%}</style><slot></slot>`,\n  attrs: {\n    fixBody: null,\n  },\n  watch: {\n    fixBody(val) {\n      if (val !== null) {\n        const styleEle = document.createElement(\"style\");\n        styleEle.setAttribute(FIXBODY, \"\");\n        styleEle.innerHTML = `html,body{margin:0;padding:0;width:100%;height:100%;}`;\n        document.head.append(styleEle);\n      } else {\n        const target = document.head.querySelector(FIXBODY);\n        if (target) {\n          target.remove();\n        }\n      }\n    },\n  },\n  attached() {\n    const app = this.$(\"o-app\");\n\n    if (history.state && history.state.routerMode) {\n      app.routers = history.state.routers;\n    }\n\n    this.on(\"router-change\", (e) => {\n      switch (e.name) {\n        case \"goto\":\n          const { routers } = app;\n          const { pathname, search } = new URL(e.src);\n\n          if (this._isGoto) {\n            delete this._isGoto;\n            return;\n          }\n\n          history.pushState(\n            {\n              routerMode: 1,\n              routers,\n            },\n            \"\",\n            `#${pathname}${search}`\n          );\n          break;\n        case \"back\":\n          console.log(\"back => \", e);\n          break;\n      }\n      // console.log(\n      //   \"rchange  => \",\n      //   e.name,\n      //   JSON.parse(JSON.stringify(app.routers))\n      // );\n    });\n\n    let popstateFunc;\n    window.addEventListener(\n      \"popstate\",\n      (popstateFunc = (e) => {\n        console.log(\"popstate => \", e);\n\n        const { state } = e;\n\n        if (!state) {\n          app.back(app.routers.length - 1);\n          return;\n        }\n\n        const { routers: hisRouters } = state;\n        const { routers: appRouters } = app;\n\n        if (hisRouters.length < appRouters.length) {\n          // history back\n          app.back(appRouters.length - hisRouters.length);\n        } else if (hisRouters.length > appRouters.length) {\n          // history forward\n          const moreRouters = hisRouters.slice();\n\n          const target = moreRouters.pop();\n\n          if (moreRouters.length > appRouters.length) {\n            const canPushRouters = moreRouters.slice(app._history.length);\n            app._history.push(...canPushRouters);\n          }\n\n          this._isGoto = 1;\n\n          app.goto(target.src);\n        } else {\n          debugger;\n        }\n      })\n    );\n\n    this._popstateFunc = popstateFunc;\n  },\n  detached() {\n    if (this._popstateFunc) {\n      window.removeEventListener(\"popstate\", this._popstateFunc);\n    }\n  },\n});\n"],"names":["Set","FIXBODY","Math","random","toString","slice","$","register","tag","temp","attrs","fixBody","watch","val","styleEle","document","createElement","setAttribute","innerHTML","head","append","target","querySelector","remove","attached","app","this","popstateFunc","history","state","routerMode","routers","on","e","name","pathname","search","URL","src","_isGoto","pushState","console","log","window","addEventListener","back","length","hisRouters","appRouters","moreRouters","pop","canPushRouters","_history","push","goto","_popstateFunc","detached","removeEventListener"],"mappings":";2FAciB,IAAIA,ICZrB,MAAMC,EAAU,KDFiBC,KAAKC,SAASC,SAAS,IAAIC,MAAM,KCIlEC,EAAEC,SAAS,CACTC,IAAK,WACLC,KAAM,gJACNC,MAAO,CACLC,QAAS,MAEXC,MAAO,CACLD,QAAQE,GACN,GAAY,OAARA,EAAc,CAChB,MAAMC,EAAWC,SAASC,cAAc,SACxCF,EAASG,aAAahB,EAAS,IAC/Ba,EAASI,UAAY,wDACrBH,SAASI,KAAKC,OAAON,EAC7B,KAAa,CACL,MAAMO,EAASN,SAASI,KAAKG,cAAcrB,GACvCoB,GACFA,EAAOE,QAEV,CACF,GAEHC,WACE,MAAMC,EAAMC,KAAKpB,EAAE,SAqCnB,IAAIqB,EAnCAC,QAAQC,OAASD,QAAQC,MAAMC,aACjCL,EAAIM,QAAUH,QAAQC,MAAME,SAG9BL,KAAKM,GAAG,iBAAkBC,IACxB,OAAQA,EAAEC,MACR,IAAK,OACH,MAAMH,QAAEA,GAAYN,GACdU,SAAEA,EAAQC,OAAEA,GAAW,IAAIC,IAAIJ,EAAEK,KAEvC,GAAIZ,KAAKa,QAEP,mBADOb,KAAKa,QAIdX,QAAQY,UACN,CACEV,WAAY,EACZC,WAEF,GACA,IAAII,IAAWC,KAEjB,MACF,IAAK,OACHK,QAAQC,IAAI,WAAYT,GAE3B,IASHU,OAAOC,iBACL,WACCjB,EAAgBM,IACfQ,QAAQC,IAAI,eAAgBT,GAE5B,MAAMJ,MAAEA,GAAUI,EAElB,IAAKJ,EAEH,YADAJ,EAAIoB,KAAKpB,EAAIM,QAAQe,OAAS,GAIhC,MAAQf,QAASgB,GAAelB,GACxBE,QAASiB,GAAevB,EAEhC,GAAIsB,EAAWD,OAASE,EAAWF,OAEjCrB,EAAIoB,KAAKG,EAAWF,OAASC,EAAWD,aACnC,GAAIC,EAAWD,OAASE,EAAWF,OAAQ,CAEhD,MAAMG,EAAcF,EAAW1C,QAEzBgB,EAAS4B,EAAYC,MAE3B,GAAID,EAAYH,OAASE,EAAWF,OAAQ,CAC1C,MAAMK,EAAiBF,EAAY5C,MAAMoB,EAAI2B,SAASN,QACtDrB,EAAI2B,SAASC,QAAQF,EACtB,CAEDzB,KAAKa,QAAU,EAEfd,EAAI6B,KAAKjC,EAAOiB,IAC1B,CAES,GAILZ,KAAK6B,cAAgB5B,CACtB,EACD6B,WACM9B,KAAK6B,eACPZ,OAAOc,oBAAoB,WAAY/B,KAAK6B,cAE/C"}