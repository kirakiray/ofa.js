//! ofa.js - v4.1.3 https://github.com/kirakiray/ofa.js  (c) 2018-2023 YAO
const e=()=>Math.random().toString(32).slice(2),t=Object.prototype.toString,r=e=>t.call(e).toLowerCase().replace(/(\[object )|(])/g,""),n=e=>{const t=r(e);return"array"===t||"object"===t},s=new Set;function a(t){const r=`t-${e()}`;return s.add(r),Promise.resolve().then((()=>{s.has(r)&&(t(),s.delete(r))})),r}const i=(e,t,r={})=>([...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)].forEach((n=>{const s=Object.getOwnPropertyDescriptor(t,n),{configurable:a,enumerable:i,writable:o,get:c,set:l,value:h}=s;"value"in s?e.hasOwnProperty(n)?e[n]=h:Object.defineProperty(e,n,{enumerable:i,configurable:a,writable:o,...r,value:h}):Object.defineProperty(e,n,{enumerable:i,configurable:a,...r,get:c,set:l})})),e),o=e=>r(e).includes("function"),c=e=>e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));const l=e=>e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),h=(e,t)=>{const r=document.createElement("template");return r.content.append(e.cloneNode()),!!r.content.querySelector(t)};function u(e,t,r){const n=e.indexOf(t);if(-1===n)throw new Error("Value not found in array");return e.splice(r,0,e.splice(n,1)[0]),e}const d=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},p=(e,t)=>e instanceof HTMLTemplateElement?Array.from(e.content.querySelectorAll(t)):Array.from(e.querySelectorAll(t)),{assign:f,freeze:m}=Object;class g{constructor(e){f(this,e),m(this)}hasModified(e){if("array"===this.type)return this.path.includes(this.currentTarget.get(e));const t=e.split(".");if(this.currentTarget===this.target&&this.name===t[0])return!0;const r=_(this,t).indexOf(this.target);if(r>-1){const e=t.slice(r+1);return!e.length||this.name===e[0]}return this.path.includes(this.currentTarget[e])}hasReplaced(e){if("set"!==this.type)return!1;const t=e.split(".");if(this.target===this.currentTarget&&this.name===t[0])return!0;const r=_(this,t).indexOf(this.target);if(r>-1){return t.slice(r+1)[0]===this.name}return!1}}const _=(e,t)=>{const r=[],n=t.slice();let s=e.currentTarget;for(;n.length;){const e=n.shift();s&&(s=s[e]),r.push(s)}return r};class y extends Array{constructor(e){super(...e)}hasModified(e){return this.some((t=>t.hasModified(e)))}hasReplaced(e){return this.some((t=>t.hasReplaced(e)))}}const w=({type:e,currentTarget:t,target:r,name:n,value:s,oldValue:a,args:i,path:o=[]})=>{if(o&&o.includes(t))return void console.warn("Circular references appear");let c={type:e,target:r,name:n,oldValue:a,value:s};if("array"===e&&(delete c.value,c.args=i),t._hasWatchs){const e=new g({currentTarget:t,...c,path:[...o]});t[L].forEach((t=>{t(e)}))}t._update&&t.owner.forEach((e=>{w({currentTarget:e,...c,path:[t,...o]})}))};var b={watch(t){const r="w-"+e();return this[L].set(r,t),r},unwatch(e){return this[L].delete(e)},watchTick(e,t){return this.watch(function(e,t=0){let r=null,n=[];return function(...s){n.push(...s),t>0?(clearTimeout(r),r=setTimeout((()=>{e.call(this,n),n=[],r=null}),t)):null===r&&(r=1,a((()=>{e.call(this,n),n=[],r=null})))}}((t=>{try{this.xid}catch(e){return}t=t.filter((e=>{try{e.path.forEach((e=>e.xid))}catch(e){return!1}return!0})),e(new y(t))}),t||0))}};const v=Symbol("placeholder");const x={},E=Array.prototype;["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"].forEach((e=>{E[e]&&(x[e]=function(...t){const r=Array.from(this),s=E[e].apply(this[A],t),{deletedItems:a,addedItems:i}=function(e,t){const r=Array.from(t),n=Array.from(e),s=[],a=new Map,i=e.length;for(let t=0;t<i;t++){const n=e[t],a=r.indexOf(n);a>-1?r[a]=v:s.push(n)}const o=t.length;for(let e=0;e<o;e++){const r=t[e],s=n.indexOf(r);s>-1?n[s]=v:a.set(e,r)}return{deletedItems:s,addedItems:a}}(r,this);for(let[e,t]of i)M(t)?t._owner.push(this):n(t)&&(this.__unupdate=1,this[e]=t,delete this.__unupdate);for(let e of a)H(e,this);return w({type:"array",currentTarget:this,target:this,args:t,name:e,oldValue:r}),s===this[A]?this[T]:s})}));const{defineProperties:k,getOwnPropertyDescriptor:O,entries:j}=Object,A=Symbol("self"),T=Symbol("proxy"),L=Symbol("watchs"),S=Symbol("isxdata"),M=e=>e&&!!e[S];function P(t,r=D){let n,{proxy:s,revoke:a}=Proxy.revocable(this,r);return s._update=1,k(this,{xid:{value:t.xid||e()},_owner:{value:[]},owner:{configurable:!0,get(){return new Set(this._owner)}},[S]:{value:!0},[A]:{configurable:!0,get:()=>this},[T]:{configurable:!0,get:()=>s},[L]:{get:()=>n||(n=new Map)},_hasWatchs:{get:()=>!!n},_revoke:{value:a}}),Object.keys(t).forEach((e=>{const r=O(t,e);let{value:n,get:a,set:i}=r;a||i?k(this,{[e]:r}):s[e]=n})),s}class R extends Array{constructor(e){return super(),P.call(this,e)}revoke(){const e=this[A];e._onrevokes&&(e._onrevokes.forEach((e=>e())),e._onrevokes.length=0),e.__unupdate=1,e[L].clear(),j(this).forEach((([e,t])=>{M(t)&&(this[e]=null)})),e._owner.forEach((e=>{j(e).forEach((([t,r])=>{r===this&&(e[t]=null)}))})),delete e[A],delete e[T],e._revoke()}toJSON(){let e={},t=!0,r=0;Object.keys(this).forEach((n=>{let s=this[n];/\D/.test(n)?t=!1:(n=parseInt(n))>r&&(r=n),M(s)&&(s=s.toJSON()),e[n]=s})),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return k(e,{xid:{get:()=>n}}),e}toString(){return JSON.stringify(this.toJSON())}extend(e,t){return i(this,e,t)}get(e){if(/\./.test(e)){const t=e.split(".");let r=this;for(let e=0,n=t.length;e<n;e++)try{r=r[t[e]]}catch(n){const s=new Error(`Failed to get data : ${t.slice(0,e).join(".")} \n${n.stack}`);throw Object.assign(s,{error:n,target:r}),s}return r}return this[e]}set(e,t){if(/\./.test(e)){const r=e.split("."),n=r.pop();let s=this;for(let e=0,t=r.length;e<t;e++)try{s=s[r[e]]}catch(t){const n=new Error(`Failed to get data : ${r.slice(0,e).join(".")} \n${t.stack}`);throw Object.assign(n,{error:t,target:s}),n}return s[n]=t}return this[e]=t}}R.prototype.extend({...b,...x},{enumerable:!1});const{defineProperties:C}=Object,N=({target:e,key:t,value:r,receiver:s,type:a,succeed:i})=>{let o=r;if(M(o))o._owner.push(s);else if(n(r)){const n=Object.getOwnPropertyDescriptor(e,t);n&&!n.hasOwnProperty("value")||(o=new R(r),o._owner.push(s))}const c=s[t],l=c===r;!l&&M(c)&&H(c,s);const h=i(o);return!l&&!e.__unupdate&&w({type:a||"set",target:s,currentTarget:s,name:t,value:r,oldValue:c}),h},H=(e,t)=>{if(M(e)){const r=e._owner.indexOf(t);r>-1?e._owner.splice(r,1):console.error({desc:"This data is wrong, the owner has no boarding object at the time of deletion",target:t,mismatch:e})}},D={set(e,t,r,n){if("symbol"==typeof t)return Reflect.set(e,t,r,n);if(/^_/.test(t))return e.hasOwnProperty(t)?Reflect.set(e,t,r,n):C(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0;try{return N({target:e,key:t,value:r,receiver:n,succeed:r=>Reflect.set(e,t,r,n)})}catch(e){const s=new Error(`failed to set ${t} \n ${e.stack}`);throw Object.assign(s,{key:t,value:r,target:n,error:e}),s}},deleteProperty:(e,t)=>/^_/.test(t)||"symbol"==typeof t?Reflect.deleteProperty(e,t):N({target:e,key:t,value:void 0,receiver:e[T],type:"delete",succeed:()=>Reflect.deleteProperty(e,t)})},I={set:(e,t,r,n)=>/\D/.test(String(t))?D.set(e,t,r,n):Reflect.set(e,t,r,n),get:(e,t,r)=>/\D/.test(String(t))?Reflect.get(e,t,r):je(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},U={render(){}},W=e=>e.__revokes||(e.__revokes=[]),B=(e,t)=>W(e).push(t),q=(e,t)=>new Function("...$args",`\nconst [$event] = $args;\ntry{\n  with(this){\n    return ${e};\n  }\n}catch(error){\n  if(this.ele.isConnectd){\n    console.error(error);\n  }\n}\n`).bind(t);function F({data:e,target:t,template:r,temps:n,isRenderSelf:s,...a}){const i=r&&r.innerHTML;i&&(t.innerHTML=i);const c=p(t,"xtext"),l=[],u=W(t);c.forEach((t=>{const r=document.createTextNode(""),{parentNode:n}=t;n.insertBefore(r,t),n.removeChild(t);const s=q(t.getAttribute("expr"),e),a=()=>{r.textContent=s()};l.push(a);const i=()=>{d(u,i),d(l,a),d(W(r),i)};u.push(i),B(r,i)}));const f=p(t,"[x-bind-data]");if(s&&h(t,"[x-bind-data]")&&f.unshift(t),f.forEach((t=>{const r=JSON.parse(t.getAttribute("x-bind-data")),s=je(t);for(let[i,c]of Object.entries(r))c.forEach((r=>{try{const{always:c}=s[i],h=()=>{const t=s[i](...r,{isExpr:!0,data:e,temps:n,...a});return U.render({step:"refresh",args:r,name:i,target:s}),t};let p;if(c)l.push(h),p=()=>{d(u,p),d(l,h),d(W(t),p)};else{const e=h();o(e)?p=()=>{d(u,p),d(W(t),p),e()}:console.warn(`${i} render method need return revoke`)}u.push(p),B(t,p)}catch(e){const t=new Error(`Execution of the ${i} method reports an error :\n ${e.stack}`);throw t.error=e,t}}));t.removeAttribute("x-bind-data")})),t.__render_temps||function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)||(t.__render_temps=n),l.length){if(t.__render_data&&t.__render_data!==e){const r=new Error("An old listener already exists and the rendering of this element may be wrong");throw Object.assign(r,{element:t,old:t.__render_data,new:e}),r}t.__render_data=e,l.forEach((e=>e()));const r=e.watchTick((t=>{l.length?l.forEach((e=>e())):e.unwatch(r)}))}U.render({step:"init",target:t})}function J(t){let r={};const{tagName:n}=t;if("TEMPLATE"===n){let n=t.innerHTML;const s=n.match(/{{.+?}}/g);s&&(s.forEach((e=>{n=n.replace(e,`<xtext expr="${e.replace(/{{(.+?)}}/,"$1")}"></xtext>`)})),t.innerHTML=n);const a=t.getAttribute("name");a?(t.content.children.length>1&&console.warn({target:t,content:t.innerHTML,desc:"Only the first child element inside the template will be used"}),r[a]=t,t.remove()):t.content.querySelectorAll("x-fill:not([name])").forEach((t=>{if(t.querySelector("x-fill:not([name])"))throw`Don't fill unnamed x-fills with unnamed x-fill elements!!!\n${t.outerHTML}`;const r=`t${e()}`;t.setAttribute("name",r);const n=document.createElement("template");n.setAttribute("name",r),n.innerHTML=t.innerHTML,t.innerHTML="",t.appendChild(n)})),r={...r,...J(t.content)}}else if(n){const e={};Array.from(t.attributes).forEach((r=>{const n=/(.*):(.+)/.exec(r.name);if(!n)return;let[,s,a]=n;s||(s="prop");(e[s]||(e[s]=[])).push([a,r.value]),t.removeAttribute(r.name)}));Object.keys(e).length&&t.setAttribute("x-bind-data",JSON.stringify(e))}return t.children&&Array.from(t.children).forEach((e=>{r={...r,...J(e)}})),r}const z=e=>o(e)?e():e,V={_convertExpr(e={},t){const{isExpr:r,data:n}=e;return r?q(t,n):t},prop(...e){let[t,r,n]=e;if(1===e.length)return this[t];r=this._convertExpr(n,r),r=z(r),t=c(t),this[t]=r},attr(...e){let[t,r,n]=e;if(1===e.length)return this.ele.getAttribute(t);r=this._convertExpr(n,r),r=z(r),null===r?this.ele.removeAttribute(t):this.ele.setAttribute(t,r)},class(...e){let[t,r,n]=e;if(1===e.length)return this.ele.classList.contains(t);r=this._convertExpr(n,r),r=z(r),r?this.ele.classList.add(t):this.ele.classList.remove(t)}};V.prop.always=!0,V.attr.always=!0,V.class.always=!0;var K={sync(e,t,r){if(!r)throw"Sync is only allowed within the renderer";const{data:n}=r;this[e]=n.get(t);const s=this.watch((r=>{r.hasModified(e)&&n.set(t,this.get(e))})),a=n.watch((r=>{r.hasModified(t)&&this.set(e,n.get(t))}));return()=>{this.unwatch(s),n.unwatch(a)}}},G={on(e,t,r){if(r&&r.isExpr&&!/[^\d\w_\$\.]/.test(t)){const e=t;if(!(t=r.data.get(t)))throw new Error(`${e} method does not exist`)}else t=this._convertExpr(r,t);return r&&r.data&&(t=t.bind(r.data)),this.ele.addEventListener(e,t),r?()=>this.ele.removeEventListener(e,t):this},one(e,t,r){const n=r=>{this.off(e,n),t(r)};return this.on(e,n,r),this},off(e,t){return this.ele.removeEventListener(e,t),this},emit(e,t,r){let n;return e instanceof Event?n=e:e&&(n=new Event(e,{bubbles:!0,...r})),t&&Object.assign(n,t),this.ele.dispatchEvent(n),this}};const Y=(e,t,r,...n)=>{const{children:s}=e,a=[];for(let e=t,n=t+r;e<n;e++){const t=s[e];a.push(t)}if(a.forEach((e=>e.remove())),n.length){const r=document.createDocumentFragment();n.forEach((e=>r.append(Te(e).ele)));const a=s[t];a?e.insertBefore(r,a):e.appendChild(r)}return a},Z=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],Q={push(...e){const{ele:t}=this;return Y(t,t.children.length,0,...e),w({type:"array",currentTarget:this,target:this,args:e,name:"push"}),t.children.length},pop(...e){const{ele:t}=this,r=Y(t,t.children.length-1,1,...e);return w({type:"array",currentTarget:this,target:this,args:e,name:"pop"}),je(r[0])},shift(...e){const{ele:t}=this,r=Y(t,0,1,...e);return w({type:"array",currentTarget:this,target:this,args:e,name:"shift"}),je(r[0])},unshift(...e){const{ele:t}=this;return Y(t,0,0,...e),w({type:"array",currentTarget:this,target:this,args:e,name:"unshift"}),t.children.length},splice(...e){const t=Y(this.ele,...e);return w({type:"array",currentTarget:this,target:this,args:e,name:"splice"}),t.map(je)},reverse(...e){const t=Array.from(this.ele.childNodes);X.reverse.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.__internal=1,r.append(e)})),this.ele.append(r),t.forEach((e=>{delete e.__internal})),w({type:"array",currentTarget:this,target:this,args:e,name:"reverse"}),this},sort(...e){const t=Array.from(this.ele.children).map(je);X.sort.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.ele.__internal=1,r.append(e.ele)})),this.ele.append(r),t.forEach((e=>{delete e.ele.__internal})),w({type:"array",currentTarget:this,target:this,args:e,name:"sort"}),this}},X=Array.prototype;Object.keys(Object.getOwnPropertyDescriptors(X)).forEach((e=>{if("constructor"===e||"length"===e||Z.includes(e))return;const t=X[e];o(t)&&(Q[e]=function(...e){return t.apply(Array.from(this.ele.children).map(je),e)})}));class ee{}for(let[e,t]of Object.entries(Q))Object.defineProperty(ee.prototype,e,{value:t});const te=e=>new R(e);Object.assign(te,{is:M});const{defineProperty:re,assign:ne}=Object,se=(e,t)=>{const{ele:r}=t;e.forEach((e=>{if(e in r){let n=!1;re(t,e,{enumerable:!0,get:()=>n?Number(r[e]):r[e],set:t=>{n="number"==typeof t,r[e]=t}})}}))},ae=new Set(["input","textarea","select","option","button","label","fieldset","legend","form"]),ie=(e,t={})=>{const{name:r,type:n}=t,{ele:s}=e;let a=s[r];e.on(n,(()=>{w({type:"set",target:e,currentTarget:e,name:r,value:s[r],oldValue:a}),a=s[r]}))},oe=e=>{switch(e.attr("type")){case"file":se(["multiple","files"],e),ie(e,{name:"files",type:"change"});break;case"checkbox":se(["checked","multiple"],e),ie(e,{name:"checked",type:"change"});break;case"radio":se(["checked"],e),ie(e,{name:"checked",type:"change"});break;default:se(["placeholder","value"],e),ie(e,{name:"value",type:"input"})}},ce=(e,t)=>{const r={};return e.all(t).forEach((e=>{const{name:t,tag:n,ele:s}=e;if("input"===n)switch(e.type){case"checkbox":t in r||(r[t]=[]),s.checked&&r[t].push(s.value);break;case"radio":s.checked&&(r[t]=s.value);break;case"file":r[t]=s.files;break;default:r[t]=s.value}else if("textarea"===n)r[t]=s.value;else if("select"===n){const e=p(s,"option:checked");if(s.multiple)r[t]=e.map((e=>e.value||e.textContent));else{const[n]=e;r[t]=n.value||n.textContent}}else r[t]=e.value})),r};var le={formData(e,t={wait:200}){const r=te({});return ne(r,ce(this,e||"input,select,textarea")),this.watchTick((t=>{ne(r,ce(this,e||"input,select,textarea"))}),t.wait),r}};const he={set:(e,t,r,n)=>(e._ele.style[t]=r,Reflect.set(e,t,r,n),!0),get(e,t,r){if("length"===t)return 0;const{style:n}=e._ele;return Array.from(n).includes(t)?n[t]:getComputedStyle(e._ele)[t]}};class ue{constructor(e){const t={};Object.defineProperty(t,"_ele",{enumerable:!1,get:()=>e.ele});const{style:r}=e.ele;return Array.from(r).forEach((e=>{t[e]=r[e]})),e._css=new Proxy(t,he)}}var de={get css(){return new ue(this)},set css(e){if("string"==r(e))return void(this.ele.style=e);let{style:t}=this,n=Object.keys(e);Array.from(t).forEach((e=>{n.includes(e)||(t[e]="")})),Object.assign(t,e)}};const pe={},fe=({defaults:e,ele:t,template:r,temps:n})=>{const s={...e.data,...e.attrs},a=je(t);e.proto&&a.extend(e.proto,{enumerable:!1});for(let[e,t]of Object.entries(s))a.hasOwnProperty(e)||(a[e]=t);if(e.temp){const e=t.attachShadow({mode:"open"});e.innerHTML=r.innerHTML,F({target:e,data:a,temps:n})}if(e.ready&&e.ready.call(a),e.watch){const t=Object.entries(e.watch);a.watchTick((e=>{for(let[r,n]of t)e.hasModified(r)&&n.call(a,a[r],{watchers:e})}));for(let[e,r]of t)r.call(a,a[e],{})}},me=(e={})=>{const t={tag:"",temp:"",data:{},proto:{},...e};!function(e){if("-"===e.charAt(0)||"-"===e.charAt(e.length-1))throw new Error(`The string "${e}" cannot start or end with "-"`);for(let t=0;t<e.length-1;t++)if("-"===e.charAt(t)&&"-"===e.charAt(t+1))throw new Error(`The string "${e}" cannot have consecutive "-" characters`);if(!e.includes("-"))throw new Error(`The string "${e}" must contain at least one "-"`)}(t.tag);const r=(n=c(t.tag)).charAt(0).toUpperCase()+n.slice(1);var n;if(pe[r])throw`Component ${r} already exists`;const s=document.createElement("template");s.innerHTML=t.temp;const a=J(s),i=e=>{let t;return t=e instanceof Array?[...e]:Object.keys(e),t},o=pe[r]=class extends HTMLElement{constructor(...e){super(...e);const r=je(this);if(t.created&&t.created.call(r),t.attrs){const e=i(t.attrs);r.watchTick((t=>{e.forEach((e=>{if(t.hasModified(e)){const t=r[e],n=l(e);null==t?this.removeAttribute(n):this.setAttribute(n,t)}}))}))}fe({defaults:t,ele:this,template:s,temps:a})}connectedCallback(){t.attached&&!ge(this)&&t.attached.call(je(this))}disconnectedCallback(){t.detached&&!ge(this)&&t.detached.call(je(this))}attributeChangedCallback(e,t,r){const n=je(this);/[^\d.]/.test(r)||"number"!=typeof n[e]||(r=Number(r)),n[c(e)]=r}static get observedAttributes(){return i(t.attrs||{}).map((e=>l(e)))}};if("loading"!==document.readyState)customElements.define(t.tag,o);else{const e="readystatechange";let r;document.addEventListener(e,r=()=>{customElements.define(t.tag,o),document.removeEventListener(e,r)})}};function ge(e){let t=e;for(;t;){if(t.__internal)return!0;if(t=t.parentNode||t.host,!t||t.tagName&&"BODY"===t.tagName)break}return!1}const _e=Symbol("already-rendered");function ye(e,t=!0){const r=[];let n=t?e.__marked_end:e.__marked_start;for(;;)if(n=t?n.nextSibling:n.previousSibling,n instanceof Comment)n.__$ele&&(r.push(n.__$ele),n=t?n.__end:n.__start);else if(!(n instanceof Text))break;return r}const we={_getRenderData(){let e=this.__marked_end;for(;e&&!e.__render_data;)e=e.parentNode;return e?{target:e,data:e.__render_data,temps:e.__render_temps}:null},_renderMarked(){const{ele:e}=this,{parentNode:t}=e,r=`${this.tag}: ${this.__originHTML.trim().slice(0,20).replace(/\n/g,"")} ...`,n=document.createComment(r+" --start"),s=document.createComment(r+" --end");n.__end=s,s.__start=n,s.__$ele=n.__$ele=this,t.insertBefore(n,e),t.insertBefore(s,e),this.__marked_start=n,this.__marked_end=s,Object.defineProperties(e,{__revokes:{set(e){n.__revokes=e},get:()=>n.__revokes}})},_renderContent(){if(this[_e])return;const e=this._getRenderData();if(!e)return;const{target:t,data:r,temps:n}=e,s=this.__marked_end,a=document.createElement("template");a.innerHTML=this.__originHTML,s.parentNode.insertBefore(a.content,s),F({target:t,data:r,temps:n}),this[_e]=!0},_revokeRender(){const e=this.__marked_start;let t=this.__marked_end.previousSibling;for(;t&&t!==e;){Le(t);const e=t;t=t.previousSibling,e.remove()}this[_e]=!1},_refreshCondition(){const e=[this];if(!this._refreshing){switch(this.tag){case"x-if":e.push(...ye(this));break;case"x-else-if":e.unshift(...ye(this,!1)),e.push(...ye(this))}e.forEach((e=>e._refreshing=!0)),a((()=>{let t=!1;e.forEach((e=>{if(delete e._refreshing,!t)return e.value||"x-else"===e.tag?(e._renderContent(),void(t=!0)):void e._revokeRender();e._revokeRender()}))}))}}},be={tag:"x-if",data:{value:null},watch:{value(){this._refreshCondition()}},proto:we,ready(){this.__originHTML=this.html,this.html="",this._renderMarked(),a((()=>this.ele.remove()))}};me(be),me({...be,tag:"x-else-if"}),me({tag:"x-else",proto:we,ready:be.ready});const ve=(e,t,r,n)=>{const s=Te(t.innerHTML),{ele:a}=s,i=new R({$data:e,$ele:s,$host:n});F({target:a,data:i,temps:r,$host:n,isRenderSelf:!0});const o=a.__revokes,c=()=>{d(o,c),i.revoke()};return o.push(c),{ele:a,itemData:i}};me({tag:"x-fill",data:{value:null},watch:{value(e){const t=this._getChilds();if(!e)return void(t&&t.forEach((e=>{Le(e),e.remove()})));if(!(e instanceof Array))return console.warn(`The value of x-fill component must be of type Array, and the type of the current value is ${r(e)}`),void(t&&t.forEach((e=>{Le(e),e.remove()})));const n=Array.from(e),s=t.map((e=>e.__render_data.$data));if(((e,t)=>{if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0})(s,n))return;const a=this._name,{data:i,temps:o}=this._getRenderData();if(!o)return;const c=o[a],l=this.__marked_end,h=l.parentNode,d=t.slice(),p=i.$host||i;for(let r=0,n=e.length;r<n;r++){const n=e[r],a=t[r];if(!a){const{ele:e}=ve(n,c,o,p);h.insertBefore(e,l);continue}const i=a.__render_data.$data;if(n!==i)if(s.includes(n)){const e=t.find((e=>e.__render_data.$data===n));e.__internal=1,h.insertBefore(e,a),delete e.__internal,u(t,e,r)}else{const{ele:e}=ve(n,c,o,p);h.insertBefore(e,a),t.splice(r,0,e)}}d.forEach(((e,t)=>{const r=s[t];n.includes(r)||(Le(e),e.remove())}))}},proto:{_getRenderData:we._getRenderData,_renderMarked:we._renderMarked,_getChilds(){const e=[],{__marked_end:t,__marked_start:r}=this;if(!r)return[];let n=r;for(;n=n.nextSibling,n&&n!==t;)n instanceof Element&&e.push(n);return e}},ready(){this.__originHTML="origin",this._name=this.attr("name"),this._renderMarked(),a((()=>this.ele.remove()))}});const{defineProperties:xe}=Object,Ee=({_this:e,ele:t,proxySelf:r})=>{const n={owner:{get(){const{parentNode:r}=t,{_owner:n}=e,s=r?[je(r),...n]:[...n];return new Set(s)}},ele:{get:()=>t}},s=t.tagName&&t.tagName.toLowerCase();s&&(n.tag={enumerable:!0,value:s}),xe(e,n),(e=>{const{tag:t}=e;if(ae.has(t))switch(se(["type","name","disabled"],e),t){case"input":oe(e);break;case"textarea":se(["value"],e),ie(e,{name:"value",type:"input"});break;case"option":se(["selected","value"],e);break;case"select":se(["value"],e),ie(e,{name:"value",type:"change"})}})(r)};class ke extends ee{constructor({ele:e}){super();const t=P.call(this,{},I);return Ee({_this:this,ele:e,proxySelf:t}),e.__xhear__=t,t}get length(){return this.ele&&this.ele.children.length}$(e){let{ele:t}=this;t instanceof HTMLTemplateElement&&(t=t.content);const r=t.querySelector(e);return r?je(r):null}all(e){return p(this.ele,e).map(je)}extend(e,t){return i(this,e,t)}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get classList(){return this.ele.classList}get data(){return this.ele.dataset}get shadow(){return je(this.ele.shadowRoot)}get root(){const e=this.ele.getRootNode();return e?je(e):null}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t?je(t):null}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?je(e):null}get parents(){const e=[];let t=this;for(;t.parent;)t=t.parent,e.push(t);return e}get next(){const e=this.ele.nextElementSibling;return e?je(e):null}get nexts(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r>t))}get prev(){const e=this.ele.previousElementSibling;return e?je(e):null}get prevs(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r<t))}get siblings(){return this.parent.filter((e=>e!==this))}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get style(){return this.ele.style}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get clientWidth(){return this.ele.clientWidth}get clientHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}is(e){return h(this.ele,e)}remove(){this.ele.remove()}clone(e=!0){return je(this.ele.cloneNode(e))}wrap(e){const t=Te(e),{ele:r}=this;if(!r.parentNode)throw"The target has a sibling element, so you can't use unwrap";return r.parentNode.insertBefore(t.ele,r),r.__internal=1,t.ele.appendChild(r),delete r.__internal,this}unwrap(){const{ele:e}=this,t=e.parentNode;if(t.children.length>1)throw"The element itself must have a parent";return e.__internal=1,t.parentNode.insertBefore(e,t),t.remove(),delete e.__internal,this}}const $e=R.prototype,Oe=ke.prototype;Oe.extend({get:$e.get,set:$e.set,toJSON:$e.toJSON,toString:$e.toString,...b,...G,...V,...K,...le},{enumerable:!1}),Oe.extend(de);const je=e=>e?e.__xhear__?e.__xhear__:new ke({ele:e}):null,Ae=document.createElement("template"),Te=(e,t)=>{if(e instanceof ke)return e;if(e instanceof Node||e===window)return je(e);switch(r(e)){case"object":return(e=>{const t={...e};if(!e.tag)return null;const r=document.createElement(e.tag);delete t.tag;const n=je(r);return Object.assign(n,t),n})(e);case"string":return(e=>{Ae.innerHTML=e;const t=Ae.content.children[0]||Ae.content.childNodes[0];return Ae.innerHTML="",je(t)})(e)}},Le=e=>{e.__revokes&&Array.from(e.__revokes).forEach((e=>e&&e())),e.childNodes&&Array.from(e.childNodes).forEach((e=>{Le(e)}))};function Se(e){if("string"===r(e)&&!/<.+>/.test(e)){const t=document.querySelector(e);return je(t)}return Te(e)}Object.defineProperties(Se,{extensions:{value:{}}}),Object.assign(Se,{stanz:te,render:F,convert:J,register:me,fn:ke.prototype,all:e=>p(document,e).map(je)});class Me{constructor(){this._middlewares=new Map}use(e){const t=Math.random().toString(32).slice(2);return this._middlewares.set(t,e),t}unuse(e){return this._middlewares.delete(e)}async run(e){let t=-1;const r=Array.from(this._middlewares.values()),n=async()=>{t++,t<r.length&&await r[t](e,n)};await n()}}const Pe={},Re=(e,t)=>{(Pe[e]||(Pe[e]=new Me)).use(t)},Ce=(e,t)=>{e instanceof Function&&(t=e,e=["js","mjs"]),e instanceof Array?e.forEach((e=>{Re(e,t)})):Re(e,t)};Ce(["mjs","js"],(async(e,t)=>{if(!e.result){const{url:t,params:r}=e,n=new URL(t);/^blob:/.test(t)||/^data:/.test(t)||r.includes("-direct")?e.result=await import(t):e.result=await import(`${n.origin}${n.pathname}`)}await t()})),Ce(["txt","html","htm"],(async(e,t)=>{if(!e.result){const{url:t}=e;e.result=await fetch(t).then((e=>e.text()))}await t()})),Ce("json",(async(e,t)=>{if(!e.result){const{url:t}=e;e.result=await fetch(t).then((e=>e.json()))}await t()})),Ce("wasm",(async(e,t)=>{if(!e.result){const{url:t}=e,r=await fetch(t).then((e=>e.arrayBuffer())),n=await WebAssembly.compile(r),s=new WebAssembly.Instance(n);e.result=s.exports}await t()})),Ce("css",(async(e,t)=>{if(!e.result){const{url:t,element:r}=e;if(r){const e=document.createElement("link");e.rel="stylesheet",e.href=t;const n=r.getRootNode();let s;n===document?n.head.append(e):n.appendChild(e),r.addEventListener("disconnected",s=t=>{e.remove(),r.removeEventListener("disconnected",s)})}else e.result=await fetch(t).then((e=>e.text()))}await t()}));const Ne=Symbol("loaded"),He=async(e,t)=>{const r=new URL(e),{pathname:n}=r;let s;t.params&&t.params.forEach((e=>{/^\..+/.test(e)&&(s=e.replace(/^\.(.+)/,"$1"))})),s||(s=n.slice(2+(n.lastIndexOf(".")-1>>>0)));const a={url:e,result:null,...t},i=Pe[s];if(i?await i.run(a):a.result=fetch(e),t&&t.element){const{element:e}=t;e[Ne]=!0;const r=new Event("load");e.dispatchEvent(r)}return t.params&&t.params.includes("-ctx")?a:a.result};function De(e){return(e=>(e||(e={url:document.location.href}),t=>{let r="";const[n,...s]=t.split(" ");if(e.resolve)r=e.resolve(n);else{const t=new URL(e.url);r=new URL(n,t).href}return He(r,{params:s})}))(e)}Object.assign(De,{use:Ce});class Ie extends HTMLElement{constructor(...e){super(...e),this[Ne]=!1,Object.defineProperties(this,{loaded:{get:()=>this[Ne]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let e=this.getAttribute("src");if(!e)return;this.__initSrc=e,e=new URL(e,location.href).href,Object.defineProperties(this,{src:{configurable:!0,value:e}});const[t,...r]=e.split(" ");He(t,{element:this,params:r})}connectedCallback(){const e=new CustomEvent("connected");e.root=this._root=this.getRootNode(),this.dispatchEvent(e)}disconnectedCallback(){const e=new CustomEvent("disconnected");e.root=this._root,delete this._root,this.dispatchEvent(e)}attributeChangedCallback(e,t,r){"src"===e?r&&null===t?this._init():this.__initSrc&&t&&r!==this.__initSrc&&(console.warn(`${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`),this.setAttribute("src",this.__initSrc)):"pause"===e&&null===r&&this._init()}static get observedAttributes(){return["src","pause"]}}class Ue extends Ie{constructor(...e){super(...e)}}const We=()=>{customElements.define("load-module",Ie),customElements.define("l-m",Ue),window.removeEventListener("load",We)};function Be(e,t){const[r,...n]=e.split(" "),s=t?new URL(t,location.href):location.href;if(r.startsWith("http://")||r.startsWith("https://"))return r;const a=new URL(r,s);return n.length?`${a.href} ${n.join(" ")}`:a.href}function qe(e,t){p(e,"[href],[src]").forEach((e=>{["href","src"].forEach((r=>{const n=e.getAttribute(r);n&&!/^(https?:)?\/\/\S+/.test(n)&&e.setAttribute(r,Be(n,t))}))}))}function Fe(e,t){const r=document.createElement("template");return r.innerHTML=e,qe(r.content,t),p(r.content,"style").forEach((e=>{const r=e.innerHTML;e.innerHTML=r.replace(/url\((.+)\)/g,((e,r)=>`url(${Be(r,t)})`))})),r.innerHTML}"complete"===document.readyState?We():window.addEventListener("load",We),window.lm=De;const Je=Symbol("loadError"),ze=async e=>{const t=lm(),r=[];let n,s,a,i=e;for(;;){try{n=await t(i)}catch(e){if(s){const t=new Error(`${s} request to parent page(${i}) fails; \n  ${e.stack}`);t.error=e,a=t}else a=e}if(a){r.unshift({ISERROR:Je,error:a});break}if(r.unshift({src:i,defaults:n}),!n.parent)break;s=i,i=new URL(n.parent,i).href}return r},Ve=(e,t)=>{const r=document.createElement("div");r.innerHTML=`<o-page src="${e}" style="display:block;"></o-page>`;const n=$(r.children[0]);return n._pause_init=1,a((()=>{n._renderDefault(t),delete n._pause_init})),n};U.render=e=>{const{step:t,name:r,target:n}=e,{link:s}=Se.extensions;if("init"===t)n.host&&s&&Se(n).all("a").forEach((e=>s(e)));else if("attr"===r&&"refresh"===t&&""===n.attr("olink")){const e=n.parents.pop();if(e.__fixLinkTimer)return;e.__fixLinkTimer=a((()=>{const{host:t}=n;t&&"o-page"===t.tag&&qe(e.ele,t.src),s&&Se(e).all("a").forEach((e=>s(e))),delete e.__fixLinkTimer}))}};const Ke=e=>{const t=Se(e);t.on("click",(e=>{const{target:r}=e;if(r.attributes.hasOwnProperty("olink"))if(t.app){if(e.metaKey||e.shiftKey)return;if(e.preventDefault(),"A"===r.tagName){const n=r.getAttribute("origin-href");t.app.goto(n||r.href),e.stopPropagation()}}else console.warn("olink is only allowed within o-apps")}))},Ge=async(e,t,r=!0)=>{const n=new File([e],"genfile",{type:"js"===t?"text/javascript":"application/json"});if(!r)return URL.createObjectURL(n);return await new Promise((e=>{const t=new FileReader;t.onload=t=>{e(t.target.result)},t.readAsDataURL(n)}))},Ye=new Map;async function Ze(e,t,r=!0){let n=Ye.get(t);if(n)return n;let s=!0;$.hasOwnProperty("debugMode")&&(s=$.debugMode);const a=$("<template></template>");a.html=e;const i=a.$("title"),o=a.$(`template[${r?"page":"component"}]`),c=o.$("script");c&&c.remove();const l=`\n  export const type = ${r?"$.PAGE":"$.COMP"};\n  export const PATH = '${t}';\n  ${r&&i?`export const title = '${i.text}';`:""}\n  export const temp = \`${o.html.replace(/\s+$/,"")}\`;`,h=`${l};\n${c?c.html:""}`;let u="";s&&(u=`//# sourceMappingURL=${await(async(e,t,r)=>{const n=t.split("\n");let s="";for(let e=0;e<=r;e++)s+=";";const a=n.findIndex((e=>"<script>"===e.trim())),i=n.findIndex((e=>"<\/script>"===e.trim()));let o=0,c=0;for(let e=a+1;e<i;e++){const t=n[e];let r="";Array.from(t).forEach(((t,n)=>{const s=`AA${Xe(e-o)}${Xe(n-c)}`;r?r+=`,${s}`:r=s,o=e,c=n})),s+=`${r};`}const l=`{"version": 3,\n    "file": "${e.replace(/.+\/(.+?)/,"$1").replace(".html",".js")}",\n    "sources": ["${e}"],\n    "mappings": "${s}"}`;return await Ge(l,null)})(t,e,l.split("\n").length)}`);const d=`${h}\n${u}`,p=navigator.userAgent.includes("Firefox");return n=Ge(d,"js",!p),Ye.set(t,n),n}const Qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function Xe(e){let t="",r=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{let e=31&r;r>>>=5,r>0&&(e|=32),t+=Qe[e]}while(r>0);return t}const et=Symbol("Page");Object.defineProperty(Se,"PAGE",{value:et}),De.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +page *>/.test(r)&&!n.includes("-ignore-temp")){const t=await Ze(r,e.url);e.result=await De()(`${t} .mjs`),e.resultContent=r}await t()})),De.use(["js","mjs"],(async(e,t)=>{const{result:r,url:n}=e;if("object"!=typeof r||r.type!==et)return void await t();const s=await rt(r,n);let a=s.temp;/<.+>/.test(a)||(a||(a=n.replace(/\.m?js.*/,".html")),await(async(e,{self:t,desc:r,...n})=>{try{await e()}catch(e){const s=new Error(`${r}\n  ${e.stack}`);throw s.error=e,t.emit("error",{error:s,...n}),s}})((async()=>{s.temp=await fetch(a).then((e=>e.text()))}),{targetModule:import.meta.url,desc:`${n} module request for ${a} template page failed`})),e.result=s,await t()})),Se.register({tag:"o-page",attrs:{src:null},watch:{async src(e){if(!e||e.startsWith("//")||/[a-z]+:\/\//.test(e)||(e=Be(e),this.ele.setAttribute("src",e)),this.__init_src){if(this.__init_src!==e)throw"A page that has already been initialized cannot be set with the src attribute";return}if(!e)return;if(this.__init_src=e,this._defaults||this._pause_init)return;const t=await ze(e),r=t.pop();t.forEach(((e,t)=>{const r=Ve(e.src,e.defaults);if(this.parent)this.wrap(r);else{(this.__need_wraps||(this.__need_wraps=[])).push(r)}})),this._renderDefault(r.defaults)}},attached(){const e=this.__need_wraps;e&&(e.forEach((e=>{this.wrap(e)})),delete this.__need_wraps)},proto:{async _renderDefault(e){const{src:t}=this;if(this._defaults)throw"The current page has already been rendered";if(this._defaults=e,e.pageAnime&&(this._pageAnime=e.pageAnime),!e||e.type!==et){const e=new Error(`The currently loaded module is not a page \nLoaded string => '${t}'`);throw this.emit("error",{error:e}),this.__reject(e),e}const r=document.createElement("template");r.innerHTML=Fe(e.temp,t);const n=J(r);fe({defaults:e,ele:this.ele,template:r,temps:n}),await tt(this,e.loaded),Ke(this.shadow),this._loaded=!0,this.emit("page-loaded"),this.__resolve()},back(){this.app.back()},goto(e){this.app.goto(Be(e,this.src))},replace(e){this.app.replace(Be(e,this.src))},get pageAnime(){const{app:e,_pageAnime:t}=this,{pageAnime:r}=e?._module||{};return n={...r,...t||{}},JSON.parse(JSON.stringify(n));var n},set pageAnime(e){this._pageAnime=e}},ready(){this._rendered=new Promise(((e,t)=>{this.__resolve=()=>{delete this.__resolve,delete this.__reject,e()},this.__reject=()=>{delete this.__resolve,delete this.__reject,t()}}))}});const tt=async(e,t)=>{const r=e.ele.shadowRoot;if(r){const e=p(r,"l-m,load-module");await Promise.all(e.map((e=>new Promise((t=>{e.addEventListener("load",(e=>{t()}))})))))}t&&t.call(e)},rt=async(e,t)=>{let r={};const{default:n,PATH:s}=e,a=s||t,i=De({url:a});o(n)?r=await n({load:i,url:a,get query(){const e=new URL(a);return Object.fromEntries(Array.from(e.searchParams.entries()))}}):n instanceof Object&&(r=n);return{proto:{},...e,...r}},nt=Symbol("Component");Object.defineProperty(Se,"COMP",{value:nt});const st={};De.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +component *>/.test(r)&&!n.includes("-ignore-temp")){const t=await Ze(r,e.url,!1);e.result=await De()(`${t} .mjs`),e.resultContent=r}await t()})),De.use(["js","mjs"],(async({result:e,url:t},r)=>{if("object"!=typeof e||e.type!==nt)return void r();let n={};const{default:s,PATH:a}=e,i=a||t;o(s)?n=await s({load:De({url:i})}):s instanceof Object&&(n=s);const{tag:c,temp:h}={...e,...n};let u=c;const d=i.match(/\/([^/]+)\.m?(js|htm|html)$/);u||d&&(u=l(d[1]));const p=st[u];if(p){if(i!==p)throw`${u} components have been registered`;return void await r()}let f,m;st[u]=i,/<.+>/.test(h)?(f=i,m=h):(f=Be(h||`${d[1]}.html`,i),m=await fetch(f).then((e=>e.text())));const g={...e,...n},_=g.ready,{loaded:y}=g;g.ready=async function(...e){_&&_.apply(this,e),y&&tt(this,y),Ke(this.shadow)};let w=Fe(m,a||f);const b=at(w,u);if(b){w=b.temp;const{hostLinks:e}=b,{attached:t,detached:r}=g;Object.assign(g,{attached(...r){const n=this.root,s=[];e.forEach((e=>{let t;t="LINK"===e.tagName?n.$(`link[href="${e.href}"][inject-host]`):n.$(`style[inject-id="${e.getAttribute("inject-id")}"][inject-host]`),t?(t=t.ele,t.__operators.push(this.ele)):(t=e.cloneNode(!0),t.__operators=[this.ele],n.ele===document?n.$("head").push(t):n.unshift(t)),s.push(t)})),this.__injectedLinks=s,t&&t.call(this,...r)},detached(...e){const t=this.__injectedLinks;this.__injectedLinks=null,t&&t.forEach((e=>{const t=e.__operators,r=t.indexOf(this.ele);r>-1&&(1===t.length&&e.remove(),t.splice(r,1))})),r&&r.call(this,...e)}})}Se.register({...g,tag:u,temp:w}),await r()}));const at=(t,r)=>{const n=Se(`<template>${t}</template>`),s=n.all("link,style"),a=[];if(s.forEach((t=>{"string"==typeof t.attr("host")&&(a.push(t.ele),t.remove(),t.attr("host",null),t.attr("inject-host",""),"style"===t.tag&&t.attr("inject-id",`${r}-${e()}`))})),a.length)return{hostLinks:a,temp:n.html}},it="_history",ot=async({src:e,_this:t})=>{const{loading:r,fail:n}=t._module||{},s=[];let a,i,o=t.current;if(o){let e=o;do{s.unshift({page:e,src:e.src}),o=e,e=e.parent}while("o-page"===e.tag)}r&&(i=Te(r()),t.push(i));let c=t;const l=await ze(e),h=[];let u=-1;const d=s.length-1;s.some(((e,t)=>l[t].src!==e.src||t===d||(h.push(e),u=t,!1)));let p,f=l;return u>=0&&(c=h.slice(-1)[0].page,o=c.slice(-1)[0],f=l.slice(u+1)),f.some((t=>{const{defaults:r,ISERROR:s}=t;if(s===Je){if(n){const r=n({src:e,error:t.error});a=Ve(t.src,{type:Se.PAGE,temp:r})}return!1}const i=Ve(t.src,r);p||(a=i),p&&p.push(i),p=i})),i&&i.remove(),c.push(a),t._current=a,{current:a,old:o,publics:h}},ct=(e,t,r)=>{if(t&&t.length){const{current:n}=e;t.forEach((e=>{const{page:t}=e,{routerChange:s}=t._defaults;s&&s.call(t,{type:r,current:n})}))}};Se.register({tag:"o-app",temp:"<style>:host{position:relative;display:block}::slotted(*){display:block;width:100%;height:100%;}</style><slot></slot>",attrs:{src:null},data:{[it]:[]},watch:{async src(e){if(this.__init_src){if(this.__init_src!==e)throw"The App that has already been initialized cannot be set with the src attribute";return}if(!e)return;this.__init_src=e;let t=e;!e||e.startsWith("//")||/[a-z]+:\/\//.test(e)||(t=Be(e));const r=lm(),n=await r(t),s=await rt(n,t);if(this._module=s,!this._settedRouters&&(this.extend(s.proto),s.ready&&s.ready.call(this),!this.$("o-page")&&!this._initHome&&s.home)){const e=new URL(s.home,t).href;this.push(`<o-page src="${e}"></o-page>`)}}},proto:{async back(e=1){if(!this[it].length)return void console.warn("It's already the first page, can't go back");e=e<this[it].length?e:this[it].length;const t=this[it].splice(-e)[0];let{current:r,old:n,publics:s}=await ot({src:t.src,_this:this});lt({page:r,key:"previous"}),n=dt(n),this.emit("router-change",{name:"back",delta:e}),ct(this,s,"back"),await ht({page:n,key:"next"}),n.remove()},async _navigate({type:e,src:t}){const{current:r}=this;t=new URL(t,location.href).href,r||(this._initHome=t);let{current:n,old:s,publics:a}=await ot({src:t,_this:this});lt({page:n,key:"next"}),s=dt(s),"goto"===e&&r&&this[it].push({src:r.src}),this.emit("router-change",{name:e,src:t}),ct(this,a,e),r&&(await ht({page:s,key:"previous"}),s.remove())},goto(e){return this._navigate({type:"goto",src:e})},replace(e){return this._navigate({type:"replace",src:e})},get current(){return this._current||this.all("o-page").slice(-1)[0]},get routers(){let{current:e}=this;if(!e)return[];return[...this[it],{src:e.src}]},set routers(e){e=e.map((e=>({src:e.src}))),this._settedRouters=1,this.html="";const t=e.slice(),r=t.pop();this[it].length=0,this[it].push(...t),this.push({tag:"o-page",src:r.src})}}});const lt=({page:e,key:t})=>{const{pageAnime:r}=e,n=r[t];n&&(e.css={...e.css,...n},ut((()=>{e.css={...e.css,transition:"all ease .3s",...r.current||{}}})))},ht=({page:e,key:t})=>new Promise((r=>{const n=e.pageAnime[t];n?ut((()=>{e.one("transitionend",r),e.css={...e.css,transition:"all ease .3s",...n}})):r()})),ut=e=>requestAnimationFrame((()=>{setTimeout(e,5)})),dt=e=>(e.css={position:"absolute",width:`${e.width}px`,height:`${e.height}px`},e);if(Se.fn.extend({get app(){let e=this;for(;e&&"o-app"!==e;){if("o-page"===e.tag){const t=e.parents.find((e=>"o-app"===e.tag));if(t){e=t;break}}if(e=e.host,!e)break}return e}}),document.currentScript){const e=document.currentScript.attributes.hasOwnProperty("debug");Object.defineProperty(Se,"debugMode",{value:e})}"undefined"!=typeof window&&(window.$=Se);export{Se as default};
//# sourceMappingURL=ofa.min.mjs.map
