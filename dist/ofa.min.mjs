//! ofa.js - v4.3.5 https://github.com/kirakiray/ofa.js  (c) 2018-2023 YAO
const t=()=>Math.random().toString(32).slice(2),r=Object.prototype.toString,n=e=>r.call(e).toLowerCase().replace(/(\[object )|(])/g,""),s=e=>{const t=n(e);return"array"===t||"object"===t},i=new Set;function a(e){const r=`t-${t()}`;return i.add(r),Promise.resolve().then((()=>{i.has(r)&&(e(),i.delete(r))})),r}const o=(e,t,r={})=>([...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)].forEach((n=>{const s=Object.getOwnPropertyDescriptor(t,n),{configurable:i,enumerable:a,writable:o,get:c,set:l,value:h}=s;"value"in s?e.hasOwnProperty(n)?e[n]=h:Object.defineProperty(e,n,{enumerable:a,configurable:i,writable:o,...r,value:h}):Object.defineProperty(e,n,{enumerable:a,configurable:i,...r,get:c,set:l})})),e);function c(e){try{e.xid}catch(e){return l(e)}return!1}function l(e){const t=e.stack.split(/\\n/)[0].toLowerCase();return!(!t.includes("proxy")||!t.includes("revoked"))}const h=e=>n(e).includes("function"),d=e=>e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));const u=e=>e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),f=(e,t)=>{const r=document.createElement("template");return r.content.append(e.cloneNode()),!!r.content.querySelector(t)};const p=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},m=(e,t)=>e instanceof HTMLTemplateElement?Array.from(e.content.querySelectorAll(t)):Array.from(e.querySelectorAll(t));const{assign:g,freeze:_}=Object;class y{constructor(e){g(this,e),_(this)}hasModified(e){if("array"===this.type)return this.path.includes(this.currentTarget.get(e));const t=e.split(".");if(this.currentTarget===this.target&&this.name===t[0])return!0;const r=w(this,t).indexOf(this.target);if(r>-1){const e=t.slice(r+1);return!e.length||this.name===e[0]}return this.path.includes(this.currentTarget[e])}hasReplaced(e){if("set"!==this.type)return!1;const t=e.split(".");if(this.target===this.currentTarget&&this.name===t[0])return!0;const r=w(this,t).indexOf(this.target);if(r>-1){return t.slice(r+1)[0]===this.name}return!1}}const w=(e,t)=>{const r=[],n=t.slice();let s=e.currentTarget;for(;n.length;){const e=n.shift();s&&(s=s[e]),r.push(s)}return r};class b extends Array{constructor(e){super(...e)}hasModified(e){return this.some((t=>t.hasModified(e)))}hasReplaced(e){return this.some((t=>t.hasReplaced(e)))}}const v=({type:e,currentTarget:t,target:r,name:n,value:s,oldValue:i,args:a,path:o=[]})=>{if(o&&o.includes(t))return void console.warn("Circular references appear");let c={type:e,target:r,name:n,oldValue:i,value:s};if("array"===e&&(delete c.value,c.args=a),t._hasWatchs){const e=new y({currentTarget:t,...c,path:[...o]});t[M].forEach((t=>{t(e)}))}t._update&&t.owner.forEach((e=>{v({currentTarget:e,...c,path:[t,...o]})}))};var k={watch(e){const r="w-"+t();return this[M].set(r,e),r},unwatch(e){return this[M].delete(e)},watchTick(e,t){return this.watch(function(e,t=0){let r=null,n=[];return function(...s){n.push(...s),t>0?(clearTimeout(r),r=setTimeout((()=>{e.call(this,n),n=[],r=null}),t)):null===r&&(r=1,a((()=>{e.call(this,n),n=[],r=null})))}}((t=>{c(this)||(t=t.filter((e=>{try{e.path.forEach((e=>e.xid))}catch(e){return!1}return!0})),e(new b(t)))}),t||0))},refresh(e){const t={...e,type:"refresh",target:this,currentTarget:this};v(t)}};const E=Symbol("placeholder");const x={},T=Array.prototype;["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"].forEach((e=>{T[e]&&(x[e]=function(...t){const r=Array.from(this),n=T[e].apply(this[L],t),{deletedItems:i,addedItems:a}=function(e,t){const r=Array.from(t),n=Array.from(e),s=[],i=new Map,a=e.length;for(let t=0;t<a;t++){const n=e[t],i=r.indexOf(n);i>-1?r[i]=E:s.push(n)}const o=t.length;for(let e=0;e<o;e++){const r=t[e],s=n.indexOf(r);s>-1?n[s]=E:i.set(e,r)}return{deletedItems:s,addedItems:i}}(r,this);for(let[e,t]of a)P(t)?t._owner.push(this):s(t)&&(this.__unupdate=1,this[e]=t,delete this.__unupdate);for(let e of i)I(e,this);return v({type:"array",currentTarget:this,target:this,args:t,name:e,oldValue:r}),n===this[L]?this[j]:n})}));const{defineProperties:A,getOwnPropertyDescriptor:O,entries:S}=Object,L=Symbol("self"),j=Symbol("proxy"),M=Symbol("watchs"),N=Symbol("isxdata"),P=e=>e&&!!e[N];function C(e,r=U){let n,{proxy:s,revoke:i}=Proxy.revocable(this,r);return s._update=1,A(this,{xid:{value:e.xid||t()},_owner:{value:[]},owner:{configurable:!0,get(){return new Set(this._owner)}},[N]:{value:!0},[L]:{configurable:!0,get:()=>this},[j]:{configurable:!0,get:()=>s},[M]:{get:()=>n||(n=new Map)},_hasWatchs:{get:()=>!!n},_revoke:{value:i}}),Object.keys(e).forEach((t=>{const r=O(e,t);let{value:n,get:i,set:a}=r;i||a?A(this,{[t]:r}):s[t]=n})),s}class H extends Array{constructor(e){return super(),C.call(this,e)}revoke(){const e=this[L];e._onrevokes&&(e._onrevokes.forEach((e=>e())),e._onrevokes.length=0),e.__unupdate=1,e[M].clear(),S(this).forEach((([e,t])=>{P(t)&&(this[e]=null)})),e._owner.forEach((e=>{S(e).forEach((([t,r])=>{r===this&&(e[t]=null)}))})),delete e[L],delete e[j],e._revoke()}toJSON(){let e={},t=!0,r=-1;Object.keys(this).forEach((n=>{let s=this[n];/\D/.test(n)?t=!1:(n=parseInt(n))>r&&(r=n),P(s)&&(s=s.toJSON()),e[n]=s})),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return A(e,{xid:{get:()=>n}}),e}toString(){return JSON.stringify(this.toJSON())}extend(e,t){return o(this,e,t)}get(e){if(/\./.test(e)){const t=e.split(".");let r=this;for(let e=0,n=t.length;e<n;e++)try{r=r[t[e]]}catch(n){const s=new Error(`Failed to get data : ${t.slice(0,e).join(".")} \n${n.stack}`);throw Object.assign(s,{error:n,target:r}),s}return r}return this[e]}set(e,t){if(/\./.test(e)){const r=e.split("."),n=r.pop();let s=this;for(let e=0,t=r.length;e<t;e++)try{s=s[r[e]]}catch(t){const n=new Error(`Failed to get data : ${r.slice(0,e).join(".")} \n${t.stack}`);throw Object.assign(n,{error:t,target:s}),n}return s[n]=t}return this[e]=t}}H.prototype.extend({...k,...x},{enumerable:!1});const{defineProperties:R}=Object,D=({target:e,key:t,value:r,receiver:n,type:i,succeed:a})=>{const o=n[t];let c=r;if(P(c)){if(o===r)return!0;c._owner.push(n)}else if(s(r)){const s=Object.getOwnPropertyDescriptor(e,t);s&&!s.hasOwnProperty("value")||(c=new H(r),c._owner.push(n))}const l=o===r;!l&&P(o)&&I(o,n);const h=a(c);return!l&&!e.__unupdate&&v({type:i||"set",target:n,currentTarget:n,name:t,value:r,oldValue:o}),h},I=(e,t)=>{if(P(e)){const r=e._owner.indexOf(t);r>-1?e._owner.splice(r,1):console.error({desc:"This data is wrong, the owner has no boarding object at the time of deletion",target:t,mismatch:e})}},U={set(e,t,r,n){if("symbol"==typeof t)return Reflect.set(e,t,r,n);if(/^_/.test(t))return e.hasOwnProperty(t)?Reflect.set(e,t,r,n):R(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0;try{return D({target:e,key:t,value:r,receiver:n,succeed:r=>Reflect.set(e,t,r,n)})}catch(e){const s=new Error(`failed to set ${t} \n ${e.stack}`);throw Object.assign(s,{key:t,value:r,target:n,error:e}),s}},deleteProperty:(e,t)=>/^_/.test(t)||"symbol"==typeof t?Reflect.deleteProperty(e,t):D({target:e,key:t,value:void 0,receiver:e[j],type:"delete",succeed:()=>Reflect.deleteProperty(e,t)})},F={set:(e,t,r,n)=>/\D/.test(String(t))?U.set(e,t,r,n):Reflect.set(e,t,r,n),get:(e,t,r)=>/\D/.test(String(t))?Reflect.get(e,t,r):Me(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},B={render(){}},W=e=>e.__revokes||(e.__revokes=[]),q=(e,t)=>W(e).push(t),V=(e,t,r)=>{const n=`\nconst isRevokedErr = ${l.toString()}\nconst [$event] = $args;\nconst {data, errCall} = this;\ntry{\n  with(data){\n    return ${e};\n  }\n}catch(error){\n  if(isRevokedErr(error)){\n    return;\n  }\n  if(data.ele && !data.ele.isConnected){\n    return;\n  }\n  if(errCall){\n    const result = errCall(error);\n    if(result !== false){\n      console.error(error);\n    }\n  }\n}\n`;return new Function("...$args",n).bind({data:t,...r})};function J({data:e,target:t,template:r,temps:n,isRenderSelf:s,...i}){const a=r&&r.innerHTML;a&&(t.innerHTML=a);const o=m(t,"xtext"),c=[],l=W(t);o.forEach((t=>{const r=document.createTextNode(""),{parentNode:n}=t;n.insertBefore(r,t),n.removeChild(t);const s=V(t.getAttribute("expr"),e),i=()=>{r.textContent=s()};c.push(i);const a=()=>{p(l,a),p(c,i),p(W(r),a)};l.push(a),q(r,a)}));const h=m(t,"[x-bind-data]");if(s&&f(t,"[x-bind-data]")&&h.unshift(t),h.forEach((r=>{const n=JSON.parse(r.getAttribute("x-bind-data")),s=Me(r);for(let[i,a]of Object.entries(n))a.forEach((n=>{try{const{always:a}=s[i];let o,h=[];const d=()=>{const[r,a]=n,o=V(a,e,{errCall:e=>{const r=`Rendering of target element failed: ${s.ele.outerHTML} \n  ${e.stack}`;return console.error(r),console.error({stack:r,element:s.ele,target:t,error:e}),!1}});h=[r,o];const c=s[i](...h,{actionName:i,target:s,data:e,beforeArgs:n,args:h});return B.render({step:"refresh",args:n,name:i,target:s}),c};let u=()=>{const{revoke:t}=s[i];t&&t({actionName:i,target:s,data:e,beforeArgs:n,args:h,result:o}),p(l,u),p(W(r),u),p(c,d),u=null};a?c.push(d):o=d(),l.push(u),r!==t&&q(r,u)}catch(e){const t=new Error(`Execution of the ${i} method reports an error: ${i}:${n[0]}="${n[1]}"  \n ${e.stack}`);throw t.error=e,t}}));r.removeAttribute("x-bind-data"),r._bindingRendered=!0,r.dispatchEvent(new Event("binding-rendered"))})),t.__render_temps||function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)||(t.__render_temps=n),c.length){if(t.__render_data&&t.__render_data!==e){const r=new Error("An old listener already exists and the rendering of this element may be wrong");throw Object.assign(r,{element:t,old:t.__render_data,new:e}),r}t.__render_data=e,c.forEach((e=>e()));const r=e.watchTick((t=>{c.length?c.forEach((e=>e())):e.unwatch(r)}))}B.render({step:"init",target:t})}const z=e=>{const{tagName:t}=e;if("TEMPLATE"!==t){if(t){const t={};Array.from(e.attributes).forEach((r=>{const n=/(.*):(.+)/.exec(r.name);if(!n)return;let[,s,i]=n;s||(s="prop");(t[s]||(t[s]=[])).push([i,r.value]),e.removeAttribute(r.name)}));Object.keys(t).length&&e.setAttribute("x-bind-data",JSON.stringify(t))}Array.from(e.children).forEach(z)}},K=(e,t,r)=>{const n=Array.from(e.content.querySelectorAll(t));return r&&n.forEach(r),n};let G;const X=e=>{let r={};const n={};K(e,"code",(e=>{const r=t();e.setAttribute("code-id",r),n[r]=e.innerHTML,e.innerHTML=""})),e.innerHTML=e.innerHTML.replace(/{{(.+?)}}/g,((e,t)=>`<xtext expr="${t}"></xtext>`));const s=e.getAttribute("name");if(s){if(e.content.children.length>1){G||(console.warn("Only one child element can be contained within a template element. If multiple child elements appear, the child elements will be rewrapped within a <div> element"),G=1);const t=`wrapper-${s}`;e.innerHTML=`<div ${t} style="display:contents">${e.innerHTML}</div>`,console.warn(`The template "${s}" contains ${e.content.children.length} child elements that have been wrapped in a div element with attribute "${t}".`)}r[s]=e,e.remove()}K(e,"x-fill:not([name])",(e=>{if(e.querySelector("x-fill:not([name])"))throw`Don't fill unnamed x-fills with unnamed x-fill elements!!!\n${e.outerHTML}`;const r=`t${t()}`;e.setAttribute("name",r);const n=document.createElement("template");n.setAttribute("name",r),n.innerHTML=e.innerHTML,e.innerHTML="",e.appendChild(n)})),K(e,"x-if,x-else-if,x-else",(e=>{const t=e.children[0];t&&"TEMPLATE"===t.tagName||(e.innerHTML=`<template condition>${e.innerHTML}</template>`)})),K(e,"template",(e=>{r={...r,...X(e)}})),Array.from(e.content.children).forEach((e=>z(e)));for(let[t,r]of Object.entries(n))K(e,`[code-id="${t}"]`,(e=>{e.removeAttribute("code-id"),e.innerHTML=r}));return r},Y=e=>h(e)?e():e,Z={prop(...e){let[t,r]=e;if(1===e.length)return this[t];r=Y(r),t=d(t),this.set(t,r)},attr(...e){let[t,r]=e;if(1===e.length)return this.ele.getAttribute(t);r=Y(r),null===r?this.ele.removeAttribute(t):this.ele.setAttribute(t,r)},class(...e){let[t,r]=e;if(1===e.length)return this.ele.classList.contains(t);r=Y(r),r?this.ele.classList.add(t):this.ele.classList.remove(t)}};Z.prop.always=!0,Z.attr.always=!0,Z.class.always=!0,Z.prop.revoke=({target:e,args:t,$ele:r,data:n})=>{const s=t[0];e.set(s,null)};const Q={sync(e,t,r){if(!r)throw"Sync is only allowed within the renderer";[e,t]=r.beforeArgs;const{data:n}=r;if(n.get(t)instanceof Object){const e=`Object values cannot be synchronized using the sync function : ${t}`;throw console.log(e,n),new Error(e)}this[e]=n.get(t);const s=this.watch((r=>{if(r.hasModified(e))try{const r=this.get(e);n.set(t,r)}catch(e){}})),i=n.watch((r=>{if(r.hasModified(t))try{const r=n.get(t);this.set(e,r)}catch(e){}}));return()=>{this.unwatch(s),n.unwatch(i)}}};Q.sync.revoke=e=>{e.result()};const ee={on(e,t,r){let n;if(r){const s=r.beforeArgs[1];/[^\d\w_\$\.]/.test(s)||(t=r.data.get(s).bind(r.data)),n=()=>this.ele.removeEventListener(e,t)}return this.ele.addEventListener(e,t),n||this},one(e,t,r){const n=r=>{this.off(e,n),t(r)};return this.on(e,n,r),this},off(e,t){return this.ele.removeEventListener(e,t),this},emit(e,t){const r={...t};let n,s;return r.hasOwnProperty("data")&&(n=r.data,delete r.data),e instanceof Event?s=e:e&&(s=new Event(e,{bubbles:!0,...r})),n&&(s.data=n),this.ele.dispatchEvent(s),this}};ee.on.revoke=e=>{e.result()};const te=(e,t,r,...n)=>{const{children:s}=e;t<0&&(t+=e.children.length),void 0===r&&(r=e.children.length-t);const i=[];for(let e=t,n=t+r;e<n;e++){const t=s[e];i.push(t)}if(i.forEach((e=>e&&e.remove())),n.length){const r=document.createDocumentFragment();n.forEach((e=>r.append(Pe(e).ele)));const i=s[t];i?e.insertBefore(r,i):e.appendChild(r)}return i},re=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],ne={push(...e){const{ele:t}=this;return te(t,t.children.length,0,...e),v({type:"array",currentTarget:this,target:this,args:e,name:"push"}),t.children.length},pop(...e){const{ele:t}=this,r=te(t,t.children.length-1,1,...e);return v({type:"array",currentTarget:this,target:this,args:e,name:"pop"}),Me(r[0])},shift(...e){const{ele:t}=this,r=te(t,0,1,...e);return v({type:"array",currentTarget:this,target:this,args:e,name:"shift"}),Me(r[0])},unshift(...e){const{ele:t}=this;return te(t,0,0,...e),v({type:"array",currentTarget:this,target:this,args:e,name:"unshift"}),t.children.length},splice(...e){const t=te(this.ele,...e);return v({type:"array",currentTarget:this,target:this,args:e,name:"splice"}),t.map(Me)},reverse(...e){const t=Array.from(this.ele.childNodes);se.reverse.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.__internal=1,r.append(e)})),this.ele.append(r),t.forEach((e=>{delete e.__internal})),v({type:"array",currentTarget:this,target:this,args:e,name:"reverse"}),this},sort(...e){const t=Array.from(this.ele.children).map(Me);se.sort.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.ele.__internal=1,r.append(e.ele)})),this.ele.append(r),t.forEach((e=>{delete e.ele.__internal})),v({type:"array",currentTarget:this,target:this,args:e,name:"sort"}),this}},se=Array.prototype;Object.keys(Object.getOwnPropertyDescriptors(se)).forEach((e=>{if("constructor"===e||"length"===e||re.includes(e))return;const t=se[e];h(t)&&(ne[e]=function(...e){return t.apply(Array.from(this.ele.children).map(Me),e)})}));class ie{}for(let[e,t]of Object.entries(ne))Object.defineProperty(ie.prototype,e,{value:t});const ae=e=>new H(e);Object.assign(ae,{is:P});const{defineProperty:oe,assign:ce}=Object,le=(e,t)=>{const{ele:r}=t;e.forEach((e=>{if(e in r){let n=!1;oe(t,e,{enumerable:!0,get:()=>{let t=r[e];return n&&(/\D/.test(t)?n=!1:t=Number(t)),t},set:t=>{n="number"==typeof t,r[e]=t}})}}))},he=new Set(["input","textarea","select","option","button","label","fieldset","legend","form"]),de=(e,t={})=>{const{name:r,type:n}=t,{ele:s}=e;let i=s[r];e.on(n,(()=>{v({type:"set",target:e,currentTarget:e,name:r,value:s[r],oldValue:i}),i=s[r]}))},ue=e=>{switch(e.attr("type")){case"file":le(["multiple","files"],e),de(e,{name:"files",type:"change"});break;case"checkbox":le(["checked","multiple","value"],e),de(e,{name:"checked",type:"change"});break;case"radio":le(["checked","value"],e),de(e,{name:"checked",type:"change"});break;default:le(["placeholder","value"],e),de(e,{name:"value",type:"input"})}},fe=(e,t)=>{const r={};return e.all(t).forEach((e=>{const{name:t,tag:n,ele:s}=e;if("input"===n)switch(e.type){case"checkbox":t in r||(r[t]=[]),s.checked&&r[t].push(s.value);break;case"radio":s.checked&&(r[t]=s.value);break;case"file":r[t]=s.files;break;default:r[t]=s.value}else if("textarea"===n)r[t]=s.value;else if("select"===n){const e=m(s,"option:checked");if(s.multiple)r[t]=e.map((e=>e.value||e.textContent));else{const[n]=e;r[t]=n.value||n.textContent}}else r[t]=e.value})),r};var pe={formData(e,t={wait:200}){const r=ae({});ce(r,fe(this,e||"input,select,textarea"));const n=this.watchTick((t=>{const n=fe(this,e||"input,select,textarea");!function(e,t){for(let r of Object.keys(e))t.hasOwnProperty(r)||delete e[r];for(let[r,n]of Object.entries(t))e[r]=n}(r,n)}),t.wait),s=r.watchTick((t=>{!function(e,t,r){const n=e.all(t);Object.keys(r).forEach((e=>{const t=n.filter((t=>t.attr("name")===e));if(0===t.length)return;const s=r[e],i=t[0],a=i.attr("type");if(1===t.length){let e=!0;if("input"!==i.tag||"radio"!==a&&"checkbox"!==a||(e=!1),e)return void(i.value!==s&&(i.value=s))}t.forEach((e=>{switch(e.attr("type")){case"radio":e.value===s?e.checked=!0:e.checked=!1;break;case"checkbox":e.checked=s.includes(e.value)}}))}))}(this,e||"input,select,textarea",r)})),i=this,a=r.revoke;return r.extend({revoke(){i.unwatch(n),r.unwatch(s),a.call(this)}}),r}};const me={set:(e,t,r,n)=>(e._ele.style[t]=r,Reflect.set(e,t,r,n),!0),get(e,t,r){if("length"===t)return 0;const{style:n}=e._ele;return Array.from(n).includes(t)?n[t]:getComputedStyle(e._ele)[t]}};class ge{constructor(e){const t={};Object.defineProperty(t,"_ele",{enumerable:!1,get:()=>e.ele});const{style:r}=e.ele;return Array.from(r).forEach((e=>{t[e]=r[e]})),e._css=new Proxy(t,me)}}var _e={get css(){return new ge(this)},set css(e){if("string"==n(e))return void(this.ele.style=e);let{style:t}=this,r=Object.keys(e);Array.from(t).forEach((e=>{r.includes(e)||(t[e]="")})),Object.assign(t,e)}};const ye={},we=({defaults:e,ele:t,template:r,temps:n})=>{let s;try{const i={...ke(e.data),...e.attrs};s=Me(t),e.proto&&s.extend(e.proto,{enumerable:!1});for(let[e,t]of Object.entries(i))s.hasOwnProperty(e)||(s[e]=t);if(e.temp){const e=t.attachShadow({mode:"open"});e.innerHTML=r.innerHTML,J({target:e,data:s,temps:n})}e.ready&&e.ready.call(s)}catch(e){const r=new Error(`Render element error: ${t.tagName} \n  ${e.stack}`);throw r.error=e,r}if(e.watch){const t=Object.entries(e.watch);s.watchTick((e=>{for(let[r,n]of t)e.hasModified(r)&&n.call(s,s[r],{watchers:e})}));for(let[e,r]of t)r.call(s,s[e],{})}},be=(e={})=>{const t={tag:"",temp:"",data:{},proto:{},...e};let r,n,s;try{if(function(e){if("-"===e.charAt(0)||"-"===e.charAt(e.length-1))throw new Error(`The string "${e}" cannot start or end with "-"`);for(let t=0;t<e.length-1;t++)if("-"===e.charAt(t)&&"-"===e.charAt(t+1))throw new Error(`The string "${e}" cannot have consecutive "-" characters`);if(!e.includes("-"))throw new Error(`The string "${e}" must contain at least one "-"`)}(t.tag),t.data=ke(t.data),s=(i=d(t.tag)).charAt(0).toUpperCase()+i.slice(1),ye[s])throw`Component ${s} already exists`;r=document.createElement("template"),r.innerHTML=t.temp,n=X(r)}catch(e){const r=new Error(`Register Component Error: ${t.tag} \n  ${e.stack}`);throw r.error=e,r}var i;const a=e=>{let t;return t=e instanceof Array?[...e]:Object.keys(e),t},o=ye[s]=class extends HTMLElement{constructor(...e){super(...e);const s=Me(this);if(t.created&&t.created.call(s),t.attrs){const e=a(t.attrs);s.watchTick((t=>{e.forEach((e=>{if(t.hasModified(e)){const t=s[e],r=u(e);null==t?this.removeAttribute(r):this.setAttribute(r,t)}}))}))}we({defaults:t,ele:this,template:r,temps:n})}connectedCallback(){ve(this)||t.attached&&t.attached.call(Me(this))}disconnectedCallback(){ve(this)||t.detached&&t.detached.call(Me(this))}attributeChangedCallback(e,t,r){const n=Me(this);/[^\d.]/.test(r)||"number"!=typeof n[e]||(r=Number(r)),n[d(e)]=r}static get observedAttributes(){return a(t.attrs||{}).map((e=>u(e)))}};if("loading"!==document.readyState)customElements.define(t.tag,o);else{const e="readystatechange";let r;document.addEventListener(e,r=()=>{customElements.define(t.tag,o),document.removeEventListener(e,r)})}};function ve(e){let t=e;for(;t;){if(t.__internal)return!0;if(t=t.parentNode||t.host,!t||t.tagName&&"BODY"===t.tagName)break}return!1}function ke(e){if(e instanceof Set||e instanceof Map)throw"The data of the registered component should contain only regular data types such as String, Number, Object and Array. for other data types, please set them after ready.";if(e instanceof Function)throw"Please write the function in the 'proto' property object.";if("object"!=typeof e||null===e)return e;const t=Array.isArray(e)?[]:{};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=ke(e[r]));return t}class Ee extends Comment{constructor(e){const t="Fake Node"+(e?": "+e:"");super(` ${t} --end `),this._mark=e,this._inited=!1;const r=new Comment(` ${t} --start `);r.__fake_end=this,Object.defineProperty(this,"_start",{value:r})}init(){this._inited||(this.parentNode.insertBefore(this._start,this),this._inited=!0)}querySelector(e){return this.__searchEl(e,"find")}querySelectorAll(e){return this.__searchEl(e)}__searchEl(e,t="filter"){const r=this.parentNode;if(!r)return[];const n=this.children;return Array.from(r.querySelectorAll(e))[t]((e=>{let t=e;for(;;){if(n.includes(t))return!0;if(t=t.parentNode,!t)break}}))}insertBefore(e,t){const{parentNode:r}=this;Array.from(r.children).includes(t)?r.insertBefore(e,t):r.insertBefore(e,this)}appendChild(e){this.parentNode.insertBefore(e,this)}get children(){const e=[];let t=this;for(;;){if(t=t.previousSibling,!t)throw"This is an unclosed FakeNode";if(t instanceof HTMLElement)e.unshift(t);else if(t===this._start)break}return e}get childNodes(){const e=[];let t=this;for(;;){if(t=t.previousSibling,!t)throw"This is an unclosed FakeNode";if(t===this._start)break;e.unshift(t)}return e}set innerHTML(e){this.childNodes.forEach((e=>{e.remove()}));const t=document.createElement("template");t.innerHTML=e,Array.from(t.content.childNodes).forEach((e=>{this.appendChild(e)}))}get innerHTML(){const{children:e}=this;let t="";return e.forEach((e=>{t+=e.outerHTML+"\n"})),t}get nextElementSibling(){let e=this.nextSibling;return e.__fake_end?e.__fake_end:(!e||e instanceof Element||(e=e.nextElementSibling),e)}get previousElementSibling(){const{_start:e}=this;let t=e.previousSibling;return t instanceof Ee?t:e.previousElementSibling}}const xe={data:{value:null,__rendered:!1},watch:{value(){this._bindend&&this.refreshValue()}},proto:{refreshValue(){clearTimeout(this._timer),this._timer=setTimeout((()=>{const e=[this,...this._others];let t=!1;e.forEach((e=>{t?e._clearContent():e.value||"x-else"===e.tag?(t=!0,e._renderContent()):e._clearContent()})),Me(this._fake.parentNode).refresh()}),0)},_renderContent(){if(this.__rendered)return;this.__rendered=!0;const{target:e,data:t,temps:r}=$e(this._fake);c(t)||(this._fake.innerHTML=this.__originHTML,J({target:e,data:t,temps:r}))},_clearContent(){this.__rendered=!1,Ce(this._fake),this._fake.innerHTML=""},init(){if(this._bindend)return;this._bindend=!0;const e=this._fake=new Ee(this.tag);if(this.before(e),e.init(),this.remove(),"x-if"===this.tag){const t=this._others=[];let r=e;for(;r=r.nextElementSibling,r;)switch(r.tagName){case"X-ELSE":{const e=Me(r);return e.init?e.init():e._if_ready=1,void t.push(e)}case"X-ELSE-IF":{const e=Me(r);e._xif=this,t.push(e);break}}}}},created(){this.__originHTML=this.$("template[condition]").html,this.html=""},ready(){this.ele._bindingRendered?this.init():this.one("binding-rendered",(()=>this.init()))}};be({tag:"x-if",...xe}),be({tag:"x-else-if",...xe,watch:{value(){this._bindend&&this._xif&&this._xif.refreshValue()}}}),be({tag:"x-else",...xe,watch:{},ready(){this._if_ready&&this.init()}});const $e=e=>{for(;e&&!e.__render_data;)e=e.parentNode;return e?{target:e,data:e.__render_data,temps:e.__render_temps}:null};be({tag:"x-fill",data:{value:null},watch:{value(){this.refreshValue()}},proto:{refreshValue(){const e=this.value;if(!this._bindend)return;const t=this._fake.children;if(!e)return t.forEach((e=>Ce(e))),void(this._fake.innerHTML="");if(!(e instanceof Array))return console.warn(`The value of x-fill component must be of type Array, and the type of the current value is ${getType(e)}`),void(t&&t.forEach((e=>{Ce(e),e.remove()})));const r=$e(this._fake);if(!r)return;const n=t.map((e=>e._data_xid)),{data:s,temps:i}=r,a=i[this._name],o=e.length;let c;for(let r=0;r<o;r++){const o=e[r],l=n.indexOf(o.xid);if(l>-1){if(l===r){c=t[r];continue}const e=t[l];Me(e).__item.$index=r,e.__internal=1,0===r?this._fake.insertBefore(e,t[0]):this._fake.insertBefore(e,c.nextElementSibling),c=e,delete e.__internal;continue}const h=Te(o,i,a,s.$host||s,r);c?this._fake.insertBefore(h.ele,c.nextSibling):t.length?this._fake.insertBefore(h.ele,t[0]):this._fake.appendChild(h.ele),c=h.ele}const l=this._fake.children;o<l.length&&l.slice(o).forEach((e=>{e.remove(),Ce(e)})),Me(this._fake.parentNode).refresh()},init(){if(this._bindend)return;this._bindend=!0;const e=this._fake=new Ee("x-fill");this.before(e),e.init(),this.remove(),this.refreshValue()}},ready(){this._name=this.attr("name"),this.ele._bindingRendered?this.init():this.one("binding-rendered",(()=>this.init()))}});const Te=(e,t,r,n,s)=>{const i=Pe(r.innerHTML),a=new H({$data:e,$ele:i,$host:n,$index:s});J({target:i.ele,data:a,temps:t,$host:n,isRenderSelf:!0});const o=i.ele.__revokes,c=()=>{p(o,c),a.revoke()};return o.push(c),i.__item=a,i.ele._data_xid=e.xid,i},{defineProperties:Ae}=Object,Oe=({_this:e,ele:t,proxySelf:r})=>{const n={owner:{get(){const{parentNode:r}=t,{_owner:n}=e,s=r?[Me(r),...n]:[...n];return new Set(s)}},ele:{get:()=>t}},s=t.tagName&&t.tagName.toLowerCase();s&&(n.tag={enumerable:!0,value:s}),Ae(e,n),(e=>{const{tag:t}=e;if(he.has(t))switch(le(["type","name","disabled"],e),t){case"input":ue(e);break;case"textarea":le(["value"],e),de(e,{name:"value",type:"input"});break;case"option":le(["selected","value"],e);break;case"select":le(["value"],e),de(e,{name:"value",type:"change"})}})(r)};class Se extends ie{constructor({ele:e}){super();const t=C.call(this,{},F);return Oe({_this:this,ele:e,proxySelf:t}),e.__xhear__=t,t}get length(){return this.ele&&this.ele.children.length}$(e){let{ele:t}=this;t instanceof HTMLTemplateElement&&(t=t.content);const r=t.querySelector(e);return r?Me(r):null}all(e){return m(this.ele,e).map(Me)}extend(e,t){return o(this,e,t)}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get classList(){return this.ele.classList}get data(){return this.ele.dataset}get shadow(){return Me(this.ele.shadowRoot)}get root(){const e=this.ele.getRootNode();return e?Me(e):null}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t instanceof Node?Me(t):null}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?Me(e):null}get parents(){const e=[];let t=this;for(;t.parent;)t=t.parent,e.push(t);return e}get next(){const e=this.ele.nextElementSibling;return e?Me(e):null}after(e){const{next:t}=this;t?t.before(e):this.parent.push(e)}get nexts(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r>t))}get prev(){const e=this.ele.previousElementSibling;return e?Me(e):null}before(e){const t=Pe(e);this.parent.ele.insertBefore(t.ele,this.ele)}get prevs(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r<t))}get siblings(){return this.parent.filter((e=>e!==this))}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get style(){return this.ele.style}get width(){return parseInt(getComputedStyle(this.ele).width)||0}get height(){return parseInt(getComputedStyle(this.ele).height)||0}get clientWidth(){return this.ele.clientWidth}get clientHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}is(e){return f(this.ele,e)}remove(){const{parent:e}=this;e.splice(e.indexOf(this),1)}clone(e=!0){return Me(this.ele.cloneNode(e))}wrap(e){const t=Pe(e),{ele:r}=this;if(!r.parentNode)throw"The target has a sibling element, so you can't use unwrap";return r.parentNode.insertBefore(t.ele,r),r.__internal=1,t.ele.appendChild(r),delete r.__internal,this}unwrap(){const{ele:e}=this,t=e.parentNode;if(t.children.length>1)throw"The element itself must have a parent";return e.__internal=1,t.parentNode.insertBefore(e,t),t.remove(),delete e.__internal,this}}const Le=H.prototype,je=Se.prototype;je.extend({get:Le.get,set:Le.set,toJSON:Le.toJSON,toString:Le.toString,...k,...ee,...Z,...Q,...pe},{enumerable:!1}),je.extend(_e);const Me=e=>e?e.__xhear__?e.__xhear__:new Se({ele:e}):null,Ne=document.createElement("template"),Pe=(e,t)=>{if(e instanceof Se)return e;if(e instanceof Node||e===window)return Me(e);switch(n(e)){case"object":return(e=>{const t={...e};if(!e.tag)return null;const r=document.createElement(e.tag);delete t.tag;const n=Me(r);return Object.assign(n,t),n})(e);case"string":return(e=>{Ne.innerHTML=e;const t=Ne.content.children[0]||Ne.content.childNodes[0];return Ne.innerHTML="",Me(t)})(e)}},Ce=e=>{e.__revokes&&Array.from(e.__revokes).forEach((e=>e&&e())),e.childNodes&&Array.from(e.childNodes).forEach((e=>{Ce(e)}));const t=e?.shadowRoot?.__revokes;t&&[...t].forEach((e=>e()))};function He(e){if("string"===n(e)&&!/<.+>/.test(e)){const t=document.querySelector(e);return Me(t)}return Pe(e)}function Re(e,t){const[r,...n]=e.split(" "),s=t?new URL(t,location.href):location.href;if(r.startsWith("http://")||r.startsWith("https://"))return r;const i=new URL(r,s);return n.length?`${i.href} ${n.join(" ")}`:i.href}function De(e,t){m(e,"[href],[src]").forEach((e=>{["href","src"].forEach((r=>{const n=e.getAttribute(r);/^#/.test(n)||n&&!/^(https?:)?\/\/\S+/.test(n)&&e.setAttribute(r,Re(n,t))}))}))}function Ie(e,t){const r=document.createElement("template");return r.innerHTML=e,De(r.content,t),m(r.content,"style").forEach((e=>{const r=e.innerHTML;e.innerHTML=r.replace(/url\((.+)\)/g,((e,r)=>`url(${Re(r,t)})`))})),r.innerHTML}Object.defineProperties(He,{extensions:{value:{}}}),Object.assign(He,{stanz:ae,render:J,convert:X,register:be,fn:Se.prototype,all:e=>m(document,e).map(Me)});const Ue=Symbol("loadError"),Fe=async e=>{const t=lm({url:e}),r=[];let n,s,i,a=e;for(;;){try{n=await t(a)}catch(e){let t;t=s?new Error(`${s} request to parent page(${a}) fails; \n  ${e.stack}`):new Error(`Request for ${a} page failed; \n  ${e.stack}`),t.error=e,i=t,console.error(i)}if(i){r.unshift({src:e,ISERROR:Ue,error:i});break}if(r.unshift({src:a,defaults:n}),!n.parent)break;s=a,a=new URL(n.parent,a).href}return r},Be=(e,t)=>{const r=document.createElement("div");r.innerHTML=`<o-page src="${e}"></o-page>`;const n=$(r.children[0]);return n._pause_init=1,a((()=>{n._renderDefault(t),delete n._pause_init})),n};function We(e,t,r,n){let s=e.host.root.$(`[inject-host="${t}"]`);if(s)return s.ele.__items.add(n),void(n.__host_link=s);s=r(),s.attr("inject-host",t),s.ele.__items=new Set([n]),n.__host_link=s,e.host.root.push(s)}function qe(e){if(e.__inited){const t=e.__host_link.ele.__items;t.delete(e),t.size||e.__host_link.remove(),delete e.__inited}}He.register({tag:"inject-host",temp:"<slot></slot>",data:{},proto:{init(){this.ele.isConnected&&this.forEach((e=>this._init(e)))},_init(e){if(!e.ele.__inited)switch(e.tag){case"link":this._initLink(e);break;case"style":this._initStyle(e);break;case"x-if":case"x-else-if":case"x-else":case"x-fill":break;default:console.log("This element will be invalidated within the inject-host",e)}},_initLink(e){const t=e.attr("href"),r=e.attr("rel");if("stylesheet"!==r&&"host"!==r)throw'The "rel" attribute of the "link" tag within "inject-host" can only use "stylesheet" as its value.';let{ele:n}=e;"host"!==r&&(e.attr("rel","host"),e.attr("href",t)),n.__inited=!0,n._revoke=()=>{qe(n),n._revoke=null},We(this,t,(()=>{const t=e.clone();return t.attr("rel","stylesheet"),t}),n)},async _initStyle(e){const t=new Comment(e.html);t.__inited=t,t._revoke=()=>{qe(e.ele),delete t.__inited,delete e.ele.__inited,t._revoke=null,e.ele._revoke=null},e.html="",e.push(t),e.ele.__inited=!0,e.ele._revoke=t._revoke;We(this,await async function(e,t="SHA-256"){const r=(new TextEncoder).encode(e),n=await crypto.subtle.digest(t,r);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.data),(()=>He(`<style>${t.data}</style>`)),e.ele)}},attached(){(this._obs=new MutationObserver((e=>{for(let t of e)if("attributes"===t.type){if("x-bind-data"===t.attributeName)continue;const{target:e}=t;e.__inited&&(e._revoke(),this._init(Me(e)))}else"childList"===t.type&&(t.removedNodes.forEach((e=>{e.__inited&&e._revoke()})),t.addedNodes.forEach((e=>{if(!e.__inited){if(e instanceof Text&&"STYLE"===e.parentElement.tagName&&this.init(e.parentNode),e.__inited)return;if(e instanceof Text||e instanceof Comment)return;this._init(Me(e))}})))}))).observe(this.ele,{attributes:!0,childList:!0,subtree:!0}),this.init()},detached(){this.forEach((e=>qe(e.ele))),this._obs.disconnect()}});class Ve{constructor(){this._middlewares=new Map}use(e){const t=Math.random().toString(32).slice(2);return this._middlewares.set(t,e),t}unuse(e){return this._middlewares.delete(e)}async run(e){let t=-1;const r=Array.from(this._middlewares.values()),n=async()=>{t++,t<r.length&&await r[t](e,n)};await n()}}const Je={},ze=(e,t)=>{(Je[e]||(Je[e]=new Ve)).use(t)},Ke=(e,t)=>{e instanceof Function&&(t=e,e=["js","mjs"]),e instanceof Array?e.forEach((e=>{ze(e,t)})):ze(e,t)};Ke(["mjs","js"],(async(e,t)=>{if(!e.result){const{url:t,params:r}=e,n=new URL(t),s=/^blob:/.test(t)||/^data:/.test(t);try{s||r.includes("-direct")?e.result=await import(t):e.result=await import(`${n.origin}${n.pathname}`)}catch(r){const n=new Error(`Failed to load module ${s?"":":"+t} \n  ${r.stack}`);throw n.error=r,s&&console.log("Failed to load module:",e),n}}await t()})),Ke(["txt","html","htm"],(async(t,r)=>{if(!t.result){const{url:r}=t;let n;try{n=await fetch(r)}catch(e){const t=new Error(`Load ${r} failed \n  ${e.stack}`);throw t.error=e,t}if(!/^2.{2}$/.test(n.status))throw new Error(`Load ${r} failed: status code ${e.status}`);t.result=await n.text()}await r()})),Ke("json",(async(e,t)=>{if(!e.result){const{url:t}=e;e.result=await fetch(t).then((e=>e.json()))}await t()})),Ke("wasm",(async(e,t)=>{if(!e.result){const{url:t}=e,r=await fetch(t).then((e=>e.arrayBuffer())),n=await WebAssembly.compile(r),s=new WebAssembly.Instance(n);e.result=s.exports}await t()})),Ke("css",(async(e,t)=>{if(!e.result){const{url:t,element:r}=e;if(r){const e=document.createElement("link");e.rel="stylesheet",e.href=t;const n=r.getRootNode();let s;n===document?n.head.append(e):n.appendChild(e),r.addEventListener("disconnected",s=t=>{e.remove(),r.removeEventListener("disconnected",s)})}else e.result=await fetch(t).then((e=>e.text()))}await t()}));const Ge=Symbol("loaded"),Xe=async(e,t)=>{const r=new URL(e),{pathname:n}=r;let s;t.params&&t.params.forEach((e=>{/^\..+/.test(e)&&(s=e.replace(/^\.(.+)/,"$1"))})),s||(s=n.slice(2+(n.lastIndexOf(".")-1>>>0)));const i={url:e,result:null,...t},a=Je[s];if(a?await a.run(i):i.result=fetch(e),t&&t.element){const{element:e}=t;e[Ge]=!0;const r=new Event("load");e.dispatchEvent(r)}return t.params&&t.params.includes("-ctx")?i:i.result};function Ye(e){return(e=>(e||(e={url:document.location.href}),t=>{let r="";const[n,...s]=t.split(" ");if(e.resolve)r=e.resolve(n);else{const t=new URL(e.url);r=new URL(n,t).href}return Xe(r,{params:s})}))(e)}Object.assign(Ye,{use:Ke});class Ze extends HTMLElement{constructor(...e){super(...e),this[Ge]=!1,Object.defineProperties(this,{loaded:{get:()=>this[Ge]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let e=this.getAttribute("src");if(!e)return;this.__initSrc=e,e=new URL(e,location.href).href,Object.defineProperties(this,{src:{configurable:!0,value:e}});const[t,...r]=e.split(" ");Xe(t,{element:this,params:r})}connectedCallback(){const e=new CustomEvent("connected");e.root=this._root=this.getRootNode(),this.dispatchEvent(e)}disconnectedCallback(){const e=new CustomEvent("disconnected");e.root=this._root,delete this._root,this.dispatchEvent(e)}attributeChangedCallback(e,t,r){"src"===e?r&&null===t?this._init():this.__initSrc&&t&&r!==this.__initSrc&&(console.warn(`${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`),this.setAttribute("src",this.__initSrc)):"pause"===e&&null===r&&this._init()}static get observedAttributes(){return["src","pause"]}}class Qe extends Ze{constructor(...e){super(...e)}}const et=()=>{customElements.define("load-module",Ze),customElements.define("l-m",Qe),window.removeEventListener("load",et)};"complete"===document.readyState?et():window.addEventListener("load",et),window.lm=Ye,B.render=e=>{const{step:t,name:r,target:n}=e,{link:s}=He.extensions;if("init"===t)n.host&&s&&He(n).all("a").forEach((e=>s(e)));else if("attr"===r&&"refresh"===t&&""===n.attr("olink")){const e=n.parents.pop()||n;if(e.__fixLinkTimer)return;e.__fixLinkTimer=a((()=>{const{host:t}=n;t&&"o-page"===t.tag&&De(e.ele,t.src),s&&He(e).all("a").forEach((e=>s(e))),delete e.__fixLinkTimer}))}};const tt=e=>{const t=He(e);t.on("click",(e=>{if(e.__processed)return;const{target:r}=e;if(r.attributes.hasOwnProperty("olink"))if(t.app){if(e.metaKey||e.shiftKey)return;e.preventDefault();let n=!1;if(e.preventDefault=()=>{n=!0},e.__processed=!0,"A"===r.tagName){const e=r.getAttribute("origin-href");setTimeout((()=>{!n&&t.app.goto(e||r.href)}))}}else console.warn("olink is only allowed within o-apps")}))},rt=async(e,t,r=!0)=>{const n=new File([e],"genfile",{type:"js"===t?"text/javascript":"application/json"});if(!r)return URL.createObjectURL(n);return await new Promise((e=>{const t=new FileReader;t.onload=t=>{e(t.target.result)},t.readAsDataURL(n)}))},nt=new Map;async function st(e,t,r=!0){let n=nt.get(t);if(n)return n;let s=!0;$.hasOwnProperty("debugMode")&&(s=$.debugMode);const i=$("<template></template>");i.html=e;const a=i.$("title"),o=i.$(`template[${r?"page":"component"}]`),c=o.$("script");c&&c.remove();const l=`\n  export const type = ${r?"$.PAGE":"$.COMP"};\n  export const PATH = '${t}';\n  ${r&&a?`export const title = '${a.text}';`:""}\n  export const temp = \`${o.html.replace(/\s+$/,"").replace(/`/g,"\\`").replace(/\$\{/g,"\\${")}\`;`;let h="";c&&(c.html.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,"").replace(/(import [\s\S]+?from .+);?/g,(e=>e.replace(/([\s\S]+?from )([\s\S]+);?/,((t,r,n)=>{if((!/`/.test(n)||/\$\{.*\}/.test(n))&&!/['"]/.test(n))throw new Error(`Unable to parse addresses of strings with variables: ${e}`)})))),h=c.html.replace(/([\s\S]+?from )['"](.+?)['"]/g,((e,r,n)=>`${r}"${Re(n,t)}";`)));const d=`${l};\n${h}`;let u="";s&&(u=`//# sourceMappingURL=${await(async(e,t,r)=>{const n=t.split("\n");let s="";for(let e=0;e<=r;e++)s+=";";const i=n.findIndex((e=>"<script>"===e.trim())),a=n.findIndex((e=>"<\/script>"===e.trim()));let o=0,c=0;for(let e=i+1;e<a;e++){const t=n[e];let r="";Array.from(t).forEach(((t,n)=>{const s=`AA${at(e-o)}${at(n-c)}`;r?r+=`,${s}`:r=s,o=e,c=n})),s+=`${r};`}const l=`{"version": 3,\n    "file": "${e.replace(/.+\/(.+?)/,"$1").replace(".html",".js")}",\n    "sources": ["${e}"],\n    "mappings": "${s}"}`;return await rt(l,null)})(t,e,l.split("\n").length)}`);const f=`${d}\n${u}`,p=navigator.userAgent.includes("Firefox");return n=rt(f,"js",!p),nt.set(t,n),n}const it="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function at(e){let t="",r=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{let e=31&r;r>>>=5,r>0&&(e|=32),t+=it[e]}while(r>0);return t}const ot=Symbol("Page");Object.defineProperty(He,"PAGE",{value:ot}),Ye.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +page *>/.test(r)&&!n.includes("-ignore-temp")){try{const t=await st(r,e.url);e.result=await Ye()(`${t} .mjs`)}catch(t){const r=new Error(`Error loading Page module: ${e.url}\n ${t.stack}`);throw r.error=t,r}e.resultContent=r}await t()})),Ye.use(["js","mjs"],(async(e,t)=>{const{result:r,url:n}=e;if("object"!=typeof r||r.type!==ot)return void await t();const s=await lt(r,n);let i=s.temp;/<.+>/.test(i)||(i=i?Re(i,n):n.replace(/\.m?js.*/,".html"),await(async(e,{self:t,desc:r,...n})=>{try{await e()}catch(e){const s=new Error(`${r}\n  ${e.stack}`);throw s.error=e,t.emit("error",{data:{error:s,...n}}),s}})((async()=>{s.temp=await fetch(i).then((e=>e.text()))}),{targetModule:import.meta.url,desc:`${n} module request for ${i} template page failed`})),e.result=s,await t()})),He.register({tag:"o-page",attrs:{src:null},watch:{async src(e){if(!e||e.startsWith("//")||/[a-z]+:\/\//.test(e)||(e=Re(e),this.ele.setAttribute("src",e)),this.__init_src){if(this.__init_src!==e)throw"A page that has already been initialized cannot be set with the src attribute";return}if(!e)return;if(this.__init_src=e,this._defaults||this._pause_init)return;const t=await Fe(e),r=t.pop();if(t.forEach(((e,t)=>{const r=Be(e.src,e.defaults);if(this.parent)this.wrap(r);else{(this.__need_wraps||(this.__need_wraps=[])).push(r)}})),r.ISERROR===Ue){const t=ht(e,r,this?.app?._module?.fail);this._renderDefault({type:ot,temp:t})}else this._renderDefault(r.defaults)}},attached(){this.css.display="block";const e=this.__need_wraps;e&&(e.forEach((e=>{this.wrap(e)})),delete this.__need_wraps),this.__not_run_attached&&(this._defaults.attached&&this._defaults.attached.call(this),delete this.__not_run_attached)},detached(){const{_defaults:e}=this;e&&e.detached&&e.detached.call(this)},proto:{async _renderDefault(e){const{src:t}=this;if(this._defaults)throw"The current page has already been rendered";if(this._defaults=e,e.pageAnime&&(this._pageAnime=e.pageAnime),!e||e.type!==ot){const e=new Error(`The currently loaded module is not a page \nLoaded string => '${t}'`);throw this.emit("error",{data:{error:e}}),this.__reject(e),e}const r=document.createElement("template");r.innerHTML=Ie(e.temp,t);const n=X(r);try{we({defaults:e,ele:this.ele,template:r,temps:n})}catch(e){const r=new Error(`Failed to render page:${t} \n ${e.stack}`);r.error=e,console.error(r)}await ct(this,e.loaded),tt(this.shadow),this._loaded=!0,this.emit("page-loaded"),this.__resolve(),this.ele.isConnected?e.attached&&e.attached.call(this):this.__not_run_attached=1},back(){this.app.back()},goto(e){this.app.goto(Re(e,this.src))},replace(e){this.app.replace(Re(e,this.src))},get pageAnime(){const{app:e,_pageAnime:t}=this,{pageAnime:r}=e?._module||{};return n={...r,...t||{}},JSON.parse(JSON.stringify(n));var n},set pageAnime(e){this._pageAnime=e}},ready(){this._rendered=new Promise(((e,t)=>{this.__resolve=()=>{delete this.__resolve,delete this.__reject,e()},this.__reject=()=>{delete this.__resolve,delete this.__reject,t()}}))}});const ct=async(e,t)=>{const r=e.ele.shadowRoot;if(r){const e=m(r,"l-m,load-module");await Promise.all(e.map((e=>new Promise((t=>{e.addEventListener("load",(e=>{t()}))})))))}t&&t.call(e)},lt=async(e,t)=>{let r={};const{default:n,PATH:s}=e,i=s||t,a=Ye({url:i});h(n)?r=await n({load:a,url:i,get query(){const e=new URL(i);return Object.fromEntries(Array.from(e.searchParams.entries()))}}):n instanceof Object&&(r={...n});return{proto:{},...e,...r}},ht=(e,t,r)=>{let n;return n=r?r({src:e,error:t.error}):`<div style="padding:20px;color:red;">${t.error.stack.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;")}</div>`,n},dt=Symbol("Component"),ut=Symbol("PATH");Object.defineProperty(He,"COMP",{value:dt});const ft={};Ye.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +component *>/.test(r)&&!n.includes("-ignore-temp")){try{const t=await st(r,e.url,!1);e.result=await Ye()(`${t} .mjs`)}catch(t){throw new Error(`Error loading Component module: ${e.url}\n ${t.stack}`)}e.resultContent=r}await t()})),Ye.use(["js","mjs"],(async({result:e,url:t},r)=>{if("object"!=typeof e||e.type!==dt)return void r();let n={};const{default:s,PATH:i}=e,a=i||t;h(s)?n=await s({load:Ye({url:a})}):s instanceof Object&&(n={...s});const{tag:o,temp:c}={...e,...n};let l=o;const d=a.match(/\/([^/]+)\.m?(js|htm|html)$/);l||d&&(l=u(d[1]));const f=ft[l];if(f){if(a!==f)throw`${l} components have been registered`;return void await r()}let p,m;ft[l]=a,/<.+>/.test(c)?(p=a,m=c):(p=Re(c||`${d[1]}.html`,a),m=await fetch(p).then((e=>e.text())));const g={...e,...n},_=g.ready,{loaded:y}=g;g.ready=async function(...e){_&&_.apply(this,e),y&&ct(this,y),tt(this.shadow)};const w=g.created;g.created=function(...e){this[ut]=g.PATH,w&&w.call(this,...e)};const b=Ie(m,i||p);He.register({...g,tag:l,temp:b}),await r()}));const pt="_history",mt=async({src:e,_this:t})=>{const{loading:r,fail:n}=t._module||{},s=[];let i,a,o=t.current;if(o){let e=o;do{s.unshift({page:e,src:e.src}),o=e,e=e.parent}while("o-page"===e.tag)}r&&(a=Pe(r()),t.push(a));let c=t;const l=await Fe(e),h=[];let d=-1;const u=s.length-1;s.some(((e,t)=>l[t].src!==e.src||t===u||(h.push(e),d=t,!1)));let f,p=l;return d>=0&&(c=h.slice(-1)[0].page,o=c.slice(-1)[0],p=l.slice(d+1)),p.some((t=>{const{defaults:r,ISERROR:s}=t;if(s===Ue){const r=ht(e,t,n);return i=Be(t.src,{type:He.PAGE,temp:r}),!1}const a=Be(t.src,r);f||(i=a),f&&f.push(a),f=a})),a&&a.remove(),c.push(i),{current:i,old:o,publics:h}},gt=(e,t,r)=>{if(t&&t.length){const{current:n}=e;t.forEach((e=>{const{page:t}=e,{routerChange:s}=t._defaults;s&&s.call(t,{type:r,current:n})}))}};He.register({tag:"o-app",temp:"<style>:host{position:relative;display:block}::slotted(*){display:block;width:100%;height:100%;}</style><slot></slot>",attrs:{src:null},data:{[pt]:[]},watch:{async src(e){if(this.__init_src){if(this.__init_src!==e)throw"The App that has already been initialized cannot be set with the src attribute";return}if(!e)return;this.__init_src=e;let t=e;!e||e.startsWith("//")||/[a-z]+:\/\//.test(e)||(t=Re(e));const r=lm(),n=await r(t),s=await lt(n,t);if(this._module=s,!this._settedRouters&&(this.extend(s.proto),s.ready&&s.ready.call(this),!this.$("o-page")&&!this._initHome&&s.home)){const e=new URL(s.home,t).href;this.push(`<o-page src="${e}"></o-page>`)}}},proto:{async back(e=1){if(!this[pt].length)return void console.warn("It's already the first page, can't go back");e=e<this[pt].length?e:this[pt].length;const t=this[pt].splice(-e)[0];let{current:r,old:n,publics:s}=await mt({src:t.src,_this:this});_t({page:r,key:"previous"}),n=bt(n),this.emit("router-change",{data:{name:"back",delta:e}}),gt(this,s,"back"),await yt({page:n,key:"next"}),n.remove()},async _navigate({type:e,src:t}){const{current:r}=this;t=new URL(t,location.href).href,r||(this._initHome=t);let{current:n,old:s,publics:i}=await mt({src:t,_this:this});_t({page:n,key:"next"}),s=bt(s),"goto"===e&&r&&this[pt].push({src:r.src}),this.emit("router-change",{data:{name:e,src:t}}),gt(this,i,e),r&&(await yt({page:s,key:"previous"}),s.remove())},goto(e){return this._navigate({type:"goto",src:e})},replace(e){return this._navigate({type:"replace",src:e})},get current(){return this.all("o-page").slice(-1)[0]},get routers(){let{current:e}=this;if(!e)return[];return[...this[pt],{src:e.src}]},set routers(e){e=e.map((e=>({src:e.src}))),this._settedRouters=1,this.html="";const t=e.slice(),r=t.pop();this[pt].length=0,this[pt].push(...t),this.push({tag:"o-page",src:r.src})}}});const _t=({page:e,key:t})=>{const{pageAnime:r}=e,n=r[t];n&&(e.css={...e.css,...n},wt((()=>{e.css={...e.css,transition:"all ease .3s",...r.current||{}}})))},yt=({page:e,key:t})=>new Promise((r=>{const n=e.pageAnime[t];n?wt((()=>{e.one("transitionend",r),e.css={...e.css,transition:"all ease .3s",...n}})):r()})),wt=e=>requestAnimationFrame((()=>{setTimeout(e,5)})),bt=e=>(e.css={position:"absolute",width:`${e.width}px`,height:`${e.height}px`},e),vt=He.fn.attr;function kt(...e){let[t,r,n]=e;h(r)&&(r=r());const{host:s}=this;if(s&&["href","src"].includes(t)&&/^\./.test(r)){const{PATH:e}=s;if(e){const{href:n}=new URL(r,e);return vt.call(this,t,n)}}return vt.call(this,...e)}if(kt.always=vt.always,He.fn.extend({get app(){let e=this;for(;e&&"o-app"!==e;){if("o-page"===e.tag){const t=e.parents.find((e=>"o-app"===e.tag));if(t){e=t;break}}if(e=e.host,!e)break}return e},get PATH(){return this[ut]||this.src||null},attr:kt}),document.currentScript){const e=document.currentScript.attributes.hasOwnProperty("debug");Object.defineProperty(He,"debugMode",{value:e})}"undefined"!=typeof window&&(window.$=He);export{He as default};
//# sourceMappingURL=ofa.min.mjs.map
