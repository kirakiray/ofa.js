//! ofa - v4.0.0 https://github.com/kirakiray/ofa.js  (c) 2018-2023 YAO
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).$=t()}(this,(function(){"use strict";class e{constructor(){this._middlewares=new Map}use(e){const t=Math.random().toString(32).slice(2);return this._middlewares.set(t,e),t}unuse(e){return this._middlewares.delete(e)}async run(e){let t=-1;const r=Array.from(this._middlewares.values()),n=async()=>{t++,t<r.length&&await r[t](e,n)};await n()}}const t={},r=(r,n)=>{(t[r]||(t[r]=new e)).use(n)},n=(e,t)=>{e instanceof Function&&(t=e,e=["js","mjs"]),e instanceof Array?e.forEach((e=>{r(e,t)})):r(e,t)};n(["mjs","js"],(async(e,t)=>{const{url:r,params:n}=e,s=new URL(r);n.includes("-direct")&&(e.result=await import(r)),e.result=await import(`${s.origin}${s.pathname}`),t()})),n(["txt","html"],(async(e,t)=>{const{url:r}=e;e.result=await fetch(r).then((e=>e.text())),t()})),n("json",(async(e,t)=>{const{url:r}=e;e.result=await fetch(r).then((e=>e.json())),t()})),n("wasm",(async(e,t)=>{const{url:r}=e,n=await fetch(r).then((e=>e.arrayBuffer())),s=await WebAssembly.compile(n),a=new WebAssembly.Instance(s);e.result=a.exports,t()}));const s=Symbol("loaded"),a=async(e,r)=>{const n=new URL(e),{pathname:a}=n,i=a.slice(2+(a.lastIndexOf(".")-1>>>0)),o={url:e,result:null,...r},c=t[i];if(c?await c.run(o):o.result=fetch(e),r&&r.element){const{element:e}=r;e[s]=!0;const t=new Event("load");e.dispatchEvent(t)}return o.result};function i(e){return(e=>(e||(e={url:document.location.href}),t=>{let r="";const[n,...s]=t.split(" ");if(e.resolve)r=e.resolve(n);else{const t=new URL(e.url);r=new URL(n,t).href}return a(r,{params:s})}))(e)}Object.assign(i,{use:n});class o extends HTMLElement{constructor(...e){super(...e),this[s]=!1,Object.defineProperties(this,{loaded:{get:()=>this[s]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let e=this.getAttribute("src");if(!e)return;this.__initSrc=e,e=new URL(e,location.href).href,Object.defineProperties(this,{src:{configurable:!0,value:e}});const[t,...r]=e.split(" ");a(t,{element:this,params:r})}connectedCallback(){const e=new CustomEvent("connected");e.root=this._root=this.getRootNode(),this.dispatchEvent(e)}disconnectedCallback(){const e=new CustomEvent("disconnected");e.root=this._root,delete this._root,this.dispatchEvent(e)}attributeChangedCallback(e,t,r){"src"===e?r&&null===t?this._init():this.__initSrc&&t&&r!==this.__initSrc&&(console.warn(`${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`),this.setAttribute("src",this.__initSrc)):"pause"===e&&null===r&&this._init()}static get observedAttributes(){return["src","pause"]}}class c extends o{constructor(...e){super(...e)}}const l=()=>{customElements.define("load-module",o),customElements.define("l-m",c),window.removeEventListener("load",l)};"complete"===document.readyState?l():window.addEventListener("load",l),window.lm=i;const h=()=>Math.random().toString(32).slice(2),u=Object.prototype.toString,d=e=>u.call(e).toLowerCase().replace(/(\[object )|(])/g,""),p=e=>{const t=d(e);return"array"===t||"object"===t},f=new Set;function g(e){const t=`t-${h()}`;return f.add(t),Promise.resolve().then((()=>{f.has(t)&&(e(),f.delete(t))})),t}const m=(e,t,r={})=>([...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)].forEach((n=>{const s=Object.getOwnPropertyDescriptor(t,n),{configurable:a,enumerable:i,writable:o,get:c,set:l,value:h}=s;"value"in s?e.hasOwnProperty(n)?e[n]=h:Object.defineProperty(e,n,{enumerable:i,configurable:a,writable:o,...r,value:h}):Object.defineProperty(e,n,{enumerable:i,configurable:a,...r,get:c,set:l})})),e),y=e=>d(e).includes("function"),_=e=>e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));const w=e=>e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),b=(e,t)=>{const r=document.createElement("template");return r.content.append(e.cloneNode()),!!r.content.querySelector(t)};function v(e,t,r){const n=e.indexOf(t);if(-1===n)throw new Error("Value not found in array");return e.splice(r,0,e.splice(n,1)[0]),e}const k=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},x=(e,t)=>Array.from(e.querySelectorAll(t)),{assign:E,freeze:O}=Object;class A{constructor(e){E(this,e),O(this)}_getCurrent(e){let{currentTarget:t}=this;if(/\./.test(e)){const r=e.split(".");e=r.pop(),t=t.get(r.join("."))}return{current:t,key:e}}hasModified(e){if("array"===this.type)return this.path.includes(this.currentTarget.get(e));if(/\./.test(e)){const{current:t,key:r}=this._getCurrent(e);return t===this.path.slice(-1)[0]?this.name===r:this.path.includes(t)}return this.path.length?this.path.includes(this.currentTarget[e]):this.name===e}hasReplaced(e){if("set"!==this.type)return!1;if(/\./.test(e)){const{current:t,key:r}=this._getCurrent(e);return t===this.path.slice(-1)[0]&&this.name===r}return!this.path.length&&this.name===e}}class S extends Array{constructor(e){super(...e)}hasModified(e){return this.some((t=>t.hasModified(e)))}hasReplaced(e){return this.some((t=>t.hasReplaced(e)))}}const T=({type:e,currentTarget:t,target:r,name:n,value:s,oldValue:a,args:i,path:o=[]})=>{if(o&&o.includes(t))return void console.warn("Circular references appear");let c={type:e,target:r,name:n,oldValue:a,value:s};if("array"===e&&(delete c.value,c.args=i),t._hasWatchs){const e=new A({currentTarget:t,...c,path:[...o]});t[D].forEach((t=>{t(e)}))}t._update&&t.owner.forEach((e=>{T({currentTarget:e,...c,path:[t,...o]})}))};var j={watch(e){const t="w-"+h();return this[D].set(t,e),t},unwatch(e){return this[D].delete(e)},watchTick(e,t){return this.watch(function(e,t=0){let r=null,n=[];return function(...s){n.push(...s),t>0?(clearTimeout(r),r=setTimeout((()=>{e.call(this,n),n=[],r=null}),t)):null===r&&(r=1,g((()=>{e.call(this,n),n=[],r=null})))}}((t=>{try{this.xid}catch(e){return}t=t.filter((e=>{try{e.path.forEach((e=>e.xid))}catch(e){return!1}return!0})),e(new S(t))}),t||0))}};const $=Symbol("placeholder");const L={},C=Array.prototype;["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"].forEach((e=>{C[e]&&(L[e]=function(...t){const r=Array.from(this),n=C[e].apply(this[P],t),{deletedItems:s,addedItems:a}=function(e,t){const r=Array.from(t),n=Array.from(e),s=[],a=new Map,i=e.length;for(let t=0;t<i;t++){const n=e[t],a=r.indexOf(n);a>-1?r[a]=$:s.push(n)}const o=t.length;for(let e=0;e<o;e++){const r=t[e],s=n.indexOf(r);s>-1?n[s]=$:a.set(e,r)}return{deletedItems:s,addedItems:a}}(r,this);for(let[e,t]of a)W(t)?t._owner.push(this):p(t)&&(this.__unupdate=1,this[e]=t,delete this.__unupdate);for(let e of s)q(e,this);return T({type:"array",currentTarget:this,target:this,args:t,name:e,oldValue:r}),n===this[P]?this[H]:n})}));const{defineProperties:M,getOwnPropertyDescriptor:N,entries:R}=Object,P=Symbol("self"),H=Symbol("proxy"),D=Symbol("watchs"),U=Symbol("isxdata"),W=e=>e&&!!e[U];function I(e,t=V){let r,{proxy:n,revoke:s}=Proxy.revocable(this,t);return n._update=1,M(this,{xid:{value:e.xid||h()},_owner:{value:[]},owner:{configurable:!0,get(){return new Set(this._owner)}},[U]:{value:!0},[P]:{configurable:!0,get:()=>this},[H]:{configurable:!0,get:()=>n},[D]:{get:()=>r||(r=new Map)},_hasWatchs:{get:()=>!!r},_revoke:{value:s}}),Object.keys(e).forEach((t=>{const r=N(e,t);let{value:s,get:a,set:i}=r;a||i?M(this,{[t]:r}):n[t]=s})),n}class J extends Array{constructor(e){return super(),I.call(this,e)}revoke(){const e=this[P];e._onrevokes&&(e._onrevokes.forEach((e=>e())),e._onrevokes.length=0),e.__unupdate=1,e[D].clear(),R(this).forEach((([e,t])=>{W(t)&&(this[e]=null)})),e._owner.forEach((e=>{R(e).forEach((([t,r])=>{r===this&&(e[t]=null)}))})),delete e[P],delete e[H],e._revoke()}toJSON(){let e={},t=!0,r=0;Object.keys(this).forEach((n=>{let s=this[n];/\D/.test(n)?t=!1:(n=parseInt(n))>r&&(r=n),W(s)&&(s=s.toJSON()),e[n]=s})),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return M(e,{xid:{get:()=>n}}),e}toString(){return JSON.stringify(this.toJSON())}extend(e,t){return m(this,e,t)}get(e){if(/\./.test(e)){const t=e.split(".");let r=this;for(let e=0,n=t.length;e<n;e++)try{r=r[t[e]]}catch(n){const s=new Error(`Failed to get data : ${t.slice(0,e).join(".")} \n${n.stack}`);throw Object.assign(s,{error:n,target:r}),s}return r}return this[e]}set(e,t){if(/\./.test(e)){const r=e.split("."),n=r.pop();let s=this;for(let e=0,t=r.length;e<t;e++)try{s=s[r[e]]}catch(t){const n=new Error(`Failed to get data : ${r.slice(0,e).join(".")} \n${t.stack}`);throw Object.assign(n,{error:t,target:s}),n}return s[n]=t}return this[e]=t}}J.prototype.extend({...j,...L},{enumerable:!1});const{defineProperties:B}=Object,F=({target:e,key:t,value:r,receiver:n,type:s,succeed:a})=>{let i=r;W(i)?i._owner.push(n):p(r)&&(i=new J(r),i._owner.push(n));const o=n[t],c=o===r;!c&&W(o)&&q(o,n);const l=a(i);return!c&&!e.__unupdate&&T({type:s||"set",target:n,currentTarget:n,name:t,value:r,oldValue:o}),l},q=(e,t)=>{if(W(e)){const r=e._owner.indexOf(t);r>-1?e._owner.splice(r,1):console.error({desc:"This data is wrong, the owner has no boarding object at the time of deletion",target:t,mismatch:e})}},V={set(e,t,r,n){if("symbol"==typeof t)return Reflect.set(e,t,r,n);if(/^_/.test(t))return e.hasOwnProperty(t)?Reflect.set(e,t,r,n):B(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0;try{return F({target:e,key:t,value:r,receiver:n,succeed:r=>Reflect.set(e,t,r,n)})}catch(e){const s=new Error(`failed to set ${t} \n ${e.stack}`);throw Object.assign(s,{key:t,value:r,target:n,error:e}),s}},deleteProperty:(e,t)=>/^_/.test(t)||"symbol"==typeof t?Reflect.deleteProperty(e,t):F({target:e,key:t,value:void 0,receiver:e[H],type:"delete",succeed:()=>Reflect.deleteProperty(e,t)})},z={set:(e,t,r,n)=>/\D/.test(t)?V.set(e,t,r,n):Reflect.set(e,t,r,n),get:(e,t,r,n)=>/\D/.test(String(t))?Reflect.get(e,t,r,n):je(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},K=e=>e.__revokes||(e.__revokes=[]),Y=(e,t)=>K(e).push(t),Z=(e,t)=>new Function("...$args",`\nconst [$event] = $args;\ntry{\n  with(this){\n    return ${e};\n  }\n}catch(error){\n  console.error(error);\n}\n`).bind(t);function G({data:e,target:t,template:r,temps:n,isRenderSelf:s,...a}){const i=r&&r.innerHTML;i&&(t.innerHTML=i);const o=x(t,"xtext"),c=[],l=K(t);o.forEach((t=>{const r=document.createTextNode(""),{parentNode:n}=t;n.insertBefore(r,t),n.removeChild(t);const s=Z(t.getAttribute("expr"),e),a=()=>{r.textContent=s()};c.push(a);const i=()=>{k(l,i),k(c,a),k(K(r),i)};l.push(i),Y(r,i)}));const h=x(t,"[x-bind-data]");if(s&&b(t,"[x-bind-data]")&&h.unshift(t),h.forEach((t=>{const r=JSON.parse(t.getAttribute("x-bind-data")),s=je(t);for(let[i,o]of Object.entries(r))o.forEach((r=>{try{const{always:o}=s[i],h=()=>s[i](...r,{isExpr:!0,data:e,temps:n,...a});let u;if(o)c.push(h),u=()=>{k(l,u),k(c,h),k(K(t),u)};else{const e=h();y(e)?u=()=>{k(l,u),k(K(t),u),e()}:console.warn(`${i} render method need return revoke`)}l.push(u),Y(t,u)}catch(e){const t=new Error(`Execution of the ${i} method reports an error :\n ${e.stack}`);throw t.error=e,t}}));t.removeAttribute("x-bind-data")})),t.__render_temps||function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)||(t.__render_temps=n),c.length){if(t.__render_data&&t.__render_data!==e){const r=new Error("An old listener already exists and the rendering of this element may be wrong");throw Object.assign(r,{element:t,old:t.__render_data,new:e}),r}t.__render_data=e,c.forEach((e=>e()));const r=e.watchTick((t=>{c.length?c.forEach((e=>e())):e.unwatch(r)}))}}function Q(e){let t={};const{tagName:r}=e;if("TEMPLATE"===r){let r=e.innerHTML;const n=r.match(/{{.+?}}/g);n&&(n.forEach((e=>{r=r.replace(e,`<xtext expr="${e.replace(/{{(.+?)}}/,"$1")}"></xtext>`)})),e.innerHTML=r);const s=e.getAttribute("name");s&&(e.content.children.length>1&&console.warn({target:e,content:e.innerHTML,desc:"Only the first child element inside the template will be used"}),t[s]=e,e.remove()),t={...t,...Q(e.content)}}else if(r){const t={};Array.from(e.attributes).forEach((r=>{const n=/(.*):(.+)/.exec(r.name);if(!n)return;let[,s,a]=n;s||(s="prop");(t[s]||(t[s]=[])).push([a,r.value]),e.removeAttribute(r.name)}));Object.keys(t).length&&e.setAttribute("x-bind-data",JSON.stringify(t))}return e.children&&Array.from(e.children).forEach((e=>{t={...t,...Q(e)}})),t}const X=e=>y(e)?e():e,ee={_convertExpr(e={},t){const{isExpr:r,data:n}=e;return r?Z(t,n):t},prop(...e){let[t,r,n]=e;if(1===e.length)return this[t];r=this._convertExpr(n,r),r=X(r),t=_(t),this[t]=r},attr(...e){let[t,r,n]=e;if(1===e.length)return this.ele.getAttribute(t);r=this._convertExpr(n,r),r=X(r),this.ele.setAttribute(t,r)}};ee.prop.always=!0,ee.attr.always=!0;var te={sync(e,t,r){if(!r)throw"Sync is only allowed within the renderer";const{data:n}=r;this[e]=n.get(t);const s=this.watch((r=>{r.hasModified(e)&&n.set(t,this.get(e))})),a=n.watch((r=>{r.hasModified(t)&&this.set(e,n.get(t))}));return()=>{this.unwatch(s),n.unwatch(a)}}},re={on(e,t,r){return t=r&&r.isExpr&&!/[^\d\w_\$\.]/.test(t)?r.data.get(t):this._convertExpr(r,t),r&&r.data&&(t=t.bind(r.data)),this.ele.addEventListener(e,t),r?()=>this.ele.removeEventListener(e,t):this},one(e,t,r){const n=r=>{this.off(e,n),t(r)};return this.on(e,n,r),this},off(e,t){return this.ele.removeEventListener(e,t),this},emit(e,t,r){let n;return e instanceof Event?n=e:e&&(n=new Event(e,{bubbles:!0,...r})),t&&Object.assign(n,t),this.ele.dispatchEvent(n),this}};const ne=(e,t,r,...n)=>{const{children:s}=e,a=[];for(let e=t,n=t+r;e<n;e++){const t=s[e];a.push(t)}if(a.forEach((e=>e.remove())),n.length){const r=document.createDocumentFragment();n.forEach((e=>r.append(Le(e).ele)));const a=s[t];a?e.insertBefore(r,a):e.appendChild(r)}return a},se=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],ae={push(...e){const{ele:t}=this;return ne(t,t.children.length,0,...e),T({type:"array",currentTarget:this,target:this,args:e,name:"push"}),t.children.length},pop(...e){const{ele:t}=this,r=ne(t,t.children.length-1,1,...e);return T({type:"array",currentTarget:this,target:this,args:e,name:"pop"}),je(r[0])},shift(...e){const{ele:t}=this,r=ne(t,0,1,...e);return T({type:"array",currentTarget:this,target:this,args:e,name:"shift"}),je(r[0])},unshift(...e){const{ele:t}=this;return ne(t,0,0,...e),T({type:"array",currentTarget:this,target:this,args:e,name:"unshift"}),t.children.length},splice(...e){const t=ne(this.ele,...e);return T({type:"array",currentTarget:this,target:this,args:e,name:"splice"}),t.map(je)},reverse(...e){const t=Array.from(this.ele.childNodes);ie.reverse.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.__inArray=1,r.append(e)})),this.ele.append(r),t.forEach((e=>{delete e.__inArray})),T({type:"array",currentTarget:this,target:this,args:e,name:"reverse"}),this},sort(...e){const t=Array.from(this.ele.children).map(je);ie.sort.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.ele.__inArray=1,r.append(e.ele)})),this.ele.append(r),t.forEach((e=>{delete e.ele.__inArray})),T({type:"array",currentTarget:this,target:this,args:e,name:"sort"}),this}},ie=Array.prototype;Object.keys(Object.getOwnPropertyDescriptors(ie)).forEach((e=>{if("constructor"===e||"length"===e||se.includes(e))return;const t=ie[e];y(t)&&(ae[e]=function(...e){return t.apply(Array.from(this.ele.children).map(je),e)})}));class oe{}for(let[e,t]of Object.entries(ae))Object.defineProperty(oe.prototype,e,{value:t});const ce=e=>new J(e);Object.assign(ce,{is:W});const{defineProperty:le,assign:he}=Object,ue=(e,t)=>{const{ele:r}=t;e.forEach((e=>{if(e in r){let n=!1;le(t,e,{enumerable:!0,get:()=>n?Number(r[e]):r[e],set:t=>{n="number"==typeof t,r[e]=t}})}}))},de=new Set(["input","textarea","select","option","button","label","fieldset","legend","form"]),pe=(e,t={})=>{const{name:r,type:n}=t,{ele:s}=e;let a=s[r];e.on(n,(()=>{T({type:"set",target:e,currentTarget:e,name:r,value:s[r],oldValue:a}),a=s[r]}))},fe=e=>{switch(e.attr("type")){case"file":ue(["multiple","files"],e),pe(e,{name:"files",type:"change"});break;case"checkbox":ue(["checked","multiple"],e),pe(e,{name:"checked",type:"change"});break;case"radio":ue(["checked"],e),pe(e,{name:"checked",type:"change"});break;default:ue(["placeholder","value"],e),pe(e,{name:"value",type:"input"})}},ge=(e,t)=>{const r={};return e.all(t).forEach((e=>{const{name:t,tag:n,ele:s}=e;if("input"===n)switch(e.type){case"checkbox":t in r||(r[t]=[]),s.checked&&r[t].push(s.value);break;case"radio":s.checked&&(r[t]=s.value);break;case"file":r[t]=s.files;break;default:r[t]=s.value}else if("textarea"===n)r[t]=s.value;else if("select"===n){const e=x(s,"option:checked");if(s.multiple)r[t]=e.map((e=>e.value||e.textContent));else{const[n]=e;r[t]=n.value||n.textContent}}else r[t]=e.value})),r};var me={formData(e,t={wait:200}){const r=ce({});return he(r,ge(this,e||"input,select,textarea")),this.watchTick((t=>{he(r,ge(this,e||"input,select,textarea"))}),t.wait),r}};const ye={},_e=({defaults:e,ele:t,template:r,temps:n})=>{const s={...e.data,...e.attrs},a=je(t);e.proto&&a.extend(e.proto,{enumerable:!1});for(let[e,t]of Object.entries(s))a.hasOwnProperty(e)||(a[e]=t);if(e.temp){const e=t.attachShadow({mode:"open"});e.innerHTML=r.innerHTML,G({target:e,data:a,temps:n})}if(e.ready&&e.ready.call(a),e.watch){const t=Object.entries(e.watch);a.watchTick((e=>{for(let[r,n]of t)e.hasModified(r)&&n.call(a,a[r],{watchers:e})}));for(let[e,r]of t)r.call(a,a[e],{})}},we=(e={})=>{const t={tag:"",temp:"",data:{},proto:{},...e};!function(e){if("-"===e.charAt(0)||"-"===e.charAt(e.length-1))throw new Error(`The string "${e}" cannot start or end with "-"`);for(let t=0;t<e.length-1;t++)if("-"===e.charAt(t)&&"-"===e.charAt(t+1))throw new Error(`The string "${e}" cannot have consecutive "-" characters`);if(!e.includes("-"))throw new Error(`The string "${e}" must contain at least one "-"`)}(t.tag);const r=(n=_(t.tag)).charAt(0).toUpperCase()+n.slice(1);var n;if(ye[r])throw`Component ${r} already exists`;const s=document.createElement("template");s.innerHTML=t.temp;const a=Q(s),i=e=>{let t;return t=e instanceof Array?[...e]:Object.keys(e),t},o=ye[r]=class extends HTMLElement{constructor(...e){super(...e);const r=je(this);if(t.created&&t.created.call(r),t.attrs){const e=i(t.attrs);r.watchTick((t=>{e.forEach((e=>{if(t.hasModified(e)){const t=r[e],n=w(e);null==t?this.removeAttribute(n):this.setAttribute(n,t)}}))}))}_e({defaults:t,ele:this,template:s,temps:a})}connectedCallback(){t.attached&&!be(this)&&t.attached.call(je(this))}disconnectedCallback(){t.detached&&!be(this)&&t.detached.call(je(this))}attributeChangedCallback(e,t,r){const n=je(this);/[^\d.]/.test(r)||"number"!=typeof n[e]||(r=Number(r)),n[_(e)]=r}static get observedAttributes(){return i(t.attrs||{}).map((e=>w(e)))}};customElements.define(t.tag,o)};function be(e){let t=e;for(;t;){if(t.__inArray)return!0;if(t=t.parentNode||t.host,!t||t.tagName&&"BODY"===t.tagName)break}return!1}function ve(e,t=!0){const r=[];let n=t?e.__marked_end:e.__marked_start;for(;;)if(n=t?n.nextSibling:n.previousSibling,n instanceof Comment)n.__$ele&&(r.push(n.__$ele),n=t?n.__end:n.__start);else if(!(n instanceof Text))break;return r}const ke={_getRenderData(){let e=this.__marked_end;for(;e&&!e.__render_data;)e=e.parentNode;return e?{target:e,data:e.__render_data,temps:e.__render_temps}:null},_renderMarked(){const{ele:e}=this,{parentNode:t}=e,r=`${this.tag}: ${this.__originHTML.trim().slice(0,20).replace(/\n/g,"")} ...`,n=document.createComment(r+" --start"),s=document.createComment(r+" --end");n.__end=s,s.__start=n,s.__$ele=n.__$ele=this,t.insertBefore(n,e),t.insertBefore(s,e),this.__marked_start=n,this.__marked_end=s,Object.defineProperties(e,{__revokes:{set(e){n.__revokes=e},get:()=>n.__revokes}})},_renderContent(){const e=this._getRenderData();if(!e)return;const{target:t,data:r,temps:n}=e,s=this.__marked_end,a=document.createElement("template");a.innerHTML=this.__originHTML,s.parentNode.insertBefore(a.content,s),G({target:t,data:r,temps:n})},_revokeRender(){const e=this.__marked_start;let t=this.__marked_end.previousSibling;for(;t&&t!==e;){Ce(t);const e=t;t=t.previousSibling,e.remove()}},_refreshCondition(){const e=[this];if(!this._refreshing){switch(this.tag){case"x-if":e.push(...ve(this));break;case"x-else-if":e.unshift(...ve(this,!1)),e.push(...ve(this))}e.forEach((e=>e._refreshing=!0)),g((()=>{let t=!1;e.forEach((e=>{if(delete e._refreshing,!t)return e.value||"x-else"===e.tag?(e._renderContent(),void(t=!0)):void e._revokeRender();e._revokeRender()}))}))}}},xe={tag:"x-if",data:{value:null},watch:{value(){this._refreshCondition()}},proto:ke,ready(){this.__originHTML=this.html,this.html="",this._renderMarked(),g((()=>this.ele.remove()))}};we(xe),we({...xe,tag:"x-else-if"}),we({tag:"x-else",proto:ke,ready:xe.ready});const Ee=(e,t,r,n)=>{const s=new J({$data:e,$host:n}),a=Le(t.innerHTML),{ele:i}=a;G({target:i,data:s,temps:r,$host:n,isRenderSelf:!0});const o=i.__revokes,c=()=>{k(o,c),s.revoke()};return o.push(c),{ele:i,itemData:s}};we({tag:"x-fill",data:{value:null},watch:{value(e){const t=this._getChilds();if(!e)return void(t&&t.forEach((e=>{Ce(e),e.remove()})));if(!(e instanceof Array))return console.warn(`The value of x-fill component must be of type Array, and the type of the current value is ${d(e)}`),void(t&&t.forEach((e=>{Ce(e),e.remove()})));const r=Array.from(e),n=t.map((e=>e.__render_data.$data));if(((e,t)=>{if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0})(n,r))return;const s=this._name,{data:a,temps:i}=this._getRenderData();if(!i)return;const o=i[_(s)],c=this.__marked_end,l=c.parentNode,h=t.slice(),u=a.$host||a;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=t[r];if(!a){const{ele:e}=Ee(s,o,i,u);l.insertBefore(e,c);continue}const h=a.__render_data.$data;if(s!==h)if(n.includes(s)){const e=t.find((e=>e.__render_data.$data===s));e.__inArray=1,l.insertBefore(e,a),delete e.__inArray,v(t,e,r)}else{const{ele:e}=Ee(s,o,i,u);l.insertBefore(e,a),t.splice(r,0,e)}}h.forEach(((e,t)=>{const s=n[t];r.includes(s)||(Ce(e),e.remove())}))}},proto:{_getRenderData:ke._getRenderData,_renderMarked:ke._renderMarked,_getChilds(){const e=[],{__marked_end:t,__marked_start:r}=this;if(!r)return[];let n=r;for(;n=n.nextSibling,n&&n!==t;)n instanceof Element&&e.push(n);return e}},ready(){this.__originHTML="origin",this._name=this.attr("name"),this._renderMarked(),g((()=>this.ele.remove()))}});const{defineProperties:Oe}=Object,Ae=({_this:e,ele:t,proxySelf:r})=>{const n={owner:{get(){const{parentNode:r}=t,{_owner:n}=e,s=r?[je(r),...n]:[...n];return new Set(s)}},ele:{get:()=>t}},s=t.tagName&&t.tagName.toLowerCase();s&&(n.tag={enumerable:!0,value:s}),Oe(e,n),(e=>{const{tag:t}=e;if(de.has(t))switch(ue(["type","name","disabled"],e),t){case"input":fe(e);break;case"textarea":ue(["value"],e),pe(e,{name:"value",type:"input"});break;case"option":ue(["selected","value"],e);break;case"select":ue(["value"],e),pe(e,{name:"value",type:"change"})}})(r)};class Se extends oe{constructor({ele:e}){super();const t=I.call(this,{},z);return Ae({_this:this,ele:e,proxySelf:t}),e.__xhear__=t,t}get length(){return this.ele.children.length}$(e){const t=this.ele.querySelector(e);return t?je(t):null}all(e){return x(this.ele,e).map(je)}extend(e,t){return m(this,e,t)}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get classList(){return this.ele.classList}get data(){return this.ele.dataset}get css(){return getComputedStyle(this.ele)}get shadow(){return je(this.ele.shadowRoot)}get root(){const e=this.ele.getRootNode();return e?je(e):null}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t?je(t):null}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?je(e):null}get parents(){const e=[];let t=this;for(;t.parent;)t=t.parent,e.push(t);return e}get next(){const e=this.ele.nextElementSibling;return e?je(e):null}get nexts(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r>t))}get prev(){const e=this.ele.previousElementSibling;return e?je(e):null}get prevs(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r<t))}get siblings(){return this.parent.filter((e=>e!==this))}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get style(){return this.ele.style}set style(e){if("string"==d(e))return void(this.ele.style=e);let{style:t}=this,r=Array.from(t),n=Object.keys(e);r.forEach((e=>{n.includes(e)||(t[e]="")})),Object.assign(t,e)}get width(){return parseInt(getComputedStyle(this.ele).width)}get height(){return parseInt(getComputedStyle(this.ele).height)}get clientWidth(){return this.ele.clientWidth}get clientHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}is(e){return b(this.ele,e)}remove(){this.ele.remove()}}const Te=J.prototype;Se.prototype.extend({get:Te.get,set:Te.set,toJSON:Te.toJSON,toString:Te.toString,...j,...re,...ee,...te,...me},{enumerable:!1});const je=e=>e?e.__xhear__?e.__xhear__:new Se({ele:e}):null,$e=document.createElement("template"),Le=(e,t)=>{if(e instanceof Se)return e;if(e instanceof Element)return je(e);switch(d(e)){case"object":return(e=>{const t={...e};if(!e.tag)return null;const r=document.createElement(e.tag);delete t.tag;const n=je(r);return Object.assign(n,t),n})(e);case"string":return(e=>{$e.innerHTML=e;const t=$e.content.children[0]||$e.content.childNodes[0];return $e.innerHTML="",je(t)})(e)}},Ce=e=>{e.__revokes&&Array.from(e.__revokes).forEach((e=>e&&e())),e.childNodes&&Array.from(e.childNodes).forEach((e=>{Ce(e)}))};function Me(e){if("string"===d(e)&&!/<.+>/.test(e)){const t=document.querySelector(e);return je(t)}return Le(e)}function Ne(e,t){const r=new URL(t);if(e.startsWith("/")||e.startsWith("http://")||e.startsWith("https://"))return e;return new URL(e,r).href}function Re(e,t){const r=document.createElement("template");return r.innerHTML=e,x(r.content,"[href],[src]").forEach((e=>{["href","src"].forEach((r=>{let n=e.getAttribute(r);n&&e.setAttribute(r,Ne(n,t))}))})),r.innerHTML}Object.assign(Me,{stanz:ce,render:G,convert:Q,register:we,fn:Se.prototype,all:e=>x(document,e).map(je)});const Pe=async(e,{self:t,desc:r})=>{try{await e()}catch(e){const n=new Error(`${r}\n  ${e.stack}`);throw n.error=e,t.emit("error",{error:n}),n}},He=async(e,t)=>{if(e.__init_src){if(e.__init_src!==t)throw"A page that has already been initialized cannot be set with the src attribute";return!1}if(!t)return!1;e.__init_src=t;const r=i(),n=await r(t);let s={};const{default:a}=n,o=Ne(t,document.location.href),c=i({url:o});y(a)?s=await a({load:c,url:o,get params(){const e=new URL(o);return Object.fromEntries(Array.from(e.searchParams.entries()))}}):a instanceof Object&&(s=a);const l={proto:{},...n,...s};return{selfUrl:o,defaults:l}};Me.register({tag:"o-page",attrs:{src:null},watch:{async src(e){let t;if(await Pe((async()=>{t=await He(this,e)}),{self:this,desc:`Request for ${e} module failed`}),!1===t)return;const{selfUrl:r,defaults:n}=t;let s=n.temp;s||(s=r.replace(/\.m?js.*/,".html")),await Pe((async()=>{n.temp=await fetch(s).then((e=>e.text()))}),{self:this,desc:`${r} module request for ${s} template page failed`});const a=document.createElement("template");a.innerHTML=Re(n.temp,s);const i=Q(a);_e({defaults:n,ele:this.ele,template:a,temps:i}),De(this,n.loaded)}},proto:{back(){this.app.back()},goto(e){this.app.goto(new URL(e,this.src).href)},replace(e){this.app.replace(new URL(e,this.src).href)},get pageAnime(){const{app:e,_pageAnime:t}=this,{pageAnime:r}=e?._module?.defaults||{};return n={...r,...t||{}},JSON.parse(JSON.stringify(n));var n},set pageAnime(e){this._pageAnime=e}}});const De=async(e,t)=>{const r=e.ele.shadowRoot;if(r){const e=x(r,"l-m,load-module");await Promise.all(e.map((e=>new Promise((t=>{e.addEventListener("load",(e=>{t()}))})))))}t&&t.call(e)},Ue=Symbol("Component");Object.defineProperty(Me,"COMP",{value:Ue}),i.use((async({result:e,url:t},r)=>{if("object"!=typeof e||e.type!==Ue)return;let n={};const{default:s}=e;y(s)?n=await s({load:i({url:t})}):s instanceof Object&&(n=s);const{tag:a,temp:o}={...e,...n};let c=a;const l=t.match(/\/([^/]+)\.m?js$/);let h;c||l&&(c=w(l[1])),h=Ne(o||(a?`${a}.html`:`${l[1]}.html`),t);const u=await fetch(h).then((e=>e.text())),d={...e,...n},p=d.ready,{loaded:f}=d;d.ready=async function(...e){p&&p.apply(this,e),f&&De(this,f)},Me.register({...d,tag:c,temp:Re(u,h)}),await r()}));const We=Symbol("history"),Ie=({self:e,src:t,type:r})=>{const{loading:n}=e._opts;let s="";return n&&(s=n({src:t,type:r})),s};Me.register({tag:"o-app",temp:"<style>:host{position:relative;display:block}::slotted(o-page){display:block;position:absolute;left:0;top:0;width:100%;height:100%}</style><slot></slot>",attrs:{src:"",_opts:{}},watch:{async src(e){const t=await He(this,e);if(!1===t)return;this._module=t;const{selfUrl:r,defaults:n}=t;this.extend(n.proto),n.ready&&n.ready.call(this);const{loading:s,fail:a}=n;this.on("error",(e=>{let t="";a&&(t=a({target:e.target,src:e.target.getAttribute("src"),error:e.error}));const r=document.createElement("template");r.innerHTML=t;const n=Q(r);_e({defaults:{temp:" "},ele:e.target,template:r,temps:n}),e.target.innerHTML=""}));const i=new URL(n.home,r).href;this.push(`<o-page src="${i}"></o-page>`),Object.assign(this._opts,{loading:s,fail:a})}},proto:{[We]:[],async back(e=1){if(!this[We].length)return void console.warn("It's already the first page, can't go back");const{current:t}=this;e=e<this[We].length?e:this[We].length;const r=this[We].splice(-e)[0];this.push({...r,html:Ie({self:this,src:r.src,type:"back"})}),Je({page:this.current,key:"previous"}),await Be({page:t,key:"next"}),t.remove(),this.emit("router-change",{name:"back",delta:e})},async goto(e){const{current:t}=this,r="m_"+h();this.push(`<o-page src="${e}" ${r}>${Ie({self:this,src:e,type:"goto"})}</o-page>`);const n=this.$(`[${r}]`);n.ele.removeAttribute(r),Je({page:n,key:"next"}),await Be({page:t,key:"previous"}),t.forEach((e=>e.remove())),this[We].push(t.toJSON()),t.remove(),this.emit("router-change",{name:"goto",src:e})},async replace(e){const{current:t}=this;this.push(`<o-page src="${e}">${Ie({self:this,src:e,type:"replace"})}</o-page>`),Je({page:this.current,key:"next"}),await Be({page:t,key:"previous"}),t.remove(),this.emit("router-change",{name:"replace",src:e})},get current(){return this.$("o-page:last-of-type")},get routers(){return[...this[We],this.current.toJSON()]}}});const Je=({page:e,key:t})=>{const{pageAnime:r}=e,n=r[t];n&&(e.style={transition:"all ease .3s",...n},requestAnimationFrame((()=>{e.style={transition:"all ease .3s",...r.current||{}}})))},Be=({page:e,key:t})=>new Promise((r=>{const n=e.pageAnime[t];n?requestAnimationFrame((()=>{e.one("transitionend",r),e.style={transition:"all ease .3s",...n}})):r()}));return Me.fn.extend({get app(){let e=this;for(;e&&"o-app"!==e;){if("o-page"===e.tag){const t=e.parents.find((e=>"o-app"===e.tag));if(t){e=t;break}}if(e=e.host,!e)break}return e}}),"undefined"!=typeof window&&(window.$=Me),Me}));