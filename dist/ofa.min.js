//! ofa.js - v4.6.1 https://github.com/kirakiray/ofa.js  (c) 2018-2025 YAO
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).$={})}(this,(function(e){"use strict";var t="undefined"!=typeof document?document.currentScript:null;const r="https://ofajs.github.io/ofa-errors/errors",n={load_fail:"Load {url} failed",load_fail_status:"Load {url} failed, status code: {status}",load_module:"Load module failed, module address: {url}",no_alias:"No alias found: {name}, so '{url}' request is invalid",config_alias_name_error:"Error in setting alias, must start with '@'",alias_already:"Alias ​​'{name}' already exists",alias_relate_name:"Alias ​​cannot be configured with relative address, '{name}': '{path}'",failed_to_set_data:"Error in setting attribute value {key}",failed_to_get_data:"Error in getting {key}",nexttick_thread_limit:"nextTick exceeds thread limit, may have an infinite loop, please try to repair or optimize the function",not_func:"The callback parameter of the {name} method must be a Function",not_found_func:"The '{name}' method was not found on the target {tag}. Please define the '{name}' method on the 'proto' of the component {tag}",invalid_key:"The parameters for registering the '{compName}' component are incorrect. The '{name}' on '{targetName}' is already occupied. Please change '{name}' to another name.",xhear_wrap_no_parent:"The target element has no parent element, the warp method cannot be used",xhear_unwrap_has_siblings:"The target element contains adjacent nodes, the unwrap method cannot be used",xhear_reander_err:"Failed to render the tag '{tag}'",xhear_register_exists:"The component '{name}' already exists, and this component cannot be registered repeatedly",xhear_register_err:"Error in registering the '{tag}' component",xhear_validate_tag:"The registered component name '{str}' is incorrect. For the Web Components naming rules, please refer to: https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define#valid_custom_element_names ",xhear_tag_noline:"The registered component name '{str}' is incorrect and contains at least one '-' character; Web Components For naming rules, please refer to: https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define#valid_custom_element_names ",xhear_regster_data_noset:"Error in registering component {tag}, custom data cannot have data of type 'Set' or 'Map'",xhear_regster_data_nofunc:"Registration component {tag} error, functions cannot appear in custom data, please put the function in 'proto'; or change '{key}' to '_{key}'",xhear_fakenode_unclose:"This is an unclosed FakeNode; use the wrong attribute name: {name}",xhear_fill_tempname:"Fill component template '{name}' not found",xhear_eval:"Template syntax '{name}' error, expression {name}:{arg0}=\"{arg1}\"",xhear_listen_already:"An old listener already exists, and this element is rendering incorrectly. ",xhear_dbfill_noname:"Only fill components with the 'name' attribute can be rendered in the fill component",xhear_temp_exist:"Template '{name}' already exists",xhear_sync_no_options:"Direct use of the 'sync' method is not allowed, it is only used for template rendering",xhear_sync_object_value:"Cannot use 'sync' to synchronize values ​​of Object type, target {targetName}",loading_nothing:"Loading function has no return content",app_src_change:"The app element that has been initialized cannot modify the src attribute",no_cross_access_func:"To jump to a page across domains, you must set the access function",access_return_error:"Jumping to {src} is not allowed",load_comp_module:"Error loading component module, wrong module address: {url}",comp_registered:"Component '{tag}' has been registered, and the component cannot be registered again","inject-link-rel":"The rel attribute value of the link element in the inject-host component can only be 'stylesheet'","use-data-inject":"Please do not use data() on the style element in the inject-host, because it will cause serious performance crisis",load_page_module:"Loading page module {url} failed",page_no_defaults:"The current page ({src}) has been rendered and cannot be rendered again",not_page_module:"{src} is not a page module and cannot be set as the src of the page component",page_failed:"Loading page failed: {src}",fetch_temp_err:"Page module {url} failed to load template {tempSrc}",page_wrap_fetch:"Page {before} failed to get the parent page ({current})",context_change_name:"Changing the 'name' of {compName} may cause performance issues, please avoid changing this property",no_provider:"The consumer named '{name}' was not captured by the corresponding provider",page_invalid_key:"The registration parameters of page {src} are incorrect. '{name}' on '{targetName}' is already taken. Please change '{name}' to another name.",root_provider_exist:"An exception occurred in the root provider named '{name}'. The root provider component can only appear once",root_provider_name_change:"An exception occurred in the root provider named '{name}'. The root provider component cannot change the 'name' attribute",change_lm_src:"{tag} element changes 'src' attribute invalid, this attribute can only be set once.",error_no_owner:"This data is incorrect, the owner has not registered this object",circular_data:"An object with a circular reference",fill_type:"'value' of 'x-fill' must be of type Array, the current value is of type {type}",fill_key_duplicates:"The key in the fill component is repeated",render_el_error:"Rendering element failed, rendering error is {expr}",temp_multi_child:"The template element can only contain one child element. If multiple child elements appear, the child elements will be repackaged in a <div> element",temp_wrap_child:"The template '{tempName}' contains {len} child elements, which have been wrapped in a div element with the attribute '{wrapName}'.",app_noback:"This is already the first page, and the 'back' operation cannot be performed again",invalidated_inject_host:"This element will be invalidated in 'inject-host'",olink_out_app:"The element of [olink] is only allowed in o-app",app_noforward:"This is the last page, you can no longer perform the 'forward' operation",need_forwards:"The target o-app does not allow forward operations, please add the '_forwards' attribute to the target; or in the app config file, add 'export const allowForward = true' ",watchuntil_timeout:"watchUntil timed out, target value not monitored"};if(globalThis.navigator&&navigator.language){let e=navigator.language.toLowerCase().split("-")[0];"zh"===e&&"zh-cn"!==navigator.language.toLowerCase()&&(e="zhft"),(async()=>{if(!globalThis.localStorage)return;if(globalThis.navigator&&!navigator.onLine)return;if(localStorage["ofa-errors"]){const e=JSON.parse(localStorage["ofa-errors"]);Object.assign(n,e)}const t=localStorage["ofa-errors-time"];if(!t||Date.now()>Number(t)+3e5){const t=await fetch(`${r}/${e}.json`).then((e=>e.json())).catch((()=>null));t?(localStorage["ofa-errors"]=JSON.stringify(t),localStorage["ofa-errors-time"]=Date.now()):t=await fetch(`${r}/en.json`).then((e=>e.json())).catch((e=>null)),Object.assign(n,t)}})()}let s=!1;globalThis.navigator&&(s=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome"));const a=(e,t,r)=>{let n,a=i(e,t);return r?(s&&(a+=`\nCaused by: ${r.toString()}\n`,r.stack&&(a+=`  ${r.stack.replace(/\n/g,"\n    ")}`)),n=new Error(a,{cause:r})):n=new Error(a),n.code=e,n},i=(e,t)=>{if(!n[e])return`Error code: "${e}", please go to https://github.com/ofajs/ofa-errors to view the corresponding error information`;let r=n[e];if(t)for(let e in t)r=r.replace(new RegExp(`{${e}}`,"g"),t[e]);return r},o=()=>Math.random().toString(32).slice(2),l=Object.prototype.toString,c=e=>l.call(e).toLowerCase().replace(/(\[object )|(])/g,""),h=e=>{const t=c(e);return"array"===t||"object"===t};let d,u=0;function f(e){clearTimeout(d),d=setTimeout((()=>{u=0})),Promise.resolve().then((()=>{if(u++,u>1e5){const t=a("nexttick_thread_limit");throw console.warn(t,"lastCall => ",e),t}e()}))}const p=(e,t,r={})=>([...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)].forEach((n=>{const s=Object.getOwnPropertyDescriptor(t,n),{configurable:a,enumerable:i,writable:o,get:l,set:c,value:h}=s;"value"in s?e.hasOwnProperty(n)?e[n]=h:Object.defineProperty(e,n,{enumerable:i,configurable:a,writable:o,...r,value:h}):Object.defineProperty(e,n,{enumerable:i,configurable:a,...r,get:l,set:c})})),e);function m(e){try{return Object.getPrototypeOf(e),!1}catch(e){return e instanceof TypeError}}const _=e=>c(e).includes("function"),g=e=>e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));const y=e=>e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),w=(e,t)=>{const r=document.createElement("template");return r.content.append(e.cloneNode()),!!r.content.querySelector(t)};const b=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},v=(e,t)=>e instanceof HTMLTemplateElement?Array.from(e.content.querySelectorAll(t)):Array.from(e.querySelectorAll(t));const{assign:x,freeze:k}=Object;class E{constructor(e){x(this,e),k(this)}hasModified(e){if("array"===this.type)return this.path.includes(this.currentTarget.get(e));const t=e.split(".");if(this.currentTarget===this.target&&this.name===t[0])return!0;const r=T(this,t).indexOf(this.target);if(r>-1){const e=t.slice(r+1);return!e.length||this.name===e[0]}return this.path.includes(this.currentTarget[e])}hasReplaced(e){if("set"!==this.type)return!1;const t=e.split(".");if(this.target===this.currentTarget&&this.name===t[0])return!0;const r=T(this,t).indexOf(this.target);if(r>-1){return t.slice(r+1)[0]===this.name}return!1}}const T=(e,t)=>{const r=[],n=t.slice();let s=e.currentTarget;for(;n.length;){const e=n.shift();s&&(s=s[e]),r.push(s)}return r};class A extends Array{constructor(e){super(...e)}hasModified(e){return this.some((t=>t.hasModified(e)))}hasReplaced(e){return this.some((t=>t.hasReplaced(e)))}}const O=({type:e,currentTarget:t,target:r,name:n,value:s,oldValue:i,args:o,path:l=[]})=>{if(l&&l.includes(t)){const e=a("circular_data");return void console.warn(e,{currentTarget:t,target:r,path:l})}let c={type:e,target:r,name:n,oldValue:i,value:s};if("array"===e&&(delete c.value,c.args=o),t._hasWatchs){const e=new E({currentTarget:t,...c,path:[...l]});t[I].forEach((t=>{t(e)}))}t._update&&t.owner.forEach((e=>{O({currentTarget:e,...c,path:[t,...l]})}))};var j={watch(e){if(!(e instanceof Function))throw a("not_func",{name:"watch"});const t="w-"+o();return this[I].set(t,e),t},unwatch(e){return this[I].delete(e)},watchTick(e,t){if(!(e instanceof Function))throw a("not_func",{name:"watchTick"});return this.watch(function(e,t=0){let r=null,n=[];return function(...s){n.push(...s),t>0?(clearTimeout(r),r=setTimeout((()=>{e.call(this,n),n=[],r=null}),t)):null===r&&(r=1,f((()=>{r=null;const t=n.slice();n=[],e.call(this,t)})))}}((t=>{m(this)||(t=t.filter((e=>{try{e.path.forEach((e=>e.xid))}catch(e){return!1}return!0})),e(new A(t)))}),t||0))},refresh(e){const t={...e,type:"refresh",target:this,currentTarget:this};O(t)},watchUntil(e,t=3e4){return new Promise(((r,n)=>{let s,i;const o=this.watch(s=()=>{e()&&(clearTimeout(i),this.unwatch(o),r(this))});i=setTimeout((()=>{this.unwatch(o);const t=a("watchuntil_timeout");console.warn(t,e,this),n(t)}),t),s()}))}};const S=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],L=Symbol("placeholder");const $={},N=Array.prototype;S.forEach((e=>{N[e]&&($[e]=function(...t){const r=Array.from(this),n=N[e].apply(this[R],t),{deletedItems:s,addedItems:a}=function(e,t){const r=Array.from(t),n=Array.from(e),s=[],a=new Map,i=e.length;for(let t=0;t<i;t++){const n=e[t],a=r.indexOf(n);a>-1?r[a]=L:s.push(n)}const o=t.length;for(let e=0;e<o;e++){const r=t[e],s=n.indexOf(r);s>-1?n[s]=L:a.set(e,r)}return{deletedItems:s,addedItems:a}}(r,this);for(let[e,t]of a)F(t)?t._owner.push(this):h(t)&&(this.__unupdate=1,this[e]=t,delete this.__unupdate);for(let e of s)B(e,this);return O({type:"array",currentTarget:this,target:this,args:t,name:e,oldValue:r}),n===this[R]?this[H]:n})})),["concat","filter","slice","flatMap","map"].forEach((e=>{if("constructor"===e||S.includes(e))return;const t=Array.prototype[e];t instanceof Function&&($[e]=function(...e){return t.call(Array.from(this),...e)})}));const{defineProperties:C,getOwnPropertyDescriptor:M,entries:P}=Object,R=Symbol("self"),H=Symbol("proxy"),I=Symbol("watchs"),D=Symbol("isxdata"),F=e=>e&&!!e[D];function U(e,t=V){let r,{proxy:n,revoke:s}=Proxy.revocable(this,t);return n._update=1,C(this,{xid:{value:e.xid||o()},_owner:{value:[]},owner:{configurable:!0,get(){return new Set(this._owner)}},[D]:{value:!0},[R]:{configurable:!0,get:()=>this},[H]:{configurable:!0,get:()=>n},[I]:{get:()=>r||(r=new Map)},_hasWatchs:{get:()=>!!r},_revoke:{value:s}}),Object.keys(e).forEach((t=>{const r=M(e,t);let{value:s,get:a,set:i}=r;a||i?C(this,{[t]:r}):n[t]=s})),n}class W extends Array{constructor(e,t){return super(),U.call(this,e)}revoke(){const e=this[R];e._onrevokes&&(e._onrevokes.forEach((e=>e())),e._onrevokes.length=0),e.__unupdate=1,e[I].clear(),P(this).forEach((([e,t])=>{F(t)&&(this[e]=null)})),e._owner.forEach((e=>{P(e).forEach((([t,r])=>{r===this&&(e[t]=null)}))})),delete e[R],delete e[H],e._revoke()}toJSON(){let e={},t=!0,r=-1;Object.keys(this).forEach((n=>{let s=this[n];/\D/.test(n)?t=!1:(n=parseInt(n))>r&&(r=n),F(s)&&(s=s.toJSON()),e[n]=s})),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return C(e,{xid:{get:()=>n}}),e}toString(){return JSON.stringify(this.toJSON())}extend(e,t){return p(this,e,t)}get(e){if(/\./.test(e)){const t=e.split(".");let r=this;for(let n=0,s=t.length;n<s;n++)try{r=r[t[n]]}catch(r){const s=a("failed_to_get_data",{key:t.slice(0,n).join(".")},r);throw console.warn(s,{key:e,self:this}),s}return r}return this[e]}set(e,t){if(/\./.test(e)){const r=e.split("."),n=r.pop();let s=this;for(let t=0,n=r.length;t<n;t++)try{s=s[r[t]]}catch(n){const s=a("failed_to_get_data",{key:r.slice(0,t).join(".")},n);throw console.warn(s,{key:e,self:this}),s}return s[n]=t}return this[e]=t}}W.prototype.extend({...j,...$},{enumerable:!1});const{defineProperties:z}=Object,q=({target:e,key:t,value:r,receiver:n,type:s,succeed:a})=>{const i=n[t];let o=r;if(F(o)){if(i===r)return!0;o._owner.push(n)}else if(h(r)){const s=Object.getOwnPropertyDescriptor(e,t);s&&!s.hasOwnProperty("value")||(o=new(e.__OriginStanz||W)(r,{owner:n}),o._owner.push(n))}const l=i===r;!l&&F(i)&&B(i,n);const c=a(o);return!l&&!e.__unupdate&&O({type:s||"set",target:n,currentTarget:n,name:t,value:r,oldValue:i}),c},B=(e,t)=>{if(F(e)){const r=e._owner.indexOf(t);if(r>-1)e._owner.splice(r,1);else{const r=a("error_no_owner");console.warn(r,{owner:t,mismatch:e}),console.error(r)}}},V={set(e,t,r,n){if("symbol"==typeof t)return Reflect.set(e,t,r,n);if(/^_/.test(t))return e.hasOwnProperty(t)?Reflect.set(e,t,r,n):z(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0;try{return q({target:e,key:t,value:r,receiver:n,succeed:r=>Reflect.set(e,t,r,n)})}catch(n){const s=a("failed_to_set_data",{key:t},n);throw console.warn(s,{target:e,value:r}),s}},deleteProperty:(e,t)=>/^_/.test(t)||"symbol"==typeof t?Reflect.deleteProperty(e,t):q({target:e,key:t,value:void 0,receiver:e[H],type:"delete",succeed:()=>Reflect.deleteProperty(e,t)})},J={set:(e,t,r,n)=>/\D/.test(String(t))?e[t]===r||("html"===t?Reflect.set(e,t,r,n):V.set(e,t,r,n)):Reflect.set(e,t,r,n),get:(e,t,r)=>/\D/.test(String(t))?Reflect.get(e,t,r):We(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},K={beforeRender(){},render(){}},G=e=>e.__revokes||(e.__revokes=[]),X=(e,t)=>G(e).push(t),Y=(e,t,r)=>{const n=`\nconst dataRevoked = ${m.toString()};\nconst [$event] = $args;\nconst {data, errCall} = this;\nif(dataRevoked(data)){\n  return;\n}\ntry{\n  with(data){\n    return ${e};\n  }\n}catch(error){\n  if(data.ele && !data.ele.isConnected){\n    return;\n  }\n  if(errCall){\n    const result = errCall(error);\n    if(result !== false){\n      console.error(error);\n    }\n  }else{\n    console.error(error);\n  }\n}\n`;return new Function("...$args",n).bind({data:t,...r})};function Z({data:e,target:t,template:r,temps:n,isRenderSelf:s,...i}){const o=r&&r.innerHTML;o&&(t.innerHTML=o),K.beforeRender({target:t});const l=v(t,"xtext"),c=[],h=G(t);v(t,"style").forEach((t=>{const r=t.innerHTML;if(/data\(.+\)/.test(r)){const n=Array.from(new Set(r.match(/data\(.+?\)/g))).map((t=>{const r=t.replace(/data\((.+)\)/,"$1");return{dataExpr:t,func:Y(r,e)}})),s=()=>{let e=r;n.forEach((({dataExpr:t,func:r})=>{e=e.replace(t,r())})),t.innerHTML!==e&&(t.innerHTML=e)};c.push(s);const a=()=>{n.length=0,b(c,s),b(G(t),a),b(h,a)};X(t,a),h.push(a)}})),l.forEach((t=>{const r=document.createTextNode(""),{parentNode:n}=t;n.insertBefore(r,t),n.removeChild(t);const s=Y(t.getAttribute("expr"),e),a=()=>{const e=s();r.textContent!==String(e)&&(r.textContent=e)};c.push(a);const i=()=>{b(h,i),b(c,a),b(G(r),i)};h.push(i),X(r,i)}));const d=v(t,"[x-bind-data]");if(s&&w(t,"[x-bind-data]")&&d.unshift(t),d.forEach((r=>{const n=JSON.parse(r.getAttribute("x-bind-data")),s=We(r);for(let[i,o]of Object.entries(n))o.forEach((n=>{try{const{always:o}=s[i];let l,d=[];const u=()=>{const[t,r]=n,o=Y(r,e,{errCall:e=>{const n=`:${t}="${r}"`,i=a("render_el_error",{expr:n},e);return console.warn(i,{target:s.ele,errorExpr:n}),console.error(i),!1}});d=[t,o];const l=s[i](...d,{actionName:i,target:s,data:e,beforeArgs:n,args:d});return K.render({step:"refresh",args:n,name:i,target:s}),l};let f=()=>{const{revoke:t}=s[i];t&&t({actionName:i,target:s,data:e,beforeArgs:n,args:d,result:l}),b(h,f),b(G(r),f),b(c,u),f=null};o?c.push(u):l=u(),h.push(f),r!==t&&X(r,f)}catch(e){const t=a("xhear_eval",{name:i,arg0:n[0],arg1:n[1]},e);throw console.warn(t,r),t}}));r.removeAttribute("x-bind-data"),r._bindingRendered=!0,r.dispatchEvent(new Event("binding-rendered"))})),t.__render_temps||function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)||(t.__render_temps=n),c.length){if(t.__render_data&&t.__render_data!==e){const r=a("xhear_listen_already");throw console.warn(r,{element:t,old:t.__render_data,new:e}),r}t.__render_data=e,c.forEach((e=>e()));const r=e.watchTick((t=>{c.length?c.forEach((e=>e())):e.unwatch(r)}))}K.render({step:"init",target:t})}const Q=e=>{const{tagName:t}=e;if("TEMPLATE"!==t){if(t){const t={};Array.from(e.attributes).forEach((r=>{const n=/(.*):(.+)/.exec(r.name);if(!n)return;let[,s,a]=n;s||(s="prop");(t[s]||(t[s]=[])).push([a,r.value]),e.removeAttribute(r.name)}));Object.keys(t).length&&e.setAttribute("x-bind-data",JSON.stringify(t))}Array.from(e.children).forEach(Q)}},ee=(e,t,r)=>{const n=Array.from(e.content.querySelectorAll(t));return r&&n.forEach(r),n};let te;const re=e=>{let t={};const r={};ee(e,"code",(e=>{const t=o();e.setAttribute("code-id",t),r[t]=e.innerHTML,e.innerHTML=""})),e.innerHTML=e.innerHTML.replace(/{{(.+?)}}/g,((e,t)=>`<xtext expr="${t}"></xtext>`));const n=e.getAttribute("name");if(n){const r=e.content.children;if(r.length>1){if(!te){const t=a("temp_multi_child");console.warn(t,{content:e.content}),te=1}const t=`wrapper-${n}`;e.innerHTML=`<div ${t} style="display:contents">${e.innerHTML}</div>`,console.warn(a("temp_wrap_child",{tempName:n,len:r.length,wrapName:t}))}t[n]=e,e.remove()}ee(e,"x-fill:not([name])",(e=>{if(e.querySelector("x-fill:not([name])"))throw a("xhear_dbfill_noname");if(e.innerHTML.trim()){const t=`t${o()}`;e.setAttribute("name",t);const r=document.createElement("template");r.setAttribute("name",t),r.innerHTML=e.innerHTML,e.innerHTML="",e.appendChild(r)}})),ee(e,"x-if,x-else-if,x-else",(e=>{const t=e.children[0];t&&"TEMPLATE"===t.tagName||(e.innerHTML=`<template condition>${e.innerHTML}</template>`)})),ee(e,"template",(e=>{const r=re(e);Object.keys(r).forEach((e=>{if(t[e])throw a("xhear_temp_exist",{name:e})})),t={...t,...r}})),Array.from(e.content.children).forEach((e=>Q(e)));for(let[t,n]of Object.entries(r))ee(e,`[code-id="${t}"]`,(e=>{e.removeAttribute("code-id"),e.innerHTML=n}));return t},ne=e=>_(e)?e():e,se={prop(...e){let[t,r]=e;if(1===e.length)return this[t];r=ne(r),t=g(t),this.set(t,r)},attr(...e){let[t,r]=e;const{ele:n}=this;if(1===e.length)return n.getAttribute(t);r=ne(r),!1===r?r=null:!0===r&&(r=""),null==r?n.removeAttribute(t):n.getAttribute(t)!=r&&n.setAttribute(t,r)},class(...e){let[t,r]=e;if(1===e.length)return this.ele.classList.contains(t);r=ne(r),r?this.ele.classList.add(t):this.ele.classList.remove(t)},watch(...e){if(e.length<3)return j.watch.apply(this,e);const t=e[2],{beforeArgs:r,data:n}=t,[s,a]=r,i=g(s),o=()=>{let e=this.get(i);n.set(a,e)},l=this.watch((e=>{e.hasModified(i)&&o()}));return o(),()=>{this.unwatch(l)}}};se.prop.always=!0,se.attr.always=!0,se.class.always=!0,se.prop.revoke=({target:e,args:t,$ele:r,data:n})=>{const s=t[0],a=e.get(s);F(a)&&e.set(s,{})},se.watch.revoke=e=>{e.result();const t=e.beforeArgs[1],r=e.data.get(t);F(r)&&e.data.set(t,{})};const ae={sync(e,t,r){if(!r)throw a("xhear_sync_no_options");[e,t]=r.beforeArgs,e=g(e),t=g(t);const{data:n}=r;if(n.get(t)instanceof Object){const e=a("xhear_sync_object_value",{targetName:t});throw console.warn(e,n),e}this[e]=n.get(t);const s=this.watch((r=>{if(r.hasModified(e))try{const r=this.get(e);n.set(t,r)}catch(e){}})),i=n.watch((r=>{if(r.hasModified(t))try{const r=n.get(t);this.set(e,r)}catch(e){}}));return()=>{this.unwatch(s),m(n)||n.unwatch(i)}}};function ie(e,t,r){let n;if(r){const s=r.beforeArgs[1];if(!/[^\d\w_\$\.]/.test(s)){if(!(t=r.data.get(s))){const e=r.data.tag,t=a("not_found_func",{name:s,tag:e?`"${e}"`:""});throw console.warn(t," target =>",r.data),t}t=t.bind(r.data)}n=()=>this.ele.removeEventListener(e,t)}return{revoker:n,name:e,func:t}}ae.sync.revoke=e=>{e.result()};const oe={on(...e){const{revoker:t,name:r,func:n}=ie.call(this,...e);return this.ele.addEventListener(r,n),t||this},one(...e){const{revoker:t,name:r,func:n}=ie.call(this,...e);let s=e=>{this.off(r,s),n(e)};return this.ele.addEventListener(r,s),t||this},off(e,t){return this.ele.removeEventListener(e,t),this},emit(e,t){const r={...t};let n,s;return r.hasOwnProperty("data")&&(n=r.data,delete r.data),e instanceof Event?s=e:e&&(s=new Event(e,{bubbles:!0,...r})),s.data=n,this.ele.dispatchEvent(s),this}};oe.on.revoke=e=>{e.result()},oe.one.revoke=e=>{e.result()};const le=(e,t,r,...n)=>{const{children:s}=e;t<0&&(t+=e.children.length),void 0===r&&(r=e.children.length-t);const a=[];for(let e=t,n=t+r;e<n;e++){const t=s[e];a.push(t)}if(a.forEach((e=>e&&e.remove())),n.length){const r=document.createDocumentFragment();n.forEach((e=>r.append(qe(e).ele)));const a=s[t];a?e.insertBefore(r,a):e.appendChild(r)}return a},ce=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],he={push(...e){const{ele:t}=this;return le(t,t.children.length,0,...e),O({type:"array",currentTarget:this,target:this,args:e,name:"push"}),t.children.length},pop(...e){const{ele:t}=this,r=le(t,t.children.length-1,1,...e);return O({type:"array",currentTarget:this,target:this,args:e,name:"pop"}),We(r[0])},shift(...e){const{ele:t}=this,r=le(t,0,1,...e);return O({type:"array",currentTarget:this,target:this,args:e,name:"shift"}),We(r[0])},unshift(...e){const{ele:t}=this;return le(t,0,0,...e),O({type:"array",currentTarget:this,target:this,args:e,name:"unshift"}),t.children.length},splice(...e){const t=le(this.ele,...e);return O({type:"array",currentTarget:this,target:this,args:e,name:"splice"}),t.map(We)},reverse(...e){const t=Array.from(this.ele.childNodes);de.reverse.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.__internal=1,r.append(e)})),this.ele.append(r),t.forEach((e=>{delete e.__internal})),O({type:"array",currentTarget:this,target:this,args:e,name:"reverse"}),this},sort(...e){const t=Array.from(this.ele.children).map(We);de.sort.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.ele.__internal=1,r.append(e.ele)})),this.ele.append(r),t.forEach((e=>{delete e.ele.__internal})),O({type:"array",currentTarget:this,target:this,args:e,name:"sort"}),this}},de=Array.prototype;Object.keys(Object.getOwnPropertyDescriptors(de)).forEach((e=>{if("constructor"===e||"length"===e||ce.includes(e))return;const t=de[e];_(t)&&(he[e]=function(...e){return t.apply(Array.from(this.ele.children).map(We),e)})}));class ue{}for(let[e,t]of Object.entries(he))Object.defineProperty(ue.prototype,e,{value:t});const fe=e=>new W(e);Object.assign(fe,{is:F});const{defineProperty:pe,assign:me}=Object,_e=(e,t)=>{const{ele:r}=t;e.forEach((e=>{if(e in r){let n=!1;pe(t,e,{enumerable:!0,get:()=>{let t=r[e];return n&&(/\D/.test(t)?n=!1:t=Number(t)),t},set:t=>{n="number"==typeof t,r[e]=t}})}}))},ge=new Set(["input","textarea","select","option","button","label","fieldset","legend","form"]),ye=(e,t={})=>{const{name:r,type:n}=t,{ele:s}=e;let a=s[r];e.on(n,(()=>{O({type:"set",target:e,currentTarget:e,name:r,value:s[r],oldValue:a}),a=s[r]}))},we=e=>{switch(e.attr("type")){case"file":_e(["multiple","files"],e),ye(e,{name:"files",type:"change"});break;case"checkbox":_e(["checked","multiple","value"],e),ye(e,{name:"checked",type:"change"});break;case"radio":_e(["checked","value"],e),ye(e,{name:"checked",type:"change"});break;default:_e(["placeholder","value"],e),ye(e,{name:"value",type:"input"})}},be=(e,t)=>{const r={};return e.all(t).forEach((e=>{const{name:t,tag:n,ele:s}=e;if("input"===n)switch(e.type){case"checkbox":t in r||(r[t]=[]),s.checked&&r[t].push(s.value);break;case"radio":s.checked&&(r[t]=s.value);break;case"file":r[t]=s.files;break;default:r[t]=s.value}else if("textarea"===n)r[t]=s.value;else if("select"===n){const e=v(s,"option:checked");if(s.multiple)r[t]=e.map((e=>e.value||e.textContent));else{const[n]=e;r[t]=n.value||n.textContent}}else r[t]=e.value})),r};var ve={formData(e,t={wait:200}){const r=fe({});me(r,be(this,e||"input,select,textarea"));const n=this.watchTick((t=>{const n=be(this,e||"input,select,textarea");!function(e,t){for(let r of Object.keys(e))t.hasOwnProperty(r)||delete e[r];for(let[r,n]of Object.entries(t))e[r]=n}(r,n)}),t.wait),s=r.watchTick((t=>{!function(e,t,r){const n=e.all(t);Object.keys(r).forEach((e=>{const t=n.filter((t=>t.attr("name")===e));if(0===t.length)return;const s=r[e],a=t[0],i=a.attr("type");if(1===t.length){let e=!0;if("input"!==a.tag||"radio"!==i&&"checkbox"!==i||(e=!1),e)return void(a.value!==s&&(a.value=s))}t.forEach((e=>{switch(e.attr("type")){case"radio":e.value===s?e.checked=!0:e.checked=!1;break;case"checkbox":e.checked=s.includes(e.value)}}))}))}(this,e||"input,select,textarea",r)})),a=this,i=r.revoke;return r.extend({revoke(){a.unwatch(n),r.unwatch(s),i.call(this)}}),r}};const xe={set:(e,t,r,n)=>(e._ele.style[t]=r,Reflect.set(e,t,r,n),!0),get(e,t,r){if("length"===t)return 0;if(t.startsWith&&t.startsWith("--"))return getComputedStyle(e._ele).getPropertyValue(t);const{style:n}=e._ele;return Array.from(n).includes(t)?n[t]:getComputedStyle(e._ele)[t]}};class ke{constructor(e){const t={};Object.defineProperty(t,"_ele",{enumerable:!1,get:()=>e.ele});const{style:r}=e.ele;return Array.from(r).forEach((e=>{t[e]=r[e]})),e._css=new Proxy(t,xe)}}var Ee={get css(){return new ke(this)},set css(e){if("string"==c(e))return void(this.ele.style=e);let{style:t}=this,r=Object.keys(e);Array.from(t).forEach((e=>{r.includes(e)||(t[e]="")})),Object.assign(t,e)}};function Te(e){if("string"===c(e)&&!/<.+>/.test(e)){const t=document.querySelector(e);return We(t)}return qe(e)}Object.defineProperties(Te,{extensions:{value:{}}});const Ae={},Oe=({defaults:e,ele:t,template:r,temps:n})=>{let s;try{const a={...Le(e.data,e.tag),...e.attrs};e.attrs&&Object.keys(e.attrs).forEach((e=>{const r=t.getAttribute(y(e));null!=r&&(a[e]=r)})),s=We(t),e.proto&&s.extend(e.proto,{enumerable:!1});for(let[e,t]of Object.entries(a))s.hasOwnProperty(e)||(s[e]=t);if(e.temp){const e=t.attachShadow({mode:"open"});e.innerHTML=r.innerHTML,Z({target:e,data:s,temps:n})}e.ready&&e.ready.call(s)}catch(e){throw a("xhear_reander_err",{tag:t.tagName.toLowerCase()},e)}if(e.watch){const t=Object.entries(e.watch);s.watchTick((e=>{for(let[r,n]of t){const t=r.split(",");t.length>=2?t.some((t=>e.hasModified(t)))&&n.call(s,t.map((e=>s[e])),{watchers:e}):e.hasModified(r)&&n.call(s,s[r],{watchers:e})}}));for(let[e,r]of t){const t=e.split(",");t.length>=2?r.call(s,t.map((e=>s[e])),{}):r.call(s,s[e],{})}}},je=(e={})=>{const t={tag:"",temp:"",data:{},proto:{},...e},{fn:r,extensions:n}=Te;let s,o,l;r&&(Object.keys(t.data).forEach((e=>{if(r.hasOwnProperty(e))throw a("invalid_key",{compName:t.tag,targetName:"data",name:e})})),Object.keys(t.proto).forEach((n=>{r.hasOwnProperty(n)&&console.warn(i("invalid_key",{compName:t.tag,targetName:"proto",name:n}),e)})));try{if(function(e){if(!e.includes("-"))throw a("xhear_tag_noline",{str:e});if("-"===e.charAt(0)||"-"===e.charAt(e.length-1))throw a("xhear_validate_tag",{str:e});for(let t=0;t<e.length-1;t++)if("-"===e.charAt(t)&&"-"===e.charAt(t+1))throw a("xhear_validate_tag",{str:e})}(t.tag),t.data=Le(t.data,t.tag),l=(h=g(t.tag)).charAt(0).toUpperCase()+h.slice(1),Ae[l])throw a("xhear_register_exists",{name:l});s=document.createElement("template"),s.innerHTML=t.temp,o=re(s)}catch(e){throw a("xhear_register_err",{tag:t.tag},e)}var h;const d=e=>{let t;return t=e instanceof Array?[...e]:Object.keys(e),t},u=Ae[l]=class extends HTMLElement{constructor(...e){super(...e);const r=We(this);if(t.created&&t.created.call(r),t.attrs){const e=d(t.attrs);r.watchTick((t=>{e.forEach((e=>{if(t.hasModified(e)){const t=r[e],n=y(e),s=this.getAttribute(n);if(null==t)this.removeAttribute(n);else if(s!==t){let e=t;const r=c(t);if("number"===r&&s===String(t))return;if("object"===r&&(e=JSON.stringify(e),e===s))return;this.setAttribute(n,e)}}}))})),e.forEach((e=>{null!==r[e]&&void 0!==r[e]&&r[e]!==t.attrs[e]&&this.setAttribute(y(e),r[e])}))}Oe({defaults:t,ele:this,template:s,temps:o})}connectedCallback(){Se(this)||(t.attached&&t.attached.call(We(this)),n.afterAttached&&n.afterAttached(We(this)))}disconnectedCallback(){Se(this)||(t.detached&&t.detached.call(We(this)),n.afterDetached&&n.afterDetached(We(this)))}attributeChangedCallback(e,t,r){const n=We(this);/[^\d.]/.test(r)||"number"!=typeof n[e]||(r=Number(r)),n[g(e)]=r}static get observedAttributes(){return d(t.attrs||{}).map((e=>y(e)))}};if("loading"!==document.readyState)customElements.define(t.tag,u);else{const e="readystatechange";let r;document.addEventListener(e,r=()=>{customElements.define(t.tag,u),document.removeEventListener(e,r)})}};function Se(e){let t=e;for(;t;){if(t.__internal)return!0;if(t=t.parentNode||t.host,!t||t.tagName&&"BODY"===t.tagName)break}return!1}function Le(e,t="",r){if(e instanceof Set||e instanceof Map)throw a("xhear_regster_data_noset",{tag:t});if(e instanceof Function)throw a("xhear_regster_data_nofunc",{tag:t,key:r});if("object"!=typeof e||null===e)return e;const n=Array.isArray(e)?[]:{};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(/^_/.test(r)&&e[r]instanceof Function?n[r]=e[r]:n[r]=Le(e[r],t,r));return n}class $e extends Comment{constructor(e){const t="Fake Node"+(e?": "+e:"");super(` ${t} --end `),this._mark=e,this._inited=!1;const r=new Comment(` ${t} --start `);r.__fake_end=this,Object.defineProperty(this,"_start",{value:r})}init(){this._inited||(this.parentNode.insertBefore(this._start,this),this._inited=!0)}querySelector(e){return this.__searchEl(e,"find")}querySelectorAll(e){return this.__searchEl(e)}__searchEl(e,t="filter"){const r=this.parentNode;if(!r)return[];const n=this.children;return Array.from(r.querySelectorAll(e))[t]((e=>{let t=e;for(;;){if(n.includes(t))return!0;if(t=t.parentNode,!t)break}}))}insertBefore(e,t){const{parentNode:r}=this;Array.from(r.children).includes(t)?r.insertBefore(e,t):r.insertBefore(e,this)}appendChild(e){this.parentNode.insertBefore(e,this)}get children(){const e=[];let t=this;for(;;){if(t=t.previousSibling,!t){if(this.isConnected)throw a("xhear_fakenode_unclose",{name:"children"});break}if(t instanceof HTMLElement)e.unshift(t);else if(t===this._start)break}return e}get childNodes(){const e=[];let t=this;for(;;){if(t=t.previousSibling,!t){if(!this.isConnected)break;throw a("xhear_fakenode_unclose",{name:"childNodes"})}if(t===this._start)break;e.unshift(t)}return e}set innerHTML(e){this.childNodes.forEach((e=>{e.remove()}));const t=document.createElement("template");t.innerHTML=e,Array.from(t.content.childNodes).forEach((e=>{this.appendChild(e)}))}get innerHTML(){const{children:e}=this;let t="";return e.forEach((e=>{t+=e.outerHTML+"\n"})),t}get nextElementSibling(){let e=this.nextSibling;return e?e.__fake_end?e.__fake_end:(!e||e instanceof Element||(e=e.nextElementSibling),e):null}get previousElementSibling(){const{_start:e}=this;let t=e.previousSibling;return t?t instanceof $e?t:e.previousElementSibling:null}}const Ne=e=>{if(e.parentNode){const t=e.parentNode;if(Array.from(e.content.children).forEach((r=>{t.insertBefore(r,e)})),e.remove(),t.querySelector("[x-bind-data]")){const e=Me(t);e&&Z({data:e.data,target:e.target,temps:e.temps})}}};if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))K.beforeRender=({target:e})=>{let t=[];for(;t=Array.from(e.querySelectorAll('template[is="replace-temp"]')),t.length;)t.forEach((e=>{Ne(e)}))};else{class e extends HTMLTemplateElement{constructor(){super(),this.init()}init(){Ne(this)}connectedCallback(){this.init()}}customElements.define("replace-temp",e,{extends:"template"})}const Ce={data:{value:null,__rendered:!1},watch:{value(){this._bindend&&this.refreshValue()}},proto:{refreshValue(){clearTimeout(this._timer),this._timer=setTimeout((()=>{const e=[this,...this._others];let t=!1;e.forEach((e=>{t?e._clearContent():e.value||"x-else"===e.tag?(t=!0,e._renderContent()):e._clearContent()})),this._fake.parentNode&&We(this._fake.parentNode).refresh()}),0)},_renderContent(){if(this.__rendered)return;this.__rendered=!0;const e=Me(this._fake);if(!e)return;const{target:t,data:r,temps:n}=e;m(r)||(this._fake.innerHTML=this.__originHTML,Z({target:t,data:r,temps:n}),this.emit("rendered",{bubbles:!1}))},_clearContent(){this.__rendered&&(this.__rendered=!1,this._fake?.childNodes?.forEach((e=>Be(e))),this._fake.innerHTML="",this.emit("clear",{bubbles:!1}))},init(){if(this._bindend)return;this._bindend=!0;const e=this._fake=new $e(this.tag);if(e.__revokes=this.ele.__revokes,this.before(e),e.init(),this.remove(),"x-if"===this.tag){const t=this._others=[];let r=e;for(;r=r.nextElementSibling,r&&"X-IF"!=r.tagName;)switch(r.tagName){case"X-ELSE":{const e=We(r);return e.init?e.init():e._if_ready=1,void t.push(e)}case"X-ELSE-IF":{const e=We(r);e._xif=this,t.push(e);break}}}}},created(){this.__originHTML=this.$("template[condition]").html,this.html=""},ready(){this.ele._bindingRendered?this.init():this.one("binding-rendered",(()=>this.init()))}};je({tag:"x-if",...Ce}),je({tag:"x-else-if",...Ce,watch:{value(){this._bindend&&this._xif&&this._xif.refreshValue()}}}),je({tag:"x-else",...Ce,watch:{},ready(){this._if_ready&&this.init()}});const Me=e=>{for(;e&&!e.__render_data;)e=e.parentNode;return e?{target:e,data:e.__render_data,temps:e.__render_temps}:null};je({tag:"x-fill",data:{value:null},watch:{value(e,t){this.refreshValue(t?.watchers)}},proto:{refreshValue(e){const t=this.value;if(!this._bindend)return;const r=this._fake.children;if(!t)return r.forEach((e=>Be(e))),void(this._fake.innerHTML="");if(!(t instanceof Array))return console.warn(a("fill_type",{type:c(t)})),void(r&&r.forEach((e=>{Be(e),e.remove()})));const n=Me(this._fake);if(!n)return;const{data:s,temps:i}=n,o=i[this._name],l=this.attr("fill-key")||"xid";if(r.length){if(e){if(!e.some((e=>e.path.length<=1)))return}const n=t.slice(),c=new Set(n.map((e=>{if(!e)return;const t=e[l];return void 0===t?e:t}))),{parentNode:h}=this._fake;if("xid"!==l&&n.length!==c.size){const e=a("fill_key_duplicates");console.error(e),console.warn(e,{parentNode:h,host:We(h)?.host?.ele})}const d=[];for(let e=0,t=r.length;e<t;e++){const n=r[e],s=n._data_xid||n;c.has(s)?d.push(s):(Be(n),n.remove(),r.splice(e,1),t--,e--)}let u=this._fake._start;const f=[];let p=0;for(;u;){if(u===this._fake){n.length&&n.forEach((e=>{const t=Pe(e,i,o,s.$host||s,p,l);p++,h.insertBefore(t.ele,u)}));break}if(!(u instanceof Element)){u=u.nextSibling;continue}const e=n.shift(),t=e instanceof Object,a=We(u).__item;if(void 0===e&&!n.length){f.push(u),u=u.nextSibling;continue}const c=d.indexOf(t?e[l]:e);if(c>-1){const n=r[c];(t?e[l]!==a.$data[l]:e!==a.$data)&&(n.__internal=1,h.insertBefore(n,u),delete n.__internal,u=n);const s=We(n);s.__item.$data!==e&&(s.__item.$data=e),s.__item.$index=p}else{const t=Pe(e,i,o,s.$host||s,p,l);h.insertBefore(t.ele,u),u=t.ele}p++,u=u.nextSibling}f.length&&f.forEach((e=>{Be(e),e.remove()}))}else{const e=document.createDocumentFragment();t.forEach(((t,r)=>{const n=Pe(t,i,o,s.$host||s,r,l);e.appendChild(n.ele)})),this._fake.appendChild(e)}this._fake.parentNode&&We(this._fake.parentNode).refresh(),this.emit("rendered",{bubbles:!1})},init(){if(this._bindend)return;this._bindend=!0;const e=this._fake=new $e("x-fill");e.__revokes=this.ele.__revokes,this.before(e),e.init(),this.remove(),this.refreshValue()}},ready(){if(this._name=this.attr("name"),!this._name){const e=a("xhear_fill_tempname",{name:this._name});throw console.warn(e,this.ele),e}this.ele._bindingRendered?this.init():this.one("binding-rendered",(()=>this.init()))}});const Pe=(e,t,r,n,s,a)=>{const i=qe(r.innerHTML),o=new W({$data:e,$host:n,$index:s});Object.defineProperties(o,{$ele:{get:()=>i}}),Z({target:i.ele,data:o,temps:t,isRenderSelf:!0});const l=i.ele.__revokes,c=()=>{b(l,c),o.revoke()};return l.push(c),i.__item=o,i.ele._data_xid=e?.[a]||e,i},{defineProperties:Re}=Object,He=`get-${Math.random()}`,Ie=({_this:e,ele:t,proxySelf:r})=>{const n={owner:{get(){const{parentNode:r}=t,{_owner:n}=e,s=r?[We(r),...n]:[...n];return new Set(s)}},ele:{get:()=>t}},s=t.tagName&&t.tagName.toLowerCase();s&&(n.tag={enumerable:!0,value:s}),Re(e,n),(e=>{const{tag:t}=e;if(ge.has(t))switch(_e(["type","name","disabled"],e),t){case"input":we(e);break;case"textarea":_e(["value"],e),ye(e,{name:"value",type:"input"});break;case"option":_e(["selected","value"],e);break;case"select":{const{ele:t}=e;e.__unupdate=1,e.value=t.value,delete e.__unupdate,e.watch((()=>{t.value=e.value})),e.on("change",(()=>{e.value=t.value}))}}})(r)};class De extends ue{constructor({ele:e}){super();const t=U.call(this,{},J);return Ie({_this:this,ele:e,proxySelf:t}),e.__xhear__=t,t}get length(){return this.ele&&this.ele.children.length}$(e){let{ele:t}=this;t instanceof HTMLTemplateElement&&(t=t.content);const r=t.querySelector(e);return r?We(r):null}all(e){return v(this.ele,e).map(We)}extend(e,t){return p(this,e,t)}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get classList(){return this.ele.classList}get data(){return this.ele.dataset}get shadow(){return We(this.ele.shadowRoot)}get root(){const e=this.ele.getRootNode();return e?We(e):null}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t instanceof Node?We(t):null}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?We(e):null}get parents(){const e=[];let t=this;for(;t.parent;)t=t.parent,e.push(t);return e}parentsUntil(e){const t=this.parents,r=[],n="object"==typeof e;for(;t.length;){const s=t.shift();if(n){if(s===e||s.ele===e)break}else if(w(s.ele,e))break;r.push(s)}return r}get hosts(){const e=[];let t=this;for(;t.host;)t=t.host,e.push(t);return e}composedPath(){let e=[];return this.one(He,(t=>{e=t.composedPath(),t.stopPropagation()})),this.emit(He,{composed:!0}),e}get next(){const e=this.ele.nextElementSibling;return e?We(e):null}after(e){const{next:t}=this;t?t.before(e):this.parent.push(e)}get nexts(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r>t))}get prev(){const e=this.ele.previousElementSibling;return e?We(e):null}before(e){const t=qe(e);this.parent.ele.insertBefore(t.ele,this.ele)}get prevs(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r<t))}get siblings(){return this.parent.filter((e=>e!==this))}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get style(){return this.ele.style}get width(){return parseInt(getComputedStyle(this.ele).width)||0}get height(){return parseInt(getComputedStyle(this.ele).height)||0}get clientWidth(){return this.ele.clientWidth}get clientHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}is(e){return w(this.ele,e)}remove(){const{parent:e}=this;e&&e.splice(e.indexOf(this),1)}clone(e=!0){return We(this.ele.cloneNode(e))}wrap(e){const t=qe(e),{ele:r}=this;if(!r.parentNode)throw a("xhear_wrap_no_parent");return r.parentNode.insertBefore(t.ele,r),r.__internal=1,t.ele.appendChild(r),delete r.__internal,this}unwrap(){const{ele:e}=this,t=e.parentNode;if(t.children.length>1)throw a("xhear_unwrap_has_siblings");return e.__internal=1,t.parentNode.insertBefore(e,t),t.remove(),delete e.__internal,this}}const Fe=W.prototype,Ue=De.prototype;Ue.extend({get:Fe.get,set:Fe.set,toJSON:Fe.toJSON,toString:Fe.toString,...j,...oe,...se,...ae,...ve},{enumerable:!1}),Ue.extend(Ee);const We=e=>e?e.__xhear__?e.__xhear__:new De({ele:e}):null,ze=document.createElement("template"),qe=(e,t)=>{if(e instanceof De)return e;if(e instanceof Node||e===window)return We(e);switch(c(e)){case"object":return(e=>{const t={...e};if(!e.tag)return null;const r=document.createElement(e.tag);delete t.tag;const n=We(r);return Object.assign(n,t),n})(e);case"string":return(e=>{ze.innerHTML=e;const t=ze.content.children[0]||ze.content.childNodes[0];return ze.innerHTML="",We(t)})(e)}},Be=e=>{e.__revokes&&Array.from(e.__revokes).forEach((e=>e&&e())),e.childNodes&&Array.from(e.childNodes).forEach((e=>{Be(e)}));const t=e?.shadowRoot?.__revokes;t&&[...t].forEach((e=>e()))};function Ve(e,t,r,n){let s=e.host.root.$(`[inject-host="${t}"]`);if(s)return s.ele.__items.add(n),void(n.__host_link=s);s=r(),s.attr("inject-host",t),s.ele.__items=new Set([n]),n.__host_link=s;const{root:a}=e.host;a.ele===document?document.head.appendChild(s.ele):a.root.push(s)}function Je(e){if(e.__inited&&e.__host_link){const t=e.__host_link.ele.__items;t.delete(e),t.size||e.__host_link.remove(),delete e.__inited}}Object.assign(Te,{stanz:fe,Stanz:W,render:Z,convert:re,register:je,nextTick:f,fn:De.prototype,all:e=>v(document,e).map(We),frag:()=>Te(document.createDocumentFragment())}),Te.register({tag:"inject-host",temp:"<slot></slot>",data:{},proto:{init(){this.ele.isConnected&&this.forEach((e=>this._init(e)))},_init(e){if(!e.ele.__inited)switch(e.tag){case"link":this._initLink(e);break;case"style":this._initStyle(e);break;case"x-if":case"x-else-if":case"x-else":case"x-fill":break;default:const t=a("invalidated_inject_host");console.warn(t,e)}},_initLink(e){const t=e.attr("href"),r=e.attr("rel");if("stylesheet"!==r&&"host"!==r)throw a("inject-link-rel");let{ele:n}=e;"host"!==r&&(e.attr("rel","host"),e.attr("href",t)),n.__inited=!0,n._revoke=()=>{Je(n),n._revoke=null},Ve(this,t,(()=>{const t=e.clone();return t.attr("rel","stylesheet"),t}),n)},async _initStyle(e){if(/data\(.+?\)/.test(e.html)){const t=a("use-data-inject");throw console.warn(t,e.ele),t}const t=new Comment(e.html);t.__inited=!0,t._revoke=()=>{Je(e.ele),delete t.__inited,delete e.ele.__inited,t._revoke=null,e.ele._revoke=null},e.html="",e.push(t),e.ele.__inited=!0,e.ele._revoke=t._revoke;Ve(this,function(e){let t=0,r=e.length;for(let n=0;n<r;n++){t=(t<<5)-t^e.charCodeAt(n),t=t<<13|t>>>19,t=7*t-3*t}return t.toString(36)+"--"+r}(t.data),(()=>Te(`<style>${t.data}</style>`)),e.ele)}},attached(){(this._obs=new MutationObserver((e=>{for(let t of e)if("attributes"===t.type){if("x-bind-data"===t.attributeName)continue;const{target:e}=t;e.__inited&&(e._revoke(),this._init(We(e)))}else"childList"===t.type&&(t.removedNodes.forEach((e=>{e.__inited&&e._revoke()})),t.addedNodes.forEach((e=>{if(!e.__inited){if(e instanceof Text&&"STYLE"===e.parentElement.tagName&&this.init(e.parentNode),e.__inited)return;if(e instanceof Text||e instanceof Comment)return;this._init(We(e))}})))}))).observe(this.ele,{attributes:!0,childList:!0,subtree:!0}),this.init()},detached(){this.forEach((e=>Je(e.ele))),this._obs.disconnect()}});class Ke{constructor(){this._middlewares=new Map}use(e){const t=Math.random().toString(32).slice(2);return this._middlewares.set(t,e),t}unuse(e){return this._middlewares.delete(e)}async run(e){let t=-1;const r=Array.from(this._middlewares.values()),n=async()=>{t++,t<r.length&&await r[t](e,n)};await n()}}const Ge=e=>/^blob:/.test(e)||/^data:/.test(e),Xe=new Map,Ye=async(e,t)=>{let r=e;if(!Ge(e)){const n=new URL(e);r=t.includes("-direct")?e:`${n.origin}${n.pathname}`}let n=Xe.get(r);n||(n=fetch(r),Xe.set(r,n));return(await n).clone()},Ze={},Qe=(e,t)=>{(Ze[e]||(Ze[e]=new Ke)).use(t)},et=(e,t)=>{e instanceof Function&&(t=e,e=["js","mjs"]),e instanceof Array?e.forEach((e=>{Qe(e,t)})):Qe(e,t)};et(["mjs","js"],(async(e,t)=>{if(!e.result){const{url:t,params:r}=e,n=new URL(t),s=Ge(t);try{s||r.includes("-direct")?e.result=await import(t):e.result=await import(`${n.origin}${n.pathname}`)}catch(r){const n=a("load_module",{url:e.realUrl||t},r);throw s&&console.warn(n,e),n}}await t()})),et(["txt","html","htm"],(async(e,t)=>{if(!e.result){const{url:t,params:r}=e;let n;try{n=await Ye(t,r)}catch(e){throw a("load_fail",{url:t},e)}if(!/^2.{2}$/.test(n.status))throw a("load_fail_status",{url:t,status:n.status});e.result=await n.text()}await t()})),et("json",(async(e,t)=>{if(!e.result){const{url:t,params:r}=e;e.result=await Ye(t,r).then((e=>e.json()))}await t()})),et("wasm",(async(e,t)=>{if(!e.result){const{url:t,params:r}=e,n=await Ye(t,r).then((e=>e.arrayBuffer())),s=await WebAssembly.compile(n),a=new WebAssembly.Instance(s);e.result=a.exports}await t()})),et("css",(async(e,t)=>{if(!e.result){const{url:t,element:r,params:n}=e;if(r){const e=document.createElement("link");e.rel="stylesheet",e.href=t;const n=r.getRootNode();let s;n===document?n.head.append(e):n.appendChild(e),r.addEventListener("disconnected",s=t=>{e.remove(),r.removeEventListener("disconnected",s)})}else e.result=await Ye(t,n).then((e=>e.text()))}await t()}));const tt={};const rt=(e,t)=>{if(e.startsWith("http://")||e.startsWith("https://"))return e;const[r,...n]=e.split(" ");let s=r;if(/^@/.test(r)){const[t,...n]=r.split("/");if(!tt[t])throw a("no_alias",{name:t,url:e});s=[tt[t].replace(/\/$/,""),...n].join("/")}if("undefined"!=typeof location){const e=t?new URL(t,location.href):location.href;s=new URL(s,e).href}return n.length?`${s} ${n.join(" ")}`:s},nt=Symbol("loaded"),st=async(e,t)=>{const r=new URL(e),{pathname:n}=r;let s,a=null;t.params&&t.params.forEach((e=>{/^\..+/.test(e)?s=e.replace(/^\.(.+)/,"$1"):/^\-\-real/.test(e)&&(a=e.replace(/^\-\-real\:/,""))})),s||(s=n.slice(2+(n.lastIndexOf(".")-1>>>0)));const i={url:e,result:null,realUrl:a,...t},o=Ze[s];if(o)await o.run(i);else{const t=await fetch(e),r=t.headers.get("Content-Type"),n=[["application/javascript","js"],["application/json","json"],["text/html","html"],["text/xml","xml"]].find((e=>r.includes(e[0])));let s;n&&(s=Ze[n[1]]),s?await s.run(i):i.result=t}if(t&&t.element){const{element:e}=t;e[nt]=!0;const r=new Event("load");e.dispatchEvent(r)}return t.params&&t.params.includes("-ctx")?i:i.result};function at(e,t){return((e,t)=>(e||(e={url:document.location.href}),r=>{let[n,...s]=r.split(" ");const a=rt(n,e.url);return st(a,{params:s,...t})}))(e,t)}Object.defineProperties(at,{use:{value:et},alias:{get:()=>({...tt})}});class it extends HTMLElement{constructor(...e){super(...e),this[nt]=!1,Object.defineProperties(this,{loaded:{get:()=>this[nt]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let e=this.getAttribute("src");if(!e)return;this.__initSrc=e;lm(void 0,{element:this})(e),Object.defineProperties(this,{src:{configurable:!0,value:e}})}connectedCallback(){const e=new CustomEvent("connected");e.root=this._root=this.getRootNode(),this.dispatchEvent(e)}disconnectedCallback(){const e=new CustomEvent("disconnected");e.root=this._root,delete this._root,this.dispatchEvent(e)}attributeChangedCallback(e,t,r){if("src"===e){if(r&&null===t)this._init();else if(this.__initSrc&&t&&r!==this.__initSrc)throw this.setAttribute("src",this.__initSrc),a("change_lm_src",{tag:this.tagName.toLowerCase()})}else"pause"===e&&null===r&&this._init()}static get observedAttributes(){return["src","pause"]}}class ot extends it{constructor(...e){super(...e)}}const lt=()=>{customElements.define("load-module",it),customElements.define("l-m",ot),window.removeEventListener("load",lt)};"complete"===document.readyState?lt():window.addEventListener("load",lt),at.config=async function(e){const{alias:t}=e;return t&&Object.entries(t).forEach((([e,t])=>{if(!/^@.+/.test(e))throw a("config_alias_name_error",{name:e});if(tt[e])throw a("alias_already",{name:e});if(/^\./.test(t))throw a("alias_relate_name",{name:e,path:t});tt[e]=t})),!0},at.path=rt,Object.freeze(at),window.lm=at;const ct=rt;function ht(e,t){v(e,"[href],[src]").forEach((e=>{["href","src"].forEach((r=>{const n=e.getAttribute(r);/^#/.test(n)||n&&!/^(https?:)?\/\/\S+/.test(n)&&e.setAttribute(r,ct(n,t))}))})),v(e,"template").forEach((e=>{ht(e.content,t)}))}function dt(e,t){const r=document.createElement("template");return r.innerHTML=e,ht(r.content,t),v(r.content,"style").forEach((e=>{const r=e.innerHTML;e.innerHTML=r.replace(/url\((.+)\)/g,((e,r)=>`url(${ct(r,t)})`))})),r.innerHTML}const ut=Symbol("loadError"),ft=async e=>{const t=lm({url:e}),r=[];let n,s,i,o=e;for(;;){try{let e=o;const[r]=o.split(" "),s=new URL(r);/\/$/.test(s.pathname)&&(e+=" .html"),n=await t(e)}catch(e){let t;t=s?a("page_wrap_fetch",{before:s,current:o},e):a("load_page_module",{url:o},e),i=t,console.error(i)}if(i){r.unshift({src:e,ISERROR:ut,error:i});break}if(r.unshift({src:o,defaults:n}),!n.parent)break;s=o,o=ct(n.parent,o)}return r},pt=(e,t)=>{const r=document.createElement("div");r.innerHTML=`<o-page src="${e}" data-pause-init="1"></o-page>`;const n=We(r.children[0]);return f((async()=>{n._renderDefault||await mt(n),n._renderDefault(t),n.attr("data-pause-init",null)})),n},mt=e=>{if(!e._rendered)return new Promise((t=>{const r=setInterval((()=>{e._rendered&&(clearInterval(r),t())}),500)}))},_t=K.render;K.render=e=>{_t&&_t(e);const{step:t,name:r,target:n}=e,{link:s}=Te.extensions;if("init"===t)n.host&&s&&Te(n).all("a").forEach((e=>s(e)));else if("attr"===r&&"refresh"===t&&""===n.attr("olink")){const e=n.parents.pop()||n;if(e.__fixLinkTimer)return;e.__fixLinkTimer=f((()=>{const{host:t}=n;t&&"o-page"===t.tag&&ht(e.ele,t.src),s&&Te(e).all("a").forEach((e=>s(e))),delete e.__fixLinkTimer}))}};const gt=e=>{const t=Te(e);t.on("click",(r=>{if(r.__processed)return;const n=Te(r.target);let s=[n,...n.parents].find((e=>"a"===e.tag));if(s&&(s=s.ele),!s)return;if(!s.getAttribute("target")&&!s.getAttribute("download")&&s.attributes.hasOwnProperty("olink"))if(t.app){if(r.metaKey||r.shiftKey)return;if(r.defaultPrevented)return;r.preventDefault();let e=!1;if(r.preventDefault=()=>{e=!0},r.__processed=!0,"A"===s.tagName){const r=s.getAttribute("origin-href");setTimeout((()=>{const n=r||s.href;n&&!e&&t.app.goto(n)}))}}else console.warn(a("olink_out_app"),e)}))},yt=async(e,t,r=!0)=>{const n=new File([e],"genfile",{type:t});if(!r)return URL.createObjectURL(n);return await new Promise((e=>{const t=new FileReader;t.onload=t=>{e(t.target.result)},t.readAsDataURL(n)}))},wt=async(e,t,r,n,s)=>{const a=n.split("\n");let i="";for(let e=0;e<=s;e++)i+=";";let o=0,l=0;for(let e=t+1;e<r;e++){const t=a[e]||"";let r="";Array.from(t).forEach(((t,n)=>{const s=`AA${kt(e-o)}${kt(n-l)}`;r?r+=`,${s}`:r=s,o=e,l=n})),i+=`${r};`}const c=JSON.stringify([n]).replace(/^\[/,"").replace(/\]$/,""),h=`{"version": 3,\n    "sources": ["${e.replace(/\?.+/,"")}"],\n    "sourcesContent":[${c}],\n    "mappings": "${i}"}`;return await yt(h,"application/json")},bt=new Map;async function vt(e,t,r=!0){let n=bt.get(t);if(n)return n;let s=Te.debugMode;const a=Te("<template></template>");a.html=e;const i=a.$("title"),o=a.$(`template[${r?"page":"component"}]`),l=o.$("script");l&&l.remove();let c="";!!o.html.replace(/\<\!\-\-[\s\S]*?\-\-\>/g,"").trim()&&(c=o.html.replace(/\s+$/,"").replace(/`/g,"\\`").replace(/\$\{/g,"\\${"),s&&(c=await(async(e,t,r)=>{let n=e,s=t;const a=document.createElement("template");a.innerHTML=e;const i=a.content.querySelectorAll("style");for(let e of Array.from(i)){const a=e.innerHTML,{outerHTML:i}=e;let o=0;const l=s.split(i),c=l[0].split("\n").length-1,h=c+a.split("\n").length-1;let d="";for(let e=0,t=i.split("\n").length-1;e<t;e++)d+="\n";s=[l[0],d,l[1]].join("");const u=`/*# sourceMappingURL=${await wt(r,c,h,t,o)}*/`;n=n.replace(i,`${i.replace("</style>","")}\n${u}</style>`)}return n})(c,e,t)),c="<style>*:not(:defined){display:none;}</style>"+c);const h=`\n  export const type = ${r?"ofa.PAGE":"ofa.COMP"};\n  ${r&&i?`export const title = '${i.text}';`:""}\n  export const temp = \`${c}\`;`;let d="";l&&(d=l.html.split(/;/g).map((e=>{const r=e.trim();return/^import[ \{'"]/.test(r)?e.replace(/['"]([\s\S]+)['"]/,((e,r)=>`"${ct(r,t)}"`)):e})).join(";"));const u=`${h};\n${d}`;let f="";if(s){const r=e.split("\n"),n=r.findIndex((e=>"<script>"===e.trim())),s=r.findIndex((e=>"<\/script>"===e.trim()));f=`//# sourceMappingURL=${await wt(t,n,s,e,h.split("\n").length)}`}const p=`${u}\n${f}`,m=navigator.userAgent.includes("Firefox");return n=yt(p,"text/javascript",!m),bt.set(t,n),n}const xt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function kt(e){let t="",r=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{let e=31&r;r>>>=5,r>0&&(e|=32),t+=xt[e]}while(r>0);return t}const Et=Symbol("Page");Object.defineProperty(Te,"PAGE",{value:Et}),at.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +page *>/.test(r)&&!n.includes("-ignore-temp")){try{const t=await vt(r,e.url);e.result=await at()(`${t} .mjs --real:${e.url}`)}catch(t){throw a("load_page_module",{url:e.url},t)}e.resultContent=r}await t()})),at.use(["js","mjs"],(async(e,t)=>{const{result:r,url:n,realUrl:s}=e;if("object"!=typeof r||r.type!==Et)return void await t();const i=await At(r,s||n);let o=i.temp;if(!/<.+>/.test(o)){o=o?ct(o,n):n.replace(/\.m?js.*/,".html");try{i.temp=await fetch(o).then((e=>e.text()))}catch(e){const t=a("fetch_temp_err",{url:s||n,tempSrc:o},e);throw self.emit("error",{data:{error:t}}),t}}e.result=i,await t()})),setTimeout((()=>{Te.register({tag:"o-page",attrs:{src:null},data:{pageIsReady:null},watch:{async src(e){if(!e)return;if(!e.startsWith("//")&&!/[a-z]+:\/\//.test(e))return e=ct(e),void(this.src=e);if(this.__init_src){if(this.__init_src!==e)throw Error("A page that has already been initialized cannot be set with the src attribute");return}if(this.__init_src=e,this._defaults||this.attr("data-pause-init"))return;const t=await ft(e);if(this._defaults)return;const r=t.pop();if(t.forEach(((e,t)=>{const r=pt(e.src,e.defaults);if(this.parent)this.wrap(r);else{(this.__need_wraps||(this.__need_wraps=[])).push(r)}})),r.ISERROR===ut){const t=Ot(e,r,this?.app?._module?.fail);this._renderDefault({type:Et,temp:t})}else this._renderDefault(r.defaults)}},attached(){const e=this.__need_wraps;e&&(e.forEach((e=>{this.wrap(e)})),delete this.__need_wraps),this.__not_run_attached&&(this._defaults.attached&&this._defaults.attached.call(this),delete this.__not_run_attached)},detached(){const{_defaults:e}=this;e&&e.detached&&e.detached.call(this)},proto:{async _renderDefault(e){const{src:t}=this;if(e.data&&Object.keys(e.data).forEach((e=>{if(e in this)throw a("page_invalid_key",{src:t,targetName:"data",name:e})})),e.proto&&Object.keys(e.proto).forEach((r=>{r in this&&console.warn(i("page_invalid_key",{src:t,targetName:"proto",name:r}),e)})),this._defaults){const e=a("page_no_defaults",{src:t});throw console.warn(e,this),e}if(this._defaults=e,e.pageAnime&&(this._pageAnime=e.pageAnime),!e||e.type!==Et){const e=a("not_page_module",{src:t});throw console.warn(e,this),this.emit("error",{data:{error:e}}),this.__reject(e),e}const r=document.createElement("template");r.innerHTML=dt(e.temp,t);const n=re(r);try{Oe({defaults:e,ele:this.ele,template:r,temps:n})}catch(e){const r=a("page_failed",{src:t},e);console.error(r),console.warn(r,this)}await Tt(this,e.loaded),gt(this.shadow),this.emit("page-loaded"),this.__resolve(),this.pageIsReady=1;const{app:s}=this;s&&!s.appIsReady&&f((()=>{s.appIsReady=1})),this.ele.isConnected?e.attached&&e.attached.call(this):this.__not_run_attached=1},back(){this.app.back()},goto(e){this.app.goto(ct(e,this.src))},replace(e){this.app.replace(ct(e,this.src))},get pageAnime(){const{app:e,_pageAnime:t}=this,{pageAnime:r}=e?._module||{};return n={...r,...t||{}},JSON.parse(JSON.stringify(n));var n},set pageAnime(e){this._pageAnime=e}},ready(){this._rendered=new Promise(((e,t)=>{this.__resolve=()=>{delete this.__resolve,delete this.__reject,e()},this.__reject=()=>{delete this.__resolve,delete this.__reject,t()}}))}})}));const Tt=async(e,t)=>{const r=e.ele.shadowRoot;if(r){const e=v(r,"l-m,load-module").map((e=>new Promise((t=>{e.addEventListener("load",(e=>{t()}))}))));v(r,"link").forEach((t=>{"stylesheet"===t.rel&&e.push(new Promise((e=>{let r=()=>{clearInterval(n),t.removeEventListener("load",r),t.removeEventListener("error",r),e()};const n=setInterval((()=>{t.parentNode||r()}),100);t.sheet?r():(t.addEventListener("load",r),t.addEventListener("error",r))})))})),await Promise.all(e)}t&&t.call(e)},At=async(e,t)=>{let r={};const{default:n}=e,s=at({url:t});_(n)?r=await n({load:s,url:t,get query(){const e=new URL(t);return Object.fromEntries(Array.from(e.searchParams.entries()))}}):n instanceof Object&&(r={...n});return{proto:{},...e,...r}},Ot=(e,t,r)=>{let n;return n=r?r({src:e,error:t.error}):`<div style="padding:20px;color:red;">${(t.error.stack||t.error.toString()).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;")}</div>`,n},jt=Symbol("Component"),St=Symbol("PATH");Object.defineProperty(Te,"COMP",{value:jt});const Lt={};at.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +component *>/.test(r)&&!n.includes("-ignore-temp")){try{const t=await vt(r,e.url,!1);e.result=await at()(`${t} .mjs --real:${e.url}`)}catch(t){throw a("load_comp_module",{url:e.url},t)}e.resultContent=r}await t()})),at.use(["js","mjs"],(async(e,t)=>{const{result:r,url:n,realUrl:s}=e;if("object"!=typeof r||r.type!==jt)return void t();let i={};const{default:o}=r,l=s||n;_(o)?i=await o({load:at({url:l}),url:l}):o instanceof Object&&(i={...o});const{tag:c,temp:h}={...r,...i};let d=c;const u=l.match(/\/([^/]+)\.m?(js|htm|html)$/);d||u&&(d=y(u[1]));const f=Lt[d];if(f){if(l!==f)throw a("comp_registered",{name:d});return void await t()}Lt[d]=l;let p,m="";/<.+>/.test(h)?(p=l,m=h):""!==h&&(p=ct(h||`${u[1]}.html`,l),m=await fetch(p).then((e=>e.text())));const g={...r,...i},w=g.ready,{loaded:b}=g;g.ready=async function(...e){w&&w.apply(this,e),b&&Tt(this,b),this.shadow&&gt(this.shadow)};const v=g.created;g.created=function(...e){this[St]=l,v&&v.call(this,...e)};const x=dt(m,l||p);Te.register({...g,tag:d,temp:x}),await t()}));const $t="_history",Nt="_forwards",Ct=async({src:e,app:t})=>{const{loading:r,fail:n}=t._module||{};let s;if(r){if(s=qe(r()),!s){const e=a("loading_nothing");throw console.warn(e,r),e}t.push(s)}const i=[];{const{current:e}=t;if(e){i.push(e);for(let t of e.parents){if("o-page"!==t.tag)break;i.unshift(t)}}}const o=await ft(e);let l=t;const c=[],h=[];let d,u,f,p=!0;return o.forEach(((e,t)=>{const r=i[t];if(p){if(!r||r.src!==e.src)return p=!1,h.push(e),void(d=r);c.push(r),l=r}else h.push(e)})),i.length>o.length&&!d&&i.some(((e,t)=>{const r=o[t];if(!r||r.src!==e.src)return d=e,!0})),h.forEach((e=>{const{ISERROR:t}=e;let r;if(t){const t=Ot(e.src,e,n);r=pt(e.src,{type:Te.PAGE,temp:t})}else r=pt(e.src,e.defaults);if(u){if(!f)return u.push(r),void(f=r);f.push(r),f=r}else u=r})),u&&l.push(u),s&&s.remove(),{current:u,old:d,publics:c}},Mt=(e,t,r)=>{if(t&&t.length){const{current:n}=e;t.forEach((e=>{const{routerChange:t}=e._defaults;t&&t.call(e,{type:r,current:n})}))}};Te.register({tag:"o-app",temp:"<style>:host{position:relative;display:block}::slotted(*){display:block;width:100%;height:100%;}</style><slot></slot>",attrs:{src:null},data:{[$t]:[],appIsReady:null},watch:{async src(e){if(this.__init_src){if(this.__init_src!==e)throw a("app_src_change");return}if(!e)return;this.__init_src=e;let t=e;!e||e.startsWith("//")||/[a-z]+:\/\//.test(e)||(t=ct(e));const r=lm(),n=await r(t);n.allowForward&&(this[Nt]=[]);const s=await At(n,t);if(this._module=s,this.extend(s.proto),s.ready&&s.ready.call(this),!this._settedRouters&&!this.$("o-page")&&!this._initHome&&s.home){const e=new URL(s.home,t).href;this.push(`<o-page src="${e}"></o-page>`)}}},proto:{async forward(e=1){if(!this[Nt]){const e=a("need_forwards");return void console.warn(e,this)}e=e<this[Nt].length?e:this[Nt].length;const t=this[Nt].splice(-e);if(t.length)return this._navigate({type:"forward",src:t[0].src,forwardHistory:t,delta:e});{const e=a("app_noforward");console.warn(e,{app:this})}},async back(e=1){if(!this[$t].length){const e=a("app_noback");return void console.warn(e,{app:this})}const t=this.routers,{_noanime:r}=this;e=e<this[$t].length?e:this[$t].length;const n=this[$t].splice(-e)[0];let{current:s,old:i,publics:o}=await Ct({src:n.src,app:this});!r&&s&&await Rt({page:s,key:"previous"}),i&&(i=Dt(i));const l=t.slice(-1*e);this[Nt]&&this[Nt].push(...l),this.emit("router-change",{data:{name:"back",delta:e,historys:l}}),Mt(this,o,"back"),!r&&i&&await Ht({page:i,key:"next"}),i&&i.remove()},async _navigate(e){let{type:t,src:r}=e;const{_noanime:n}=this,{current:s}=this;r=ct(r),Pt(this,r),s||(this._initHome=r);let{current:a,old:i,publics:o}=await Ct({src:r,app:this});if(!a)return;!n&&a&&await Rt({page:a,key:"next"}),i&&(i=Dt(i));const l={name:t,src:r};if("goto"!==t&&"forward"!==t||s&&this[$t].push({src:s.src}),"goto"===t&&Array.isArray(this[Nt])&&(this[Nt]=[]),"forward"===t){const{forwardHistory:t}=e,r=t.slice(1).reverse();this[$t].push(...r),l.delta=e.delta}this.emit("router-change",{data:l}),Mt(this,o,t),s&&i&&(n||await Ht({page:i,key:"previous"}),i.remove())},goto(e){return this._navigate({type:"goto",src:e})},replace(e){return this._navigate({type:"replace",src:e})},get current(){return this.all("o-page").reverse().find((e=>{let t=e;for(;"o-page"===t.tag;){if(t.data.willRemoved)return!1;t=t.parent}return!0}))},get routers(){let{current:e}=this;if(!e)return[];return[...this[$t],{src:e.src}]},set routers(e){e=e.map((e=>(Pt(this,e.src),{src:e.src}))),this._settedRouters=1,this.html="";const t=e.slice(),r=t.pop();this[$t].length=0,this[$t].push(...t),this.push({tag:"o-page",src:r.src})}}});const Pt=(e,t)=>{const r=e?._module?.access;if(new URL(t).origin!==location.origin&&!r){const t=a("no_cross_access_func");throw console.warn(t,e.ele,e?._module),t}if(r){const n=r(t);if(!0!==n){const r=a("access_return_error",{src:t},n instanceof Error?n:void 0);throw console.warn(r,e),r}}},Rt=async({page:e,key:t})=>{e._rendered||await mt(e);const{pageAnime:r}=e,n=r[t];n&&(e.css={...e.css,...n},It((()=>{e.css={...e.css,transition:"all ease .3s",...r.current||{}}})))},Ht=({page:e,key:t})=>new Promise((r=>{const n=e.pageAnime[t];n?It((()=>{e.one("transitionend",r),e.css={...e.css,transition:"all ease .3s",...n}})):r()})),It=e=>requestAnimationFrame((()=>{setTimeout(e,5)})),Dt=e=>(e.css={position:"absolute",width:`${e.width}px`,height:`${e.height}px`},e.data.willRemoved=1,e),Ft=Te.fn.attr;function Ut(...e){let[t,r,n]=e;_(r)&&(r=r());const{host:s}=this;if(s&&["href","src"].includes(t)&&/^\./.test(r)){const{PATH:e}=s;if(e){const{href:n}=new URL(r,e);return Ft.call(this,t,n)}}return Ft.call(this,...e)}Ut.always=Ft.always,Te.fn.extend({get app(){let e=this;for(;e&&"o-app"!==e;){if("o-page"===e.tag){const t=e.parents.find((e=>"o-app"===e.tag));if(t){e=t;break}}if(e=e.host,!e)break}return e},get PATH(){return this[St]||this.src||null},attr:Ut});const Wt={},zt="<style>:host{display:contents}</style><slot></slot>",qt=Symbol("consumers"),Bt=Symbol("provider");Object.defineProperty(Te,"getRootProvider",{value:e=>Wt[e]}),Te.fn.getProvider=function(e){let t=null;return this.emit("update-consumer",{data:{method:"getProvider",name:e,callback(e){t=e}},composed:!0}),t},Te("html").on("update-consumer",(e=>{const{name:t,consumer:r,method:n}=e.data,s=Wt[t];if("getProvider"!==n){if(s)return s[qt].add(r),r[Bt]=s,void r._refresh();if(Wt[t]=null,r&&"o-consumer"===r.tag){let e=!1;Object.keys(r[R]).forEach((t=>{Kt.includes(t)||(r[t]=void 0,e=!0)})),e&&console.warn(i("no_provider",{name:r.name}),target)}}else e.data.callback(s)}));const Vt={_update(e){this[Bt]&&this[Bt]===e||(this[Bt]&&this._clear(),this.name&&this.emit("update-consumer",{data:{name:this.name,consumer:this},composed:!0}))},_clear(){this[Bt][qt].delete(this),this[Bt]=null}},Jt={name(){this.__named?(console.warn(i("context_change_name",{compName:` "${this.tag}" `}),this.ele),this._update()):this.__named=1}},Kt=["tag","name","class","style","id","x-bind-data","is-root"],Gt={tag:"o-provider",temp:zt,attrs:{name:null},watch:{...Jt},proto:{...Vt,get consumers(){return[...Array.from(this[qt])]},get provider(){return this[Bt]},_refresh(){this.consumers.forEach((e=>e._refresh()))},_setConsumer(e,t,r){if(r||void 0===this[e]||null===this[e]){if(null==t){let r=this.provider;for(;null==t&&r&&!(t=r[e]);)r=r.provider}this[qt].forEach((r=>{r._setConsumer?r._setConsumer(e,t):r[e]!==t&&(r[e]=t)}))}}},ready(){this[qt]=new Set,this.on("update-consumer",(e=>{if(e.target===e.currentTarget)return;const{name:t,consumer:r,method:n}=e.data;if(t&&this.name===t&&"getProvider"===n)return e.data.callback(this),void e.stopPropagation();t&&this.name===t&&(this[qt].add(r),r[Bt]=this,e.stopPropagation(),r._refresh())})),this.watch((e=>{if(e.target===this&&"set"===e.type){const{name:t,value:r}=e;Kt.includes(t)||this._setConsumer(t,r,1)}}))},attached(){const e=[];if(Array.from(this.ele.attributes).forEach((t=>{const{name:r,value:n}=t;Kt.includes(r)||(this[g(r)]=n,e.push(r))})),e.forEach((e=>this.ele.removeAttribute(e))),this._update(),this.$("slot")){const{ele:e}=this;Array.from(e.children).forEach((e=>Xt(e,this)))}}};Te.register({tag:"o-root-provider",attrs:{name:null},watch:{name(){if(!this.__named)return void(this.__named=1);const e=a("root_provider_name_change",{name:this.name});throw console.warn(e,this.ele),e}},proto:{_update(){},_refresh:Gt.proto._refresh,_setConsumer:Gt.proto._setConsumer,get consumers(){return[...Array.from(this[qt])]}},ready(){Gt.ready.call(this)},attached(){if(Wt[this.name]){const e=a("root_provider_exist",{name:this.name});throw console.warn(e,"exist:",Wt[this.name],", current:",this.ele),e}const e=null===Wt[this.name];Wt[this.name]=this,e&&Xt(document.body,this),Gt.attached.call(this)},detached(){Wt[this.name]===this&&(Wt[this.name]=null,this[qt].forEach((e=>{e._clear(),e._refresh()})))}}),Te.register(Gt);const Xt=(e,t,r=!0)=>{if("O-ROOT-PROVIDER"!==e.tagName){if("O-CONSUMER"===e.tagName||"O-PROVIDER"===e.tagName){const r=Te(e);if(r.name===t.name)return r._update(t),void r._refresh()}else{if("SLOT"===e.tagName&&r){const r=e.getAttribute("name")||"",n=e?.getRootNode()?.host;return void Array.from(n.children).forEach((e=>{(e.getAttribute("slot")||"")===r&&Xt(e,t)}))}e.shadowRoot&&Array.from(e.shadowRoot.children).forEach((e=>Xt(e,t,!1)))}Array.from(e.children).forEach((e=>Xt(e,t)))}};Te.register({tag:"o-consumer",temp:zt,attrs:{name:null},watch:{...Jt},proto:{...Vt,get provider(){return this[Bt]},_refresh(){const e={},t=[];let{provider:r}=this;for(;r;)Object.keys(r[R]).forEach((n=>{"tag"!==n&&"name"!==n&&(void 0!==e[n]&&null!==e[n]||(e[n]=r[n],t.push(n)))})),r=r.provider;Object.keys(this[R]).forEach((e=>{Kt.includes(e)||t.includes(e)||(this[e]=void 0)}));for(let[t,r]of Object.entries(e))this[t]=r}},ready(){const e=this._existAttrKeys=Object.values(this.ele.attributes).map((e=>e.name)).filter((e=>!Kt.includes(e)));this.watch((t=>{if(t.target===this&&"set"===t.type){const r=y(t.name);e.includes(r)&&(null===t.value||void 0===t.value?this.ele.removeAttribute(r):this.ele.setAttribute(r,t.value))}}))},attached(){this._update()}});const Yt=function(){try{const e=document.createElement("div"),t=document.createElement("div");e.style.cssText="\n          container-type: style;\n          position: absolute;\n          left: -9px;\n          width: 1px;\n          height: 1px;\n          overflow: hidden;\n          --test-prop: true;\n        ",t.style.cssText="\n          position: absolute;\n        ";const r=document.createElement("style");r.textContent='\n          @container style(--test-prop: true) {\n            #match-var-test-child {\n              font-family: "match-var-test";\n            }\n          }\n        ',e.id="match-var-test-container",t.id="match-var-test-child",e.appendChild(t),document.documentElement.appendChild(r),document.documentElement.appendChild(e);const n=window.getComputedStyle(t).fontFamily.includes("match-var-test");return document.documentElement.removeChild(r),document.documentElement.removeChild(e),n}catch(e){return console.error(e),!1}}();Te.register({tag:"match-var",temp:"<style>:host{display:none !important; }</style>",data:{},proto:{initContainerStyle(){this.__style||(this.__style=Te("<style></style>"),this.before(this.__style));const e=this._styleOriginText,t=Array.from(this.ele.attributes);this.__style.html=`@container ${t.map((e=>`style(--${e.name}: ${e.value})`)).join(" and ")} {${e}}`,this.html=""},__addStyle(){this.__added||Yt||(this.html=`<style>\n      ${this._styleOriginText}\n      </style>`,this.__added=!0)},__removeStyle(){this.__added&&!Yt&&(this.html="",this.__added=!1)}},attached(){this._styleOriginText||(this._styleOriginText=this.$("style").text,this.html=""),Yt?this.initContainerStyle():Zt.add(this)},detached(){Yt?this.__style&&(this.__style.remove(),this.__style=null):Zt.delete(this)}});const Zt=new Set;{let e=null;const t=async()=>{clearTimeout(e);for(const e of Zt){const t=Array.from(e.ele.attributes).every((t=>getComputedStyle(e.ele).getPropertyValue(`--${t.name}`)===t.value));Te.checkMatch.delay&&await new Promise((e=>setTimeout(e,Te.checkMatch.delay))),t?e.__addStyle():e.__removeStyle()}e=setTimeout(t,Te.checkMatch.time||100)};Yt||setTimeout((()=>{t()}),100),Object.defineProperties(Te,{checkMatch:{value:()=>!Yt&&(requestAnimationFrame((()=>{t()})),!0)}}),Yt||(Te.checkMatch.delay=2)}const Qt=e=>{const t=[e];if("o-if"==e.tag){let r=rr(e.next);t.push(...r)}else if("o-else-if"==e.tag){let r=rr(e.next);t.push(...r);let n=nr(e.prev);t.unshift(...n)}const r=t[0];"o-if"==r.tag?(clearTimeout(r.__refreshTimer),r.__refreshTimer=setTimeout((()=>{let e=null;for(let r=0;r<t.length;r++){const n=t[r];if("o-if"==n.tag||"o-else-if"==n.tag){if(n.value){e=n;break}}else e=n}e&&(er(e),e.attr("actived","")),t.forEach((t=>{t!==e&&(t.attr("actived",null),tr(t))}))}),0)):console.error("o-if must be the first element",t)},er=e=>{if(e.__rendered)return;const t=Me(e.ele);if(!t)return;const{target:r,data:n,temps:s}=t;e.html=e.__originHTML,Z({target:r,data:n,temps:s}),e.__rendered=!0,e.emit("rendered",{bubbles:!1})},tr=e=>{e.__rendered&&(e.ele.childNodes?.forEach((e=>Be(e))),e.html="",e.__rendered=!1)},rr=e=>{const t=[];for(;e&&("o-else-if"===e.tag||"o-else"===e.tag);)t.push(e),e=e.next;return t},nr=e=>{const t=[];for(;e&&("o-if"==e.tag||"o-else-if"==e.tag);)t.unshift(e),e=e.prev;return t},sr=function(e){e.__originHTML=e.html,e.html=""},ar="<style>:host{display:contents;}</style><slot></slot>";Te.register({tag:"o-if",temp:ar,data:{value:null},watch:{value(){Qt(this)}},created(){sr(this)}}),Te.register({tag:"o-else-if",temp:ar,data:{value:null},watch:{value(){Qt(this)}},created(){sr(this)}}),Te.register({tag:"o-else",temp:ar,created(){sr(this)}}),Te.register({tag:"o-fill",temp:"<style>:host{display:contents;}</style><slot></slot>",data:{value:null},proto:{refreshView(){const e=this.value,t=this.attr("name");if(!e||!e.length||this.__oldTempName&&this.__oldTempName!==t)return void Array.from(this.ele.childNodes).forEach((e=>{Be(e),e.remove()}));const{data:r,target:n,temps:s={}}=Me(this.ele),a=this.attr("fill-key")||"xid";let i=s[t];if(!i){if(!this.__originHTML)throw new Error("o-fill - Template not found: "+t);i=Te(`<template>${this.__originHTML}</template>`).ele}if(this.__oldTempName=t,!this.length){const t=document.createDocumentFragment();for(let n=0,o=e.length;n<o;n++){const o=e[n],l=Pe(o,s,i,r.$host||r,n,a);t.appendChild(l.ele)}return void this.ele.appendChild(t)}const o=e.map((e=>e[a]));for(let e of Array.from(this.ele.children)){const t=e.__render_data.$data[a];if(null==t)throw new Error("o-fill - The key value cannot be empty: "+t);o.includes(t)||(e.remove(),Be(e))}const{children:l}=this.ele;let c=[];const h=()=>{c=Array.from(l).map((e=>e.__render_data.$data[a]))};h();const d=this.ele;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n[a],u=c.indexOf(o);if(u>-1){const e=We(l[u]);l[t]!==e.ele&&(d.insertBefore(e.ele,l[t]),h()),e.__item.$data!==n&&(e.__item.$data=n),e.__item.$index!==t&&(e.__item.$index=t)}else{const e=Pe(n,s,i,r.$host||r,t,a);d.insertBefore(e.ele,l[t]),h()}}}},ready(){this.watchTick((e=>{e.hasModified("value")&&this.refreshView()}))},attached(){this.value&&this.refreshView()},created(){const e=this.all("o-fill:not([name])");if(e.length>0){const t=a("xhear_dbfill_noname");throw console.warn(t,this.ele,{content:this.html.trim()}),e.forEach((e=>{e.remove()})),t}if(this.length>1||0===this.length&&this.html.trim()){const e=a("temp_multi_child");console.warn(e,this.ele,{content:this.html.trim()}),this.__originHTML=`<div style="display: contents;">${this.html}</div>`}else this.__originHTML=this.html.trim();this.html=""}});Te.version="ofa.js@4.6.1".replace("ofa.js@","");let ir=!1;try{const e="undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:t&&"SCRIPT"===t.tagName.toUpperCase()&&t.src||new URL("ofa.min.js",document.baseURI).href;ir=e.includes("#debug")}catch(e){ir=!1}Object.defineProperty(Te,"debugMode",{get:()=>ir}),"undefined"!=typeof window&&(window.$=Te),Object.defineProperty(globalThis,"ofa",{value:Te}),e.Stanz=W,e.default=Te,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ofa.min.js.map
