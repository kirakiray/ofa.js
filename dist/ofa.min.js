//! ofa.js - v4.4.12 https://github.com/kirakiray/ofa.js  (c) 2018-2024 YAO
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).$=t()}(this,(function(){"use strict";const e=()=>Math.random().toString(32).slice(2),t=Object.prototype.toString,r=e=>t.call(e).toLowerCase().replace(/(\[object )|(])/g,""),n=e=>{const t=r(e);return"array"===t||"object"===t};let s,i=0;const a=new Set;function o(t){const r=`t-${e()}`;return clearTimeout(s),s=setTimeout((()=>{i=0})),a.add(r),Promise.resolve().then((()=>{if(i++,i>5e4){a.clear();const e="nextTick exceeds thread limit";throw console.error({desc:e,lastCall:t}),new Error(e)}a.has(r)&&(t(),a.delete(r))})),r}const c=(e,t,r={})=>([...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)].forEach((n=>{const s=Object.getOwnPropertyDescriptor(t,n),{configurable:i,enumerable:a,writable:o,get:c,set:l,value:h}=s;"value"in s?e.hasOwnProperty(n)?e[n]=h:Object.defineProperty(e,n,{enumerable:a,configurable:i,writable:o,...r,value:h}):Object.defineProperty(e,n,{enumerable:a,configurable:i,...r,get:c,set:l})})),e);function l(e){try{e.xid}catch(e){return h(e)}return!1}function h(e){const t=e.stack.split(/\\n/)[0].toLowerCase();return!(!t.includes("proxy")||!t.includes("revoked"))}const u=e=>r(e).includes("function"),d=e=>e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));const f=e=>e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),p=(e,t)=>{const r=document.createElement("template");return r.content.append(e.cloneNode()),!!r.content.querySelector(t)};const m=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},g=(e,t)=>e instanceof HTMLTemplateElement?Array.from(e.content.querySelectorAll(t)):Array.from(e.querySelectorAll(t));const{assign:_,freeze:y}=Object;class w{constructor(e){_(this,e),y(this)}hasModified(e){if("array"===this.type)return this.path.includes(this.currentTarget.get(e));const t=e.split(".");if(this.currentTarget===this.target&&this.name===t[0])return!0;const r=b(this,t).indexOf(this.target);if(r>-1){const e=t.slice(r+1);return!e.length||this.name===e[0]}return this.path.includes(this.currentTarget[e])}hasReplaced(e){if("set"!==this.type)return!1;const t=e.split(".");if(this.target===this.currentTarget&&this.name===t[0])return!0;const r=b(this,t).indexOf(this.target);if(r>-1){return t.slice(r+1)[0]===this.name}return!1}}const b=(e,t)=>{const r=[],n=t.slice();let s=e.currentTarget;for(;n.length;){const e=n.shift();s&&(s=s[e]),r.push(s)}return r};class v extends Array{constructor(e){super(...e)}hasModified(e){return this.some((t=>t.hasModified(e)))}hasReplaced(e){return this.some((t=>t.hasReplaced(e)))}}const E=({type:e,currentTarget:t,target:r,name:n,value:s,oldValue:i,args:a,path:o=[]})=>{if(o&&o.includes(t))return void console.warn("Circular references appear");let c={type:e,target:r,name:n,oldValue:i,value:s};if("array"===e&&(delete c.value,c.args=a),t._hasWatchs){const e=new w({currentTarget:t,...c,path:[...o]});t[N].forEach((t=>{t(e)}))}t._update&&t.owner.forEach((e=>{E({currentTarget:e,...c,path:[t,...o]})}))};var k={watch(t){const r="w-"+e();return this[N].set(r,t),r},unwatch(e){return this[N].delete(e)},watchTick(e,t){return this.watch(function(e,t=0){let r=null,n=[];return function(...s){n.push(...s),t>0?(clearTimeout(r),r=setTimeout((()=>{e.call(this,n),n=[],r=null}),t)):null===r&&(r=1,o((()=>{r=null;const t=n.slice();n=[],e.call(this,t)})))}}((t=>{l(this)||(t=t.filter((e=>{try{e.path.forEach((e=>e.xid))}catch(e){return!1}return!0})),e(new v(t)))}),t||0))},refresh(e){const t={...e,type:"refresh",target:this,currentTarget:this};E(t)},watchUntil(e){return new Promise((t=>{let r;const n=this.watch(r=()=>{e()&&(this.unwatch(n),t(this))});r()}))}};const x=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],$=Symbol("placeholder");const T={},A=Array.prototype;x.forEach((e=>{A[e]&&(T[e]=function(...t){const r=Array.from(this),s=A[e].apply(this[L],t),{deletedItems:i,addedItems:a}=function(e,t){const r=Array.from(t),n=Array.from(e),s=[],i=new Map,a=e.length;for(let t=0;t<a;t++){const n=e[t],i=r.indexOf(n);i>-1?r[i]=$:s.push(n)}const o=t.length;for(let e=0;e<o;e++){const r=t[e],s=n.indexOf(r);s>-1?n[s]=$:i.set(e,r)}return{deletedItems:s,addedItems:i}}(r,this);for(let[e,t]of a)C(t)?t._owner.push(this):n(t)&&(this.__unupdate=1,this[e]=t,delete this.__unupdate);for(let e of i)U(e,this);return E({type:"array",currentTarget:this,target:this,args:t,name:e,oldValue:r}),s===this[L]?this[M]:s})})),["concat","filter","slice","flatMap","map"].forEach((e=>{if("constructor"===e||x.includes(e))return;const t=Array.prototype[e];t instanceof Function&&(T[e]=function(...e){return t.call(Array.from(this),...e)})}));const{defineProperties:O,getOwnPropertyDescriptor:j,entries:S}=Object,L=Symbol("self"),M=Symbol("proxy"),N=Symbol("watchs"),R=Symbol("isxdata"),C=e=>e&&!!e[R];function P(t,r=F){let n,{proxy:s,revoke:i}=Proxy.revocable(this,r);return s._update=1,O(this,{xid:{value:t.xid||e()},_owner:{value:[]},owner:{configurable:!0,get(){return new Set(this._owner)}},[R]:{value:!0},[L]:{configurable:!0,get:()=>this},[M]:{configurable:!0,get:()=>s},[N]:{get:()=>n||(n=new Map)},_hasWatchs:{get:()=>!!n},_revoke:{value:i}}),Object.keys(t).forEach((e=>{const r=j(t,e);let{value:n,get:i,set:a}=r;i||a?O(this,{[e]:r}):s[e]=n})),s}class H extends Array{constructor(e){return super(),P.call(this,e)}revoke(){const e=this[L];e._onrevokes&&(e._onrevokes.forEach((e=>e())),e._onrevokes.length=0),e.__unupdate=1,e[N].clear(),S(this).forEach((([e,t])=>{C(t)&&(this[e]=null)})),e._owner.forEach((e=>{S(e).forEach((([t,r])=>{r===this&&(e[t]=null)}))})),delete e[L],delete e[M],e._revoke()}toJSON(){let e={},t=!0,r=-1;Object.keys(this).forEach((n=>{let s=this[n];/\D/.test(n)?t=!1:(n=parseInt(n))>r&&(r=n),C(s)&&(s=s.toJSON()),e[n]=s})),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return O(e,{xid:{get:()=>n}}),e}toString(){return JSON.stringify(this.toJSON())}extend(e,t){return c(this,e,t)}get(e){if(/\./.test(e)){const t=e.split(".");let r=this;for(let e=0,n=t.length;e<n;e++)try{r=r[t[e]]}catch(n){const s=new Error(`Failed to get data : ${t.slice(0,e).join(".")} \n${n.stack}`,{cause:n});throw Object.assign(s,{target:r}),s}return r}return this[e]}set(e,t){if(/\./.test(e)){const r=e.split("."),n=r.pop();let s=this;for(let e=0,t=r.length;e<t;e++)try{s=s[r[e]]}catch(t){const n=new Error(`Failed to get data : ${r.slice(0,e).join(".")} \n${t.stack}`,{cause:t});throw Object.assign(n,{target:s}),n}return s[n]=t}return this[e]=t}}H.prototype.extend({...k,...T},{enumerable:!1});const{defineProperties:I}=Object,D=({target:e,key:t,value:r,receiver:s,type:i,succeed:a})=>{const o=s[t];let c=r;if(C(c)){if(o===r)return!0;c._owner.push(s)}else if(n(r)){const n=Object.getOwnPropertyDescriptor(e,t);n&&!n.hasOwnProperty("value")||(c=new H(r),c._owner.push(s))}const l=o===r;!l&&C(o)&&U(o,s);const h=a(c);return!l&&!e.__unupdate&&E({type:i||"set",target:s,currentTarget:s,name:t,value:r,oldValue:o}),h},U=(e,t)=>{if(C(e)){const r=e._owner.indexOf(t);r>-1?e._owner.splice(r,1):console.error({desc:"This data is wrong, the owner has no boarding object at the time of deletion",target:t,mismatch:e})}},F={set(e,t,r,n){if("symbol"==typeof t)return Reflect.set(e,t,r,n);if(/^_/.test(t))return e.hasOwnProperty(t)?Reflect.set(e,t,r,n):I(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0;try{return D({target:e,key:t,value:r,receiver:n,succeed:r=>Reflect.set(e,t,r,n)})}catch(e){const s=new Error(`failed to set ${t} \n ${e.stack}`,{cause:e});throw Object.assign(s,{key:t,value:r,target:n}),s}},deleteProperty:(e,t)=>/^_/.test(t)||"symbol"==typeof t?Reflect.deleteProperty(e,t):D({target:e,key:t,value:void 0,receiver:e[M],type:"delete",succeed:()=>Reflect.deleteProperty(e,t)})},q={set:(e,t,r,n)=>/\D/.test(String(t))?e[t]===r||("html"===t?Reflect.set(e,t,r,n):F.set(e,t,r,n)):Reflect.set(e,t,r,n),get:(e,t,r)=>/\D/.test(String(t))?Reflect.get(e,t,r):Ce(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},B={beforeRender(){},render(){}},W=e=>e.__revokes||(e.__revokes=[]),J=(e,t)=>W(e).push(t),z=(e,t,r)=>{const n=`\nconst isRevokedErr = ${h.toString()}\nconst [$event] = $args;\nconst {data, errCall} = this;\ntry{\n  with(data){\n    return ${e};\n  }\n}catch(error){\n  if(isRevokedErr(error)){\n    return;\n  }\n  if(data.ele && !data.ele.isConnected){\n    return;\n  }\n  if(errCall){\n    const result = errCall(error);\n    if(result !== false){\n      console.error(error);\n    }\n  }else{\n    console.error(error);\n  }\n}\n`;return new Function("...$args",n).bind({data:t,...r})};function V({data:e,target:t,template:r,temps:n,isRenderSelf:s,...i}){const a=r&&r.innerHTML;a&&(t.innerHTML=a),B.beforeRender({target:t});const o=g(t,"xtext"),c=[],l=W(t);g(t,"style").forEach((t=>{const r=t.innerHTML;if(/data\(.+\)/.test(r)){const n=Array.from(new Set(r.match(/data\(.+?\)/g))).map((t=>{const r=t.replace(/data\((.+)\)/,"$1");return{dataExpr:t,func:z(r,e)}})),s=()=>{let e=r;n.forEach((({dataExpr:t,func:r})=>{e=e.replace(t,r())})),t.innerHTML!==e&&(t.innerHTML=e)};c.push(s);const i=()=>{n.length=0,m(c,s),m(W(t),i),m(l,i)};J(t,i),l.push(i)}})),o.forEach((t=>{const r=document.createTextNode(""),{parentNode:n}=t;n.insertBefore(r,t),n.removeChild(t);const s=z(t.getAttribute("expr"),e),i=()=>{const e=s();r.textContent!==String(e)&&(r.textContent=e)};c.push(i);const a=()=>{m(l,a),m(c,i),m(W(r),a)};l.push(a),J(r,a)}));const h=g(t,"[x-bind-data]");if(s&&p(t,"[x-bind-data]")&&h.unshift(t),h.forEach((r=>{const n=JSON.parse(r.getAttribute("x-bind-data")),s=Ce(r);for(let[i,a]of Object.entries(n))a.forEach((n=>{try{const{always:a}=s[i];let o,h=[];const u=()=>{const[r,a]=n,o=z(a,e,{errCall:e=>{const r=`Rendering of target element failed: ${s.ele.outerHTML} \n  ${e.stack}`;return console.error(r),console.error({stack:r,element:s.ele,target:t,error:e}),!1}});h=[r,o];const c=s[i](...h,{actionName:i,target:s,data:e,beforeArgs:n,args:h});return B.render({step:"refresh",args:n,name:i,target:s}),c};let d=()=>{const{revoke:t}=s[i];t&&t({actionName:i,target:s,data:e,beforeArgs:n,args:h,result:o}),m(l,d),m(W(r),d),m(c,u),d=null};a?c.push(u):o=u(),l.push(d),r!==t&&J(r,d)}catch(e){throw new Error(`Execution of the ${i} method reports an error: ${i}:${n[0]}="${n[1]}"  \n ${e.stack}`,{cause:e})}}));r.removeAttribute("x-bind-data"),r._bindingRendered=!0,r.dispatchEvent(new Event("binding-rendered"))})),t.__render_temps||function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)||(t.__render_temps=n),c.length){if(t.__render_data&&t.__render_data!==e){const r=new Error("An old listener already exists and the rendering of this element may be wrong");throw Object.assign(r,{element:t,old:t.__render_data,new:e}),r}t.__render_data=e,c.forEach((e=>e()));const r=e.watchTick((t=>{c.length?c.forEach((e=>e())):e.unwatch(r)}))}B.render({step:"init",target:t})}const K=e=>{const{tagName:t}=e;if("TEMPLATE"!==t){if(t){const t={};Array.from(e.attributes).forEach((r=>{const n=/(.*):(.+)/.exec(r.name);if(!n)return;let[,s,i]=n;s||(s="prop");(t[s]||(t[s]=[])).push([i,r.value]),e.removeAttribute(r.name)}));Object.keys(t).length&&e.setAttribute("x-bind-data",JSON.stringify(t))}Array.from(e.children).forEach(K)}},G=(e,t,r)=>{const n=Array.from(e.content.querySelectorAll(t));return r&&n.forEach(r),n};let X;const Y=t=>{let r={};const n={};G(t,"code",(t=>{const r=e();t.setAttribute("code-id",r),n[r]=t.innerHTML,t.innerHTML=""})),t.innerHTML=t.innerHTML.replace(/{{(.+?)}}/g,((e,t)=>`<xtext expr="${t}"></xtext>`));const s=t.getAttribute("name");if(s){const e=t.content.children;if(e.length>1){X||(console.warn("Only one child element can be contained within a template element. If multiple child elements appear, the child elements will be rewrapped within a <div> element"),X=1);const r=`wrapper-${s}`;t.innerHTML=`<div ${r} style="display:contents">${t.innerHTML}</div>`,console.warn(`The template "${s}" contains ${e.length} child elements that have been wrapped in a div element with attribute "${r}".`)}r[s]=t,t.remove()}G(t,"x-fill:not([name])",(t=>{if(t.querySelector("x-fill:not([name])"))throw new Error(`Don't fill unnamed x-fills with unnamed x-fill elements!!!\n${t.outerHTML}`);if(t.innerHTML.trim()){const r=`t${e()}`;t.setAttribute("name",r);const n=document.createElement("template");n.setAttribute("name",r),n.innerHTML=t.innerHTML,t.innerHTML="",t.appendChild(n)}})),G(t,"x-if,x-else-if,x-else",(e=>{const t=e.children[0];t&&"TEMPLATE"===t.tagName||(e.innerHTML=`<template condition>${e.innerHTML}</template>`)})),G(t,"template",(e=>{const t=Y(e);Object.keys(t).forEach((e=>{if(r[e])throw new Error(`Template "${e}" already exists`)})),r={...r,...t}})),Array.from(t.content.children).forEach((e=>K(e)));for(let[e,r]of Object.entries(n))G(t,`[code-id="${e}"]`,(e=>{e.removeAttribute("code-id"),e.innerHTML=r}));return r},Z=e=>u(e)?e():e,Q={prop(...e){let[t,r]=e;if(1===e.length)return this[t];r=Z(r),t=d(t),this.set(t,r)},attr(...e){let[t,r]=e;if(1===e.length)return this.ele.getAttribute(t);r=Z(r),null===r?this.ele.removeAttribute(t):this.ele.setAttribute(t,r)},class(...e){let[t,r]=e;if(1===e.length)return this.ele.classList.contains(t);r=Z(r),r?this.ele.classList.add(t):this.ele.classList.remove(t)}};Q.prop.always=!0,Q.attr.always=!0,Q.class.always=!0,Q.prop.revoke=({target:e,args:t,$ele:r,data:n})=>{const s=t[0];e.set(s,null)};const ee={sync(e,t,r){if(!r)throw new Error("Sync is only allowed within the renderer");[e,t]=r.beforeArgs,e=d(e),t=d(t);const{data:n}=r;if(n.get(t)instanceof Object){const e=`Object values cannot be synchronized using the sync function : ${t}`;throw console.log(e,n),new Error(e)}this[e]=n.get(t);const s=this.watch((r=>{if(r.hasModified(e))try{const r=this.get(e);n.set(t,r)}catch(e){}})),i=n.watch((r=>{if(r.hasModified(t))try{const r=n.get(t);this.set(e,r)}catch(e){}}));return()=>{this.unwatch(s),n.unwatch(i)}}};function te(e,t,r){let n;if(r){const s=r.beforeArgs[1];/[^\d\w_\$\.]/.test(s)||(t=r.data.get(s).bind(r.data)),n=()=>this.ele.removeEventListener(e,t)}return{revoker:n,name:e,func:t}}ee.sync.revoke=e=>{e.result()};const re={on(...e){const{revoker:t,name:r,func:n}=te.call(this,...e);return this.ele.addEventListener(r,n),t||this},one(...e){const{revoker:t,name:r,func:n}=te.call(this,...e);let s=e=>{this.off(r,s),n(e)};return this.ele.addEventListener(r,s),t||this},off(e,t){return this.ele.removeEventListener(e,t),this},emit(e,t){const r={...t};let n,s;return r.hasOwnProperty("data")&&(n=r.data,delete r.data),e instanceof Event?s=e:e&&(s=new Event(e,{bubbles:!0,...r})),n&&(s.data=n),this.ele.dispatchEvent(s),this}};re.on.revoke=e=>{e.result()},re.one.revoke=e=>{e.result()};const ne=(e,t,r,...n)=>{const{children:s}=e;t<0&&(t+=e.children.length),void 0===r&&(r=e.children.length-t);const i=[];for(let e=t,n=t+r;e<n;e++){const t=s[e];i.push(t)}if(i.forEach((e=>e&&e.remove())),n.length){const r=document.createDocumentFragment();n.forEach((e=>r.append(He(e).ele)));const i=s[t];i?e.insertBefore(r,i):e.appendChild(r)}return i},se=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],ie={push(...e){const{ele:t}=this;return ne(t,t.children.length,0,...e),E({type:"array",currentTarget:this,target:this,args:e,name:"push"}),t.children.length},pop(...e){const{ele:t}=this,r=ne(t,t.children.length-1,1,...e);return E({type:"array",currentTarget:this,target:this,args:e,name:"pop"}),Ce(r[0])},shift(...e){const{ele:t}=this,r=ne(t,0,1,...e);return E({type:"array",currentTarget:this,target:this,args:e,name:"shift"}),Ce(r[0])},unshift(...e){const{ele:t}=this;return ne(t,0,0,...e),E({type:"array",currentTarget:this,target:this,args:e,name:"unshift"}),t.children.length},splice(...e){const t=ne(this.ele,...e);return E({type:"array",currentTarget:this,target:this,args:e,name:"splice"}),t.map(Ce)},reverse(...e){const t=Array.from(this.ele.childNodes);ae.reverse.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.__internal=1,r.append(e)})),this.ele.append(r),t.forEach((e=>{delete e.__internal})),E({type:"array",currentTarget:this,target:this,args:e,name:"reverse"}),this},sort(...e){const t=Array.from(this.ele.children).map(Ce);ae.sort.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.ele.__internal=1,r.append(e.ele)})),this.ele.append(r),t.forEach((e=>{delete e.ele.__internal})),E({type:"array",currentTarget:this,target:this,args:e,name:"sort"}),this}},ae=Array.prototype;Object.keys(Object.getOwnPropertyDescriptors(ae)).forEach((e=>{if("constructor"===e||"length"===e||se.includes(e))return;const t=ae[e];u(t)&&(ie[e]=function(...e){return t.apply(Array.from(this.ele.children).map(Ce),e)})}));class oe{}for(let[e,t]of Object.entries(ie))Object.defineProperty(oe.prototype,e,{value:t});const ce=e=>new H(e);Object.assign(ce,{is:C});const{defineProperty:le,assign:he}=Object,ue=(e,t)=>{const{ele:r}=t;e.forEach((e=>{if(e in r){let n=!1;le(t,e,{enumerable:!0,get:()=>{let t=r[e];return n&&(/\D/.test(t)?n=!1:t=Number(t)),t},set:t=>{n="number"==typeof t,r[e]=t}})}}))},de=new Set(["input","textarea","select","option","button","label","fieldset","legend","form"]),fe=(e,t={})=>{const{name:r,type:n}=t,{ele:s}=e;let i=s[r];e.on(n,(()=>{E({type:"set",target:e,currentTarget:e,name:r,value:s[r],oldValue:i}),i=s[r]}))},pe=e=>{switch(e.attr("type")){case"file":ue(["multiple","files"],e),fe(e,{name:"files",type:"change"});break;case"checkbox":ue(["checked","multiple","value"],e),fe(e,{name:"checked",type:"change"});break;case"radio":ue(["checked","value"],e),fe(e,{name:"checked",type:"change"});break;default:ue(["placeholder","value"],e),fe(e,{name:"value",type:"input"})}},me=(e,t)=>{const r={};return e.all(t).forEach((e=>{const{name:t,tag:n,ele:s}=e;if("input"===n)switch(e.type){case"checkbox":t in r||(r[t]=[]),s.checked&&r[t].push(s.value);break;case"radio":s.checked&&(r[t]=s.value);break;case"file":r[t]=s.files;break;default:r[t]=s.value}else if("textarea"===n)r[t]=s.value;else if("select"===n){const e=g(s,"option:checked");if(s.multiple)r[t]=e.map((e=>e.value||e.textContent));else{const[n]=e;r[t]=n.value||n.textContent}}else r[t]=e.value})),r};var ge={formData(e,t={wait:200}){const r=ce({});he(r,me(this,e||"input,select,textarea"));const n=this.watchTick((t=>{const n=me(this,e||"input,select,textarea");!function(e,t){for(let r of Object.keys(e))t.hasOwnProperty(r)||delete e[r];for(let[r,n]of Object.entries(t))e[r]=n}(r,n)}),t.wait),s=r.watchTick((t=>{!function(e,t,r){const n=e.all(t);Object.keys(r).forEach((e=>{const t=n.filter((t=>t.attr("name")===e));if(0===t.length)return;const s=r[e],i=t[0],a=i.attr("type");if(1===t.length){let e=!0;if("input"!==i.tag||"radio"!==a&&"checkbox"!==a||(e=!1),e)return void(i.value!==s&&(i.value=s))}t.forEach((e=>{switch(e.attr("type")){case"radio":e.value===s?e.checked=!0:e.checked=!1;break;case"checkbox":e.checked=s.includes(e.value)}}))}))}(this,e||"input,select,textarea",r)})),i=this,a=r.revoke;return r.extend({revoke(){i.unwatch(n),r.unwatch(s),a.call(this)}}),r}};const _e={set:(e,t,r,n)=>(e._ele.style[t]=r,Reflect.set(e,t,r,n),!0),get(e,t,r){if("length"===t)return 0;const{style:n}=e._ele;return Array.from(n).includes(t)?n[t]:getComputedStyle(e._ele)[t]}};class ye{constructor(e){const t={};Object.defineProperty(t,"_ele",{enumerable:!1,get:()=>e.ele});const{style:r}=e.ele;return Array.from(r).forEach((e=>{t[e]=r[e]})),e._css=new Proxy(t,_e)}}var we={get css(){return new ye(this)},set css(e){if("string"==r(e))return void(this.ele.style=e);let{style:t}=this,n=Object.keys(e);Array.from(t).forEach((e=>{n.includes(e)||(t[e]="")})),Object.assign(t,e)}};const be={},ve=({defaults:e,ele:t,template:r,temps:n})=>{let s;try{const i={...xe(e.data),...e.attrs};e.attrs&&Object.keys(e.attrs).forEach((e=>{const r=t.getAttribute(f(e));null!=r&&(i[e]=r)})),s=Ce(t),e.proto&&s.extend(e.proto,{enumerable:!1});for(let[e,t]of Object.entries(i))s.hasOwnProperty(e)||(s[e]=t);if(e.temp){const e=t.attachShadow({mode:"open"});e.innerHTML=r.innerHTML,V({target:e,data:s,temps:n})}e.ready&&e.ready.call(s)}catch(e){throw new Error(`Render element error: ${t.tagName} \n  ${e.stack}`,{cause:e})}if(e.watch){const t=Object.entries(e.watch);s.watchTick((e=>{for(let[r,n]of t){const t=r.split(",");t.length>=2?t.some((t=>e.hasModified(t)))&&n.call(s,t.map((e=>s[e])),{watchers:e}):e.hasModified(r)&&n.call(s,s[r],{watchers:e})}}));for(let[e,r]of t){const t=e.split(",");t.length>=2?r.call(s,t.map((e=>s[e])),{}):r.call(s,s[e],{})}}},Ee=(e={})=>{const t={tag:"",temp:"",data:{},proto:{},...e};let n,s,i;try{if(function(e){if("-"===e.charAt(0)||"-"===e.charAt(e.length-1))throw new Error(`The string "${e}" cannot start or end with "-"`);for(let t=0;t<e.length-1;t++)if("-"===e.charAt(t)&&"-"===e.charAt(t+1))throw new Error(`The string "${e}" cannot have consecutive "-" characters`);if(!e.includes("-"))throw new Error(`The string "${e}" must contain at least one "-"`)}(t.tag),t.data=xe(t.data),i=(a=d(t.tag)).charAt(0).toUpperCase()+a.slice(1),be[i])throw new Error(`Component ${i} already exists`);n=document.createElement("template"),n.innerHTML=t.temp,s=Y(n)}catch(e){throw new Error(`Register Component Error: ${t.tag} \n  ${e.stack}`,{cause:e})}var a;const o=e=>{let t;return t=e instanceof Array?[...e]:Object.keys(e),t},c=be[i]=class extends HTMLElement{constructor(...e){super(...e);const i=Ce(this);if(t.created&&t.created.call(i),t.attrs){const e=o(t.attrs);i.watchTick((t=>{e.forEach((e=>{if(t.hasModified(e)){const t=i[e],n=f(e),s=this.getAttribute(n);if(null==t)this.removeAttribute(n);else if(s!==t){let e=t;const i=r(t);if("number"===i&&s===String(t))return;if("object"===i&&(e=JSON.stringify(e),e===s))return;this.setAttribute(n,e)}}}))})),e.forEach((e=>{null!==i[e]&&void 0!==i[e]&&i[e]!==t.attrs[e]&&this.setAttribute(f(e),i[e])}))}ve({defaults:t,ele:this,template:n,temps:s})}connectedCallback(){ke(this)||t.attached&&t.attached.call(Ce(this))}disconnectedCallback(){ke(this)||t.detached&&t.detached.call(Ce(this))}attributeChangedCallback(e,t,r){const n=Ce(this);/[^\d.]/.test(r)||"number"!=typeof n[e]||(r=Number(r)),n[d(e)]=r}static get observedAttributes(){return o(t.attrs||{}).map((e=>f(e)))}};if("loading"!==document.readyState)customElements.define(t.tag,c);else{const e="readystatechange";let r;document.addEventListener(e,r=()=>{customElements.define(t.tag,c),document.removeEventListener(e,r)})}};function ke(e){let t=e;for(;t;){if(t.__internal)return!0;if(t=t.parentNode||t.host,!t||t.tagName&&"BODY"===t.tagName)break}return!1}function xe(e){if(e instanceof Set||e instanceof Map)throw new Error("The data of the registered component should contain only regular data types such as String, Number, Object and Array. for other data types, please set them after ready.");if(e instanceof Function)throw new Error("Please write the function in the 'proto' property object.");if("object"!=typeof e||null===e)return e;const t=Array.isArray(e)?[]:{};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=xe(e[r]));return t}class $e extends Comment{constructor(e){const t="Fake Node"+(e?": "+e:"");super(` ${t} --end `),this._mark=e,this._inited=!1;const r=new Comment(` ${t} --start `);r.__fake_end=this,Object.defineProperty(this,"_start",{value:r})}init(){this._inited||(this.parentNode.insertBefore(this._start,this),this._inited=!0)}querySelector(e){return this.__searchEl(e,"find")}querySelectorAll(e){return this.__searchEl(e)}__searchEl(e,t="filter"){const r=this.parentNode;if(!r)return[];const n=this.children;return Array.from(r.querySelectorAll(e))[t]((e=>{let t=e;for(;;){if(n.includes(t))return!0;if(t=t.parentNode,!t)break}}))}insertBefore(e,t){const{parentNode:r}=this;Array.from(r.children).includes(t)?r.insertBefore(e,t):r.insertBefore(e,this)}appendChild(e){this.parentNode.insertBefore(e,this)}get children(){const e=[];let t=this;for(;;){if(t=t.previousSibling,!t)throw new Error("This is an unclosed FakeNode");if(t instanceof HTMLElement)e.unshift(t);else if(t===this._start)break}return e}get childNodes(){const e=[];let t=this;for(;;){if(t=t.previousSibling,!t)throw new Error("This is an unclosed FakeNode");if(t===this._start)break;e.unshift(t)}return e}set innerHTML(e){this.childNodes.forEach((e=>{e.remove()}));const t=document.createElement("template");t.innerHTML=e,Array.from(t.content.childNodes).forEach((e=>{this.appendChild(e)}))}get innerHTML(){const{children:e}=this;let t="";return e.forEach((e=>{t+=e.outerHTML+"\n"})),t}get nextElementSibling(){let e=this.nextSibling;return e?e.__fake_end?e.__fake_end:(!e||e instanceof Element||(e=e.nextElementSibling),e):null}get previousElementSibling(){const{_start:e}=this;let t=e.previousSibling;return t?t instanceof $e?t:e.previousElementSibling:null}}const Te=e=>{if(e.parentNode){const t=e.parentNode;Array.from(e.content.children).forEach((r=>{t.insertBefore(r,e)})),e.remove()}};if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))B.beforeRender=({target:e})=>{let t=[];for(;t=Array.from(e.querySelectorAll('template[is="replace-temp"]')),t.length;)t.forEach((e=>{Te(e)}))};else{class e extends HTMLTemplateElement{constructor(){super(),this.init()}init(){Te(this)}connectedCallback(){this.init()}}customElements.define("replace-temp",e,{extends:"template"})}const Ae={data:{value:null,__rendered:!1},watch:{value(){this._bindend&&this.refreshValue()}},proto:{refreshValue(){clearTimeout(this._timer),this._timer=setTimeout((()=>{const e=[this,...this._others];let t=!1;e.forEach((e=>{t?e._clearContent():e.value||"x-else"===e.tag?(t=!0,e._renderContent()):e._clearContent()})),this._fake.parentNode&&Ce(this._fake.parentNode).refresh()}),0)},_renderContent(){if(this.__rendered)return;this.__rendered=!0;const e=Oe(this._fake);if(!e)return;const{target:t,data:r,temps:n}=e;l(r)||(this._fake.innerHTML=this.__originHTML,V({target:t,data:r,temps:n}),this.emit("rendered",{bubbles:!1}))},_clearContent(){this.__rendered&&(this.__rendered=!1,Ie(this._fake),this._fake.innerHTML="",this.emit("clear",{bubbles:!1}))},init(){if(this._bindend)return;this._bindend=!0;const e=this._fake=new $e(this.tag);if(this.before(e),e.init(),this.remove(),"x-if"===this.tag){const t=this._others=[];let r=e;for(;r=r.nextElementSibling,r;)switch(r.tagName){case"X-ELSE":{const e=Ce(r);return e.init?e.init():e._if_ready=1,void t.push(e)}case"X-ELSE-IF":{const e=Ce(r);e._xif=this,t.push(e);break}}}}},created(){this.__originHTML=this.$("template[condition]").html,this.html=""},ready(){this.ele._bindingRendered?this.init():this.one("binding-rendered",(()=>this.init()))}};Ee({tag:"x-if",...Ae}),Ee({tag:"x-else-if",...Ae,watch:{value(){this._bindend&&this._xif&&this._xif.refreshValue()}}}),Ee({tag:"x-else",...Ae,watch:{},ready(){this._if_ready&&this.init()}});const Oe=e=>{for(;e&&!e.__render_data;)e=e.parentNode;return e?{target:e,data:e.__render_data,temps:e.__render_temps}:null};Ee({tag:"x-fill",data:{value:null},watch:{value(e,t){this.refreshValue(t?.watchers)}},proto:{refreshValue(e){const t=this.value;if(!this._bindend)return;const r=this._fake.children;if(!t)return r.forEach((e=>Ie(e))),void(this._fake.innerHTML="");if(!(t instanceof Array))return console.warn(`The value of x-fill component must be of type Array, and the type of the current value is ${getType(t)}`),void(r&&r.forEach((e=>{Ie(e),e.remove()})));const n=Oe(this._fake);if(!n)return;const{data:s,temps:i}=n,a=i[this._name],o=this.attr("fill-key")||"xid";if(r.length){if(e){if(!e.some((e=>e.path.length<=1)))return}const n=t.slice(),c=new Set(n.map((e=>{const t=e[o];return void 0===t?e:t}))),{parentNode:l}=this._fake;if("xid"!==o&&n.length!==c.size){const e="fill key duplicates";console.error(e),console.log(e,",its parent node is:",l,"host: ",Ce(l)?.host?.ele)}const h=[];for(let e=0,t=r.length;e<t;e++){const n=r[e],s=n._data_xid||n;c.has(s)?h.push(s):(Ie(n),n.remove(),r.splice(e,1),t--,e--)}let u=this._fake._start;const d=[];let f=0;for(;u;){if(u===this._fake){n.length&&n.forEach((e=>{const t=je(e,i,a,s.$host||s,f,o);f++,l.insertBefore(t.ele,u)}));break}if(!(u instanceof Element)){u=u.nextSibling;continue}const e=n.shift(),t=e instanceof Object,c=Ce(u).__item;if(void 0===e&&!n.length){d.push(u),u=u.nextSibling;continue}const p=h.indexOf(t?e[o]:e);if(p>-1){const n=r[p];(t?e[o]!==c.$data[o]:e!==c.$data)&&(n.__internal=1,l.insertBefore(n,u),delete n.__internal,u=n);const s=Ce(n);s.__item.$data!==e&&(s.__item.$data=e),s.__item.$index=f}else{const t=je(e,i,a,s.$host||s,f,o);l.insertBefore(t.ele,u),u=t.ele}f++,u=u.nextSibling}d.length&&d.forEach((e=>{Ie(e),e.remove()}))}else{const e=document.createDocumentFragment();t.forEach(((t,r)=>{const n=je(t,i,a,s.$host||s,r,o);e.appendChild(n.ele)})),this._fake.appendChild(e)}this._fake.parentNode&&Ce(this._fake.parentNode).refresh(),this.emit("rendered",{bubbles:!1})},init(){if(this._bindend)return;this._bindend=!0;const e=this._fake=new $e("x-fill");this.before(e),e.init(),this.remove(),this.refreshValue()}},ready(){if(this._name=this.attr("name"),!this._name){const e="The target element does not have a template name to populate";throw console.log(e,this.ele),new Error(e)}this.ele._bindingRendered?this.init():this.one("binding-rendered",(()=>this.init()))}});const je=(e,t,r,n,s,i)=>{const a=He(r.innerHTML),o=new H({$data:e,$ele:a,$host:n,$index:s});V({target:a.ele,data:o,temps:t,$host:n,isRenderSelf:!0});const c=a.ele.__revokes,l=()=>{m(c,l),o.revoke()};return c.push(l),a.__item=o,a.ele._data_xid=e[i]||e,a},{defineProperties:Se}=Object,Le=({_this:e,ele:t,proxySelf:r})=>{const n={owner:{get(){const{parentNode:r}=t,{_owner:n}=e,s=r?[Ce(r),...n]:[...n];return new Set(s)}},ele:{get:()=>t}},s=t.tagName&&t.tagName.toLowerCase();s&&(n.tag={enumerable:!0,value:s}),Se(e,n),(e=>{const{tag:t}=e;if(de.has(t))switch(ue(["type","name","disabled"],e),t){case"input":pe(e);break;case"textarea":ue(["value"],e),fe(e,{name:"value",type:"input"});break;case"option":ue(["selected","value"],e);break;case"select":{const{ele:t}=e;e.__unupdate=1,e.value=t.value,delete e.__unupdate,e.watch((()=>{t.value=e.value})),e.on("change",(()=>{e.value=t.value}))}}})(r)};class Me extends oe{constructor({ele:e}){super();const t=P.call(this,{},q);return Le({_this:this,ele:e,proxySelf:t}),e.__xhear__=t,t}get length(){return this.ele&&this.ele.children.length}$(e){let{ele:t}=this;t instanceof HTMLTemplateElement&&(t=t.content);const r=t.querySelector(e);return r?Ce(r):null}all(e){return g(this.ele,e).map(Ce)}extend(e,t){return c(this,e,t)}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get classList(){return this.ele.classList}get data(){return this.ele.dataset}get shadow(){return Ce(this.ele.shadowRoot)}get root(){const e=this.ele.getRootNode();return e?Ce(e):null}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t instanceof Node?Ce(t):null}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?Ce(e):null}get parents(){const e=[];let t=this;for(;t.parent;)t=t.parent,e.push(t);return e}get next(){const e=this.ele.nextElementSibling;return e?Ce(e):null}after(e){const{next:t}=this;t?t.before(e):this.parent.push(e)}get nexts(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r>t))}get prev(){const e=this.ele.previousElementSibling;return e?Ce(e):null}before(e){const t=He(e);this.parent.ele.insertBefore(t.ele,this.ele)}get prevs(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r<t))}get siblings(){return this.parent.filter((e=>e!==this))}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get style(){return this.ele.style}get width(){return parseInt(getComputedStyle(this.ele).width)||0}get height(){return parseInt(getComputedStyle(this.ele).height)||0}get clientWidth(){return this.ele.clientWidth}get clientHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}is(e){return p(this.ele,e)}remove(){const{parent:e}=this;e&&e.splice(e.indexOf(this),1)}clone(e=!0){return Ce(this.ele.cloneNode(e))}wrap(e){const t=He(e),{ele:r}=this;if(!r.parentNode)throw new Error("The target has a sibling element, so you can't use unwrap");return r.parentNode.insertBefore(t.ele,r),r.__internal=1,t.ele.appendChild(r),delete r.__internal,this}unwrap(){const{ele:e}=this,t=e.parentNode;if(t.children.length>1)throw new Error("The element itself must have a parent");return e.__internal=1,t.parentNode.insertBefore(e,t),t.remove(),delete e.__internal,this}}const Ne=H.prototype,Re=Me.prototype;Re.extend({get:Ne.get,set:Ne.set,toJSON:Ne.toJSON,toString:Ne.toString,...k,...re,...Q,...ee,...ge},{enumerable:!1}),Re.extend(we);const Ce=e=>e?e.__xhear__?e.__xhear__:new Me({ele:e}):null,Pe=document.createElement("template"),He=(e,t)=>{if(e instanceof Me)return e;if(e instanceof Node||e===window)return Ce(e);switch(r(e)){case"object":return(e=>{const t={...e};if(!e.tag)return null;const r=document.createElement(e.tag);delete t.tag;const n=Ce(r);return Object.assign(n,t),n})(e);case"string":return(e=>{Pe.innerHTML=e;const t=Pe.content.children[0]||Pe.content.childNodes[0];return Pe.innerHTML="",Ce(t)})(e)}},Ie=e=>{e.__revokes&&Array.from(e.__revokes).forEach((e=>e&&e())),e.childNodes&&Array.from(e.childNodes).forEach((e=>{Ie(e)}));const t=e?.shadowRoot?.__revokes;t&&[...t].forEach((e=>e()))};function De(e){if("string"===r(e)&&!/<.+>/.test(e)){const t=document.querySelector(e);return Ce(t)}return He(e)}function Ue(e,t,r,n){let s=e.host.root.$(`[inject-host="${t}"]`);if(s)return s.ele.__items.add(n),void(n.__host_link=s);s=r(),s.attr("inject-host",t),s.ele.__items=new Set([n]),n.__host_link=s;const{root:i}=e.host;i.ele===document?document.head.appendChild(s.ele):i.root.push(s)}function Fe(e){if(e.__inited&&e.__host_link){const t=e.__host_link.ele.__items;t.delete(e),t.size||e.__host_link.remove(),delete e.__inited}}Object.defineProperties(De,{extensions:{value:{}}}),Object.assign(De,{stanz:ce,render:V,convert:Y,register:Ee,nextTick:o,fn:Me.prototype,all:e=>g(document,e).map(Ce),frag:()=>De(document.createDocumentFragment())}),De.register({tag:"inject-host",temp:"<slot></slot>",data:{},proto:{init(){this.ele.isConnected&&this.forEach((e=>this._init(e)))},_init(e){if(!e.ele.__inited)switch(e.tag){case"link":this._initLink(e);break;case"style":this._initStyle(e);break;case"x-if":case"x-else-if":case"x-else":case"x-fill":break;default:console.log("This element will be invalidated within the inject-host",e)}},_initLink(e){const t=e.attr("href"),r=e.attr("rel");if("stylesheet"!==r&&"host"!==r)throw new Error('The "rel" attribute of the "link" tag within "inject-host" can only use "stylesheet" as its value.');let{ele:n}=e;"host"!==r&&(e.attr("rel","host"),e.attr("href",t)),n.__inited=!0,n._revoke=()=>{Fe(n),n._revoke=null},Ue(this,t,(()=>{const t=e.clone();return t.attr("rel","stylesheet"),t}),n)},async _initStyle(e){if(/data\(.+?\)/.test(e.html)){const t="Please do not use the data() method on style elements within inject-host, as it may cause serious performance crises.";return console.log(t,e.ele),void console.error(new Error(t))}const t=new Comment(e.html);t.__inited=!0,t._revoke=()=>{Fe(e.ele),delete t.__inited,delete e.ele.__inited,t._revoke=null,e.ele._revoke=null},e.html="",e.push(t),e.ele.__inited=!0,e.ele._revoke=t._revoke;Ue(this,function(e){let t=0,r=e.length;for(let n=0;n<r;n++){t=(t<<5)-t^e.charCodeAt(n),t=t<<13|t>>>19,t=7*t-3*t}return t.toString(36)+"--"+r}(t.data),(()=>De(`<style>${t.data}</style>`)),e.ele)}},attached(){(this._obs=new MutationObserver((e=>{for(let t of e)if("attributes"===t.type){if("x-bind-data"===t.attributeName)continue;const{target:e}=t;e.__inited&&(e._revoke(),this._init(Ce(e)))}else"childList"===t.type&&(t.removedNodes.forEach((e=>{e.__inited&&e._revoke()})),t.addedNodes.forEach((e=>{if(!e.__inited){if(e instanceof Text&&"STYLE"===e.parentElement.tagName&&this.init(e.parentNode),e.__inited)return;if(e instanceof Text||e instanceof Comment)return;this._init(Ce(e))}})))}))).observe(this.ele,{attributes:!0,childList:!0,subtree:!0}),this.init()},detached(){this.forEach((e=>Fe(e.ele))),this._obs.disconnect()}});class qe{constructor(){this._middlewares=new Map}use(e){const t=Math.random().toString(32).slice(2);return this._middlewares.set(t,e),t}unuse(e){return this._middlewares.delete(e)}async run(e){let t=-1;const r=Array.from(this._middlewares.values()),n=async()=>{t++,t<r.length&&await r[t](e,n)};await n()}}const Be=new Map,We=async(e,t)=>{const r=new URL(e),n=t.includes("-direct")?e:`${r.origin}${r.pathname}`;let s=Be.get(n);s||(s=fetch(n),Be.set(n,s));return(await s).clone()},Je={},ze=(e,t)=>{(Je[e]||(Je[e]=new qe)).use(t)},Ve=(e,t)=>{e instanceof Function&&(t=e,e=["js","mjs"]),e instanceof Array?e.forEach((e=>{ze(e,t)})):ze(e,t)};Ve(["mjs","js"],(async(e,t)=>{if(!e.result){const{url:t,params:r}=e,n=new URL(t),s=/^blob:/.test(t)||/^data:/.test(t);try{s||r.includes("-direct")?e.result=await import(t):e.result=await import(`${n.origin}${n.pathname}`)}catch(r){const n=Ke(`Failed to load module ${e.realUrl||t}`,r);throw s&&console.log("Failed to load module:",e),n}}await t()})),Ve(["txt","html","htm"],(async(e,t)=>{if(!e.result){const{url:t,params:r}=e;let n;try{n=await We(t,r)}catch(e){throw Ke(`Load ${t} failed`,e)}if(!/^2.{2}$/.test(n.status))throw new Error(`Load ${t} failed: status code ${n.status}`);e.result=await n.text()}await t()})),Ve("json",(async(e,t)=>{if(!e.result){const{url:t,params:r}=e;e.result=await We(t,r).then((e=>e.json()))}await t()})),Ve("wasm",(async(e,t)=>{if(!e.result){const{url:t,params:r}=e,n=await We(t,r).then((e=>e.arrayBuffer())),s=await WebAssembly.compile(n),i=new WebAssembly.Instance(s);e.result=i.exports}await t()})),Ve("css",(async(e,t)=>{if(!e.result){const{url:t,element:r,params:n}=e;if(r){const e=document.createElement("link");e.rel="stylesheet",e.href=t;const n=r.getRootNode();let s;n===document?n.head.append(e):n.appendChild(e),r.addEventListener("disconnected",s=t=>{e.remove(),r.removeEventListener("disconnected",s)})}else e.result=await We(t,n).then((e=>e.text()))}await t()}));const Ke=(e,t)=>new Error(`${e} \n  ${t.toString()}`,{cause:t}),Ge={};const Xe=(e,t)=>{if(e.startsWith("http://")||e.startsWith("https://"))return e;const[r,...n]=e.split(" ");let s=r;if(/^@/.test(r)){const[e,...t]=r.split("/");if(!Ge[e])throw new Error(`No alias defined ${e}`);s=[Ge[e].replace(/\/$/,""),...t].join("/")}if("undefined"!=typeof location){const e=t?new URL(t,location.href):location.href;s=new URL(s,e).href}return n.length?`${s} ${n.join(" ")}`:s},Ye=Symbol("loaded"),Ze=async(e,t)=>{const r=new URL(e),{pathname:n}=r;let s,i=null;t.params&&t.params.forEach((e=>{/^\..+/.test(e)?s=e.replace(/^\.(.+)/,"$1"):/^\-\-real/.test(e)&&(i=e.replace(/^\-\-real\:/,""))})),s||(s=n.slice(2+(n.lastIndexOf(".")-1>>>0)));const a={url:e,result:null,realUrl:i,...t},o=Je[s];if(o?await o.run(a):a.result=fetch(e),t&&t.element){const{element:e}=t;e[Ye]=!0;const r=new Event("load");e.dispatchEvent(r)}return t.params&&t.params.includes("-ctx")?a:a.result};function Qe(e,t){return((e,t)=>(e||(e={url:document.location.href}),r=>{let[n,...s]=r.split(" ");const i=Xe(n,e.url);return Ze(i,{params:s,...t})}))(e,t)}Object.assign(Qe,{use:Ve});class et extends HTMLElement{constructor(...e){super(...e),this[Ye]=!1,Object.defineProperties(this,{loaded:{get:()=>this[Ye]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let e=this.getAttribute("src");if(!e)return;this.__initSrc=e;lm(void 0,{element:this})(e),Object.defineProperties(this,{src:{configurable:!0,value:e}})}connectedCallback(){const e=new CustomEvent("connected");e.root=this._root=this.getRootNode(),this.dispatchEvent(e)}disconnectedCallback(){const e=new CustomEvent("disconnected");e.root=this._root,delete this._root,this.dispatchEvent(e)}attributeChangedCallback(e,t,r){"src"===e?r&&null===t?this._init():this.__initSrc&&t&&r!==this.__initSrc&&(console.warn(`${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`),this.setAttribute("src",this.__initSrc)):"pause"===e&&null===r&&this._init()}static get observedAttributes(){return["src","pause"]}}class tt extends et{constructor(...e){super(...e)}}const rt=()=>{customElements.define("load-module",et),customElements.define("l-m",tt),window.removeEventListener("load",rt)};"complete"===document.readyState?rt():window.addEventListener("load",rt),Qe.config=async function(e){const{alias:t}=e;return t&&Object.entries(t).forEach((([e,t])=>{if(/^@.+/.test(e)){if(Ge[e])throw new Error(`Alias already exists: '${e}'`);if(/^\./.test(t))throw new Error(`The address does not match the specification, please use '/' or or the beginning of the protocol: '${t}'`);Ge[e]=t}})),!0},Qe.path=Xe,Object.freeze(Qe),window.lm=Qe;const nt=Xe;function st(e,t){g(e,"[href],[src]").forEach((e=>{["href","src"].forEach((r=>{const n=e.getAttribute(r);/^#/.test(n)||n&&!/^(https?:)?\/\/\S+/.test(n)&&e.setAttribute(r,nt(n,t))}))})),g(e,"template").forEach((e=>{st(e.content,t)}))}function it(e,t){const r=document.createElement("template");return r.innerHTML=e,st(r.content,t),g(r.content,"style").forEach((e=>{const r=e.innerHTML;e.innerHTML=r.replace(/url\((.+)\)/g,((e,r)=>`url(${nt(r,t)})`))})),r.innerHTML}const at=Symbol("loadError"),ot=async e=>{const t=lm({url:e}),r=[];let n,s,i,a=e;for(;;){try{let e=a;const[r]=a.split(" "),s=new URL(r);/\/$/.test(s.pathname)&&(e+=" .html"),n=await t(e)}catch(e){let t;t=s?new Error(`${s} request to parent page(${a}) fails; \n  ${e.stack}`,{cause:e}):new Error(`Request for ${a} page failed; \n  ${e.stack}`,{cause:e}),i=t,console.error(i)}if(i){r.unshift({src:e,ISERROR:at,error:i});break}if(r.unshift({src:a,defaults:n}),!n.parent)break;s=a,a=nt(n.parent,a)}return r},ct=(e,t)=>{const r=document.createElement("div");r.innerHTML=`<o-page src="${e}" data-pause-init="1"></o-page>`;const n=Ce(r.children[0]);return o((()=>{n._renderDefault(t),n.attr("data-pause-init",null)})),n},lt=B.render;B.render=e=>{lt&&lt(e);const{step:t,name:r,target:n}=e,{link:s}=De.extensions;if("init"===t)n.host&&s&&De(n).all("a").forEach((e=>s(e)));else if("attr"===r&&"refresh"===t&&""===n.attr("olink")){const e=n.parents.pop()||n;if(e.__fixLinkTimer)return;e.__fixLinkTimer=o((()=>{const{host:t}=n;t&&"o-page"===t.tag&&st(e.ele,t.src),s&&De(e).all("a").forEach((e=>s(e))),delete e.__fixLinkTimer}))}};const ht=e=>{const t=De(e);t.on("click",(e=>{if(e.__processed)return;const r=De(e.target);let n=[r,...r.parents].find((e=>"a"===e.tag));if(n&&(n=n.ele),!n)return;if(!n.getAttribute("target")&&!n.getAttribute("download")&&n.attributes.hasOwnProperty("olink"))if(t.app){if(e.metaKey||e.shiftKey)return;if(e.defaultPrevented)return;e.preventDefault();let r=!1;if(e.preventDefault=()=>{r=!0},e.__processed=!0,"A"===n.tagName){const e=n.getAttribute("origin-href");setTimeout((()=>{const s=e||n.href;s&&!r&&t.app.goto(s)}))}}else console.warn("olink is only allowed within o-apps")}))},ut=async(e,t,r=!0)=>{const n=new File([e],"genfile",{type:"js"===t?"text/javascript":"application/json"});if(!r)return URL.createObjectURL(n);return await new Promise((e=>{const t=new FileReader;t.onload=t=>{e(t.target.result)},t.readAsDataURL(n)}))};let dt=!1;document.currentScript&&(dt=null!==document.currentScript.attributes.hasOwnProperty("draw-with-blob"));const ft=new Map;async function pt(e,t,r=!0){let n=ft.get(t);if(n)return n;let s=!0;De.hasOwnProperty("debugMode")&&(s=De.debugMode);const i=De("<template></template>");i.html=e;const a=i.$("title"),o=i.$(`template[${r?"page":"component"}]`),c=o.$("script");c&&c.remove();let l="";!!o.html.replace(/\<\!\-\-[\s\S]*?\-\-\>/g,"").trim()&&(l="<style>*:not(:defined){display:none;}</style>"+o.html.replace(/\s+$/,"").replace(/`/g,"\\`").replace(/\$\{/g,"\\${"));const h=`\n  export const type = ${r?"ofa.PAGE":"ofa.COMP"};\n  ${r&&a?`export const title = '${a.text}';`:""}\n  export const temp = \`${l}\`;`;let u="";c&&(u=c.html.split(/;/g).map((e=>{const r=e.trim();return/^import[ \{'"]/.test(r)?e.replace(/['"]([\s\S]+)['"]/,((e,r)=>`"${nt(r,t)}"`)):e})).join(";"));const d=`${h};\n${u}`;let f="";s&&(f=`//# sourceMappingURL=${await(async(e,t,r)=>{const n=t.split("\n");let s="";for(let e=0;e<=r;e++)s+=";";const i=n.findIndex((e=>"<script>"===e.trim())),a=n.findIndex((e=>"<\/script>"===e.trim()));let o=0,c=0;for(let e=i+1;e<a;e++){const t=n[e];let r="";Array.from(t).forEach(((t,n)=>{const s=`AA${gt(e-o)}${gt(n-c)}`;r?r+=`,${s}`:r=s,o=e,c=n})),s+=`${r};`}const l=JSON.stringify([t]).replace(/^\[/,"").replace(/\]$/,""),h=`{"version": 3,\n    "file": "${e.replace(/\?.+/,"").replace(/.+\/(.+?)/,"$1").replace(".html",".js")}",\n    "sources": ["${e.replace(/\?.+/,"")}"],\n    "sourcesContent":[${l}],\n    "mappings": "${s}"}`;return await ut(h,null)})(t,e,h.split("\n").length)}`);const p=`${d}\n${f}`,m=navigator.userAgent.includes("Firefox");return n=ut(p,"js",!m&&!dt),ft.set(t,n),n}const mt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function gt(e){let t="",r=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{let e=31&r;r>>>=5,r>0&&(e|=32),t+=mt[e]}while(r>0);return t}const _t=Symbol("Page");Object.defineProperty(De,"PAGE",{value:_t}),Qe.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +page *>/.test(r)&&!n.includes("-ignore-temp")){try{const t=await pt(r,e.url);e.result=await Qe()(`${t} .mjs --real:${e.url}`)}catch(t){throw new Error(`Error loading Page module: ${e.url}\n ${t.stack}`,{cause:t})}e.resultContent=r}await t()})),Qe.use(["js","mjs"],(async(e,t)=>{const{result:r,url:n,realUrl:s}=e;if("object"!=typeof r||r.type!==_t)return void await t();const i=await wt(r,s||n);let a=i.temp;/<.+>/.test(a)||(a=a?nt(a,n):n.replace(/\.m?js.*/,".html"),await(async(e,{self:t,desc:r,...n})=>{try{await e()}catch(e){const s=new Error(`${r}\n  ${e.stack}`,{cause:e});throw t.emit("error",{data:{error:s,...n}}),s}})((async()=>{i.temp=await fetch(a).then((e=>e.text()))}),{targetModule:"undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:document.currentScript&&document.currentScript.src||new URL("ofa.min.js",document.baseURI).href,desc:`${n} module request for ${a} template page failed`})),e.result=i,await t()})),setTimeout((()=>{De.register({tag:"o-page",attrs:{src:null},data:{pageIsReady:null},watch:{async src(e){if(!e)return;if(!e.startsWith("//")&&!/[a-z]+:\/\//.test(e))return e=nt(e),void(this.src=e);if(this.__init_src){if(this.__init_src!==e)throw Error("A page that has already been initialized cannot be set with the src attribute");return}if(this.__init_src=e,this._defaults||this.attr("data-pause-init"))return;const t=await ot(e);if(this._defaults)return;const r=t.pop();if(t.forEach(((e,t)=>{const r=ct(e.src,e.defaults);if(this.parent)this.wrap(r);else{(this.__need_wraps||(this.__need_wraps=[])).push(r)}})),r.ISERROR===at){const t=bt(e,r,this?.app?._module?.fail);this._renderDefault({type:_t,temp:t})}else this._renderDefault(r.defaults)}},attached(){const e=this.__need_wraps;e&&(e.forEach((e=>{this.wrap(e)})),delete this.__need_wraps),this.__not_run_attached&&(this._defaults.attached&&this._defaults.attached.call(this),delete this.__not_run_attached)},detached(){const{_defaults:e}=this;e&&e.detached&&e.detached.call(this)},proto:{async _renderDefault(e){const{src:t}=this;if(this._defaults)throw new Error("The current page has already been rendered");if(this._defaults=e,e.pageAnime&&(this._pageAnime=e.pageAnime),!e||e.type!==_t){const e=new Error(`The currently loaded module is not a page \nLoaded string => '${t}'`);throw this.emit("error",{data:{error:e}}),this.__reject(e),e}const r=document.createElement("template");r.innerHTML=it(e.temp,t);const n=Y(r);try{ve({defaults:e,ele:this.ele,template:r,temps:n})}catch(e){const r=new Error(`Failed to render page:${t} \n ${e.stack}`,{cause:e});console.error(r)}await yt(this,e.loaded),ht(this.shadow),this.emit("page-loaded"),this.__resolve(),this.pageIsReady=1;const{app:s}=this;s&&!s.appIsReady&&o((()=>{s.appIsReady=1})),this.ele.isConnected?e.attached&&e.attached.call(this):this.__not_run_attached=1},back(){this.app.back()},goto(e){this.app.goto(nt(e,this.src))},replace(e){this.app.replace(nt(e,this.src))},get pageAnime(){const{app:e,_pageAnime:t}=this,{pageAnime:r}=e?._module||{};return n={...r,...t||{}},JSON.parse(JSON.stringify(n));var n},set pageAnime(e){this._pageAnime=e}},ready(){this._rendered=new Promise(((e,t)=>{this.__resolve=()=>{delete this.__resolve,delete this.__reject,e()},this.__reject=()=>{delete this.__resolve,delete this.__reject,t()}}))}})}));const yt=async(e,t)=>{const r=e.ele.shadowRoot;if(r){const e=g(r,"l-m,load-module").map((e=>new Promise((t=>{e.addEventListener("load",(e=>{t()}))}))));g(r,"link").forEach((t=>{"stylesheet"===t.rel&&e.push(new Promise((e=>{let r=()=>{clearInterval(n),t.removeEventListener("load",r),t.removeEventListener("error",r),e()};const n=setInterval((()=>{t.parentNode||r()}),100);t.sheet?r():(t.addEventListener("load",r),t.addEventListener("error",r))})))})),await Promise.all(e)}t&&t.call(e)},wt=async(e,t)=>{let r={};const{default:n}=e,s=Qe({url:t});u(n)?r=await n({load:s,url:t,get query(){const e=new URL(t);return Object.fromEntries(Array.from(e.searchParams.entries()))}}):n instanceof Object&&(r={...n});return{proto:{},...e,...r}},bt=(e,t,r)=>{let n;return n=r?r({src:e,error:t.error}):`<div style="padding:20px;color:red;">${t.error.stack.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;")}</div>`,n},vt=Symbol("Component"),Et=Symbol("PATH");Object.defineProperty(De,"COMP",{value:vt});const kt={};Qe.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +component *>/.test(r)&&!n.includes("-ignore-temp")){try{const t=await pt(r,e.url,!1);e.result=await Qe()(`${t} .mjs --real:${e.url}`)}catch(t){throw new Error(`Error loading Component module: ${e.url}\n ${t.toString()}`,{cause:t})}e.resultContent=r}await t()})),Qe.use(["js","mjs"],(async(e,t)=>{const{result:r,url:n,realUrl:s}=e;if("object"!=typeof r||r.type!==vt)return void t();let i={};const{default:a}=r,o=s||n;u(a)?i=await a({load:Qe({url:o})}):a instanceof Object&&(i={...a});const{tag:c,temp:l}={...r,...i};let h=c;const d=o.match(/\/([^/]+)\.m?(js|htm|html)$/);h||d&&(h=f(d[1]));const p=kt[h];if(p){if(o!==p)throw new Error(`${h} components have been registered`);return void await t()}kt[h]=o;let m,g="";/<.+>/.test(l)?(m=o,g=l):""!==l&&(m=nt(l||`${d[1]}.html`,o),g=await fetch(m).then((e=>e.text())));const _={...r,...i},y=_.ready,{loaded:w}=_;_.ready=async function(...e){y&&y.apply(this,e),w&&yt(this,w),this.shadow&&ht(this.shadow)};const b=_.created;_.created=function(...e){this[Et]=o,b&&b.call(this,...e)};const v=it(g,o||m);De.register({..._,tag:h,temp:v}),await t()}));const xt="_history",$t=async({src:e,app:t})=>{const{loading:r,fail:n}=t._module||{};let s;if(r){if(s=He(r()),!s){const e="loading function returns no content";throw console.log(e,":",r),new Error(e)}t.push(s)}const i=[];{const{current:e}=t;if(e){i.push(e);for(let t of e.parents){if("o-page"!==t.tag)break;i.unshift(t)}}}const a=await ot(e);let o=t;const c=[],l=[];let h,u,d,f=!0;return a.forEach(((e,t)=>{const r=i[t];if(f){if(!r||r.src!==e.src)return f=!1,l.push(e),void(h=r);c.push(r),o=r}else l.push(e)})),i.length>a.length&&!h&&i.some(((e,t)=>{const r=a[t];if(!r||r.src!==e.src)return h=e,!0})),l.forEach((e=>{const{ISERROR:t}=e;let r;if(t){const t=bt(e.src,e,n);r=ct(e.src,{type:De.PAGE,temp:t})}else r=ct(e.src,e.defaults);if(u){if(!d)return u.push(r),void(d=r);d.push(r),d=r}else u=r})),u&&o.push(u),s&&s.remove(),{current:u,old:h,publics:c}},Tt=(e,t,r)=>{if(t&&t.length){const{current:n}=e;t.forEach((e=>{const{routerChange:t}=e._defaults;t&&t.call(e,{type:r,current:n})}))}};De.register({tag:"o-app",temp:"<style>:host{position:relative;display:block}::slotted(*){display:block;width:100%;height:100%;}</style><slot></slot>",attrs:{src:null},data:{[xt]:[],appIsReady:null},watch:{async src(e){if(this.__init_src){if(this.__init_src!==e)throw new Error("The App that has already been initialized cannot be set with the src attribute");return}if(!e)return;this.__init_src=e;let t=e;!e||e.startsWith("//")||/[a-z]+:\/\//.test(e)||(t=nt(e));const r=lm(),n=await r(t),s=await wt(n,t);if(this._module=s,this.extend(s.proto),s.ready&&s.ready.call(this),!this._settedRouters&&!this.$("o-page")&&!this._initHome&&s.home){const e=new URL(s.home,t).href;this.push(`<o-page src="${e}"></o-page>`)}}},proto:{async back(e=1){if(!this[xt].length)return void console.warn("It's already the first page, can't go back");const{_noanime:t}=this;e=e<this[xt].length?e:this[xt].length;const r=this[xt].splice(-e)[0];let{current:n,old:s,publics:i}=await $t({src:r.src,app:this});!t&&n&&Ot({page:n,key:"previous"}),s&&(s=Lt(s)),this.emit("router-change",{data:{name:"back",delta:e}}),Tt(this,i,"back"),!t&&s&&await jt({page:s,key:"next"}),s&&s.remove()},async _navigate({type:e,src:t}){const{_noanime:r}=this,{current:n}=this;t=nt(t),At(this,t),n||(this._initHome=t);let{current:s,old:i,publics:a}=await $t({src:t,app:this});s&&(r||Ot({page:s,key:"next"}),i&&(i=Lt(i)),"goto"===e&&n&&this[xt].push({src:n.src}),this.emit("router-change",{data:{name:e,src:t}}),Tt(this,a,e),n&&i&&(r||await jt({page:i,key:"previous"}),i.remove()))},goto(e){return this._navigate({type:"goto",src:e})},replace(e){return this._navigate({type:"replace",src:e})},get current(){return this.all("o-page").reverse().find((e=>{let t=e;for(;"o-page"===t.tag;){if(t.data.willRemoved)return!1;t=t.parent}return!0}))},get routers(){let{current:e}=this;if(!e)return[];return[...this[xt],{src:e.src}]},set routers(e){e=e.map((e=>(At(this,e.src),{src:e.src}))),this._settedRouters=1,this.html="";const t=e.slice(),r=t.pop();this[xt].length=0,this[xt].push(...t),this.push({tag:"o-page",src:r.src})}}});const At=(e,t)=>{const r=e?._module?.access;if(new URL(t).origin!==location.origin&&!r){const t="To jump across domains, the access function must be set";throw console.log(t,e.ele,e?._module),new Error(t)}if(r){const e=r(t);if(!0!==e){if(e instanceof Error)throw e;throw new Error(`Access to current address is not allowed: ${t}`)}}},Ot=({page:e,key:t})=>{const{pageAnime:r}=e,n=r[t];n&&(e.css={...e.css,...n},St((()=>{e.css={...e.css,transition:"all ease .3s",...r.current||{}}})))},jt=({page:e,key:t})=>new Promise((r=>{const n=e.pageAnime[t];n?St((()=>{e.one("transitionend",r),e.css={...e.css,transition:"all ease .3s",...n}})):r()})),St=e=>requestAnimationFrame((()=>{setTimeout(e,5)})),Lt=e=>(e.css={position:"absolute",width:`${e.width}px`,height:`${e.height}px`},e.data.willRemoved=1,e),Mt=De.fn.attr;function Nt(...e){let[t,r,n]=e;u(r)&&(r=r());const{host:s}=this;if(s&&["href","src"].includes(t)&&/^\./.test(r)){const{PATH:e}=s;if(e){const{href:n}=new URL(r,e);return Mt.call(this,t,n)}}return Mt.call(this,...e)}Nt.always=Mt.always,De.fn.extend({get app(){let e=this;for(;e&&"o-app"!==e;){if("o-page"===e.tag){const t=e.parents.find((e=>"o-app"===e.tag));if(t){e=t;break}}if(e=e.host,!e)break}return e},get PATH(){return this[Et]||this.src||null},attr:Nt});if(De.version="ofa.js@4.4.12".replace("ofa.js@",""),document.currentScript){const e=document.currentScript.attributes.hasOwnProperty("debug");Object.defineProperty(De,"debugMode",{value:e})}return"undefined"!=typeof window&&(window.$=De),Object.defineProperty(globalThis,"ofa",{value:De}),De}));
//# sourceMappingURL=ofa.min.js.map
