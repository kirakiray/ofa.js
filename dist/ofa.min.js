//! ofa.js - v4.4.16 https://github.com/kirakiray/ofa.js  (c) 2018-2024 YAO
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).$=t()}(this,(function(){"use strict";const e=()=>Math.random().toString(32).slice(2),t=Object.prototype.toString,r=e=>t.call(e).toLowerCase().replace(/(\[object )|(])/g,""),n=e=>{const t=r(e);return"array"===t||"object"===t},s={value:null};"undefined"!=typeof document&&(document.currentScript?s.value=document.currentScript.attributes.hasOwnProperty("debug"):s.value=!0);let a,i=0;const o=new Set;function l(t){if(clearTimeout(a),a=setTimeout((()=>{i=0})),s.value)return void Promise.resolve().then((()=>{if(i++,i>1e5){const e="nextTick exceeds thread limit";throw console.error({desc:e,lastCall:t}),new Error(e)}t()}));const r=`t-${e()}`;return o.add(r),Promise.resolve().then((()=>{if(i++,i>5e4){o.clear();const e="nextTick exceeds thread limit";throw console.error({desc:e,lastCall:t}),new Error(e)}o.has(r)&&(t(),o.delete(r))})),r}const c=(e,t,r={})=>([...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)].forEach((n=>{const s=Object.getOwnPropertyDescriptor(t,n),{configurable:a,enumerable:i,writable:o,get:l,set:c,value:h}=s;"value"in s?e.hasOwnProperty(n)?e[n]=h:Object.defineProperty(e,n,{enumerable:i,configurable:a,writable:o,...r,value:h}):Object.defineProperty(e,n,{enumerable:i,configurable:a,...r,get:l,set:c})})),e);function h(e){try{e.xid}catch(e){return u(e)}return!1}function u(e){const t=e.stack.split(/\\n/)[0].toLowerCase();return!(!t.includes("proxy")||!t.includes("revoked"))}const d=e=>r(e).includes("function"),f=e=>e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));const p=e=>e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})),m=(e,t)=>{const r=document.createElement("template");return r.content.append(e.cloneNode()),!!r.content.querySelector(t)};const g=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},_=(e,t)=>e instanceof HTMLTemplateElement?Array.from(e.content.querySelectorAll(t)):Array.from(e.querySelectorAll(t));const{assign:y,freeze:w}=Object;class b{constructor(e){y(this,e),w(this)}hasModified(e){if("array"===this.type)return this.path.includes(this.currentTarget.get(e));const t=e.split(".");if(this.currentTarget===this.target&&this.name===t[0])return!0;const r=v(this,t).indexOf(this.target);if(r>-1){const e=t.slice(r+1);return!e.length||this.name===e[0]}return this.path.includes(this.currentTarget[e])}hasReplaced(e){if("set"!==this.type)return!1;const t=e.split(".");if(this.target===this.currentTarget&&this.name===t[0])return!0;const r=v(this,t).indexOf(this.target);if(r>-1){return t.slice(r+1)[0]===this.name}return!1}}const v=(e,t)=>{const r=[],n=t.slice();let s=e.currentTarget;for(;n.length;){const e=n.shift();s&&(s=s[e]),r.push(s)}return r};class E extends Array{constructor(e){super(...e)}hasModified(e){return this.some((t=>t.hasModified(e)))}hasReplaced(e){return this.some((t=>t.hasReplaced(e)))}}const k=({type:e,currentTarget:t,target:r,name:n,value:s,oldValue:a,args:i,path:o=[]})=>{if(o&&o.includes(t))return void console.warn("Circular references appear");let l={type:e,target:r,name:n,oldValue:a,value:s};if("array"===e&&(delete l.value,l.args=i),t._hasWatchs){const e=new b({currentTarget:t,...l,path:[...o]});t[R].forEach((t=>{t(e)}))}t._update&&t.owner.forEach((e=>{k({currentTarget:e,...l,path:[t,...o]})}))};var x={watch(t){const r="w-"+e();return this[R].set(r,t),r},unwatch(e){return this[R].delete(e)},watchTick(e,t){return this.watch(function(e,t=0){let r=null,n=[];return function(...s){n.push(...s),t>0?(clearTimeout(r),r=setTimeout((()=>{e.call(this,n),n=[],r=null}),t)):null===r&&(r=1,l((()=>{r=null;const t=n.slice();n=[],e.call(this,t)})))}}((t=>{h(this)||(t=t.filter((e=>{try{e.path.forEach((e=>e.xid))}catch(e){return!1}return!0})),e(new E(t)))}),t||0))},refresh(e){const t={...e,type:"refresh",target:this,currentTarget:this};k(t)},watchUntil(e){return new Promise((t=>{let r;const n=this.watch(r=()=>{e()&&(this.unwatch(n),t(this))});r()}))}};const $=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],T=Symbol("placeholder");const A={},j=Array.prototype;$.forEach((e=>{j[e]&&(A[e]=function(...t){const r=Array.from(this),s=j[e].apply(this[M],t),{deletedItems:a,addedItems:i}=function(e,t){const r=Array.from(t),n=Array.from(e),s=[],a=new Map,i=e.length;for(let t=0;t<i;t++){const n=e[t],a=r.indexOf(n);a>-1?r[a]=T:s.push(n)}const o=t.length;for(let e=0;e<o;e++){const r=t[e],s=n.indexOf(r);s>-1?n[s]=T:a.set(e,r)}return{deletedItems:s,addedItems:a}}(r,this);for(let[e,t]of i)P(t)?t._owner.push(this):n(t)&&(this.__unupdate=1,this[e]=t,delete this.__unupdate);for(let e of a)F(e,this);return k({type:"array",currentTarget:this,target:this,args:t,name:e,oldValue:r}),s===this[M]?this[N]:s})})),["concat","filter","slice","flatMap","map"].forEach((e=>{if("constructor"===e||$.includes(e))return;const t=Array.prototype[e];t instanceof Function&&(A[e]=function(...e){return t.call(Array.from(this),...e)})}));const{defineProperties:O,getOwnPropertyDescriptor:S,entries:L}=Object,M=Symbol("self"),N=Symbol("proxy"),R=Symbol("watchs"),C=Symbol("isxdata"),P=e=>e&&!!e[C];function H(t,r=q){let n,{proxy:s,revoke:a}=Proxy.revocable(this,r);return s._update=1,O(this,{xid:{value:t.xid||e()},_owner:{value:[]},owner:{configurable:!0,get(){return new Set(this._owner)}},[C]:{value:!0},[M]:{configurable:!0,get:()=>this},[N]:{configurable:!0,get:()=>s},[R]:{get:()=>n||(n=new Map)},_hasWatchs:{get:()=>!!n},_revoke:{value:a}}),Object.keys(t).forEach((e=>{const r=S(t,e);let{value:n,get:a,set:i}=r;a||i?O(this,{[e]:r}):s[e]=n})),s}class I extends Array{constructor(e){return super(),H.call(this,e)}revoke(){const e=this[M];e._onrevokes&&(e._onrevokes.forEach((e=>e())),e._onrevokes.length=0),e.__unupdate=1,e[R].clear(),L(this).forEach((([e,t])=>{P(t)&&(this[e]=null)})),e._owner.forEach((e=>{L(e).forEach((([t,r])=>{r===this&&(e[t]=null)}))})),delete e[M],delete e[N],e._revoke()}toJSON(){let e={},t=!0,r=-1;Object.keys(this).forEach((n=>{let s=this[n];/\D/.test(n)?t=!1:(n=parseInt(n))>r&&(r=n),P(s)&&(s=s.toJSON()),e[n]=s})),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return O(e,{xid:{get:()=>n}}),e}toString(){return JSON.stringify(this.toJSON())}extend(e,t){return c(this,e,t)}get(e){if(/\./.test(e)){const t=e.split(".");let r=this;for(let e=0,n=t.length;e<n;e++)try{r=r[t[e]]}catch(n){const s=new Error(`Failed to get data : ${t.slice(0,e).join(".")} \n${n.stack}`,{cause:n});throw Object.assign(s,{target:r}),s}return r}return this[e]}set(e,t){if(/\./.test(e)){const r=e.split("."),n=r.pop();let s=this;for(let e=0,t=r.length;e<t;e++)try{s=s[r[e]]}catch(t){const n=new Error(`Failed to get data : ${r.slice(0,e).join(".")} \n${t.stack}`,{cause:t});throw Object.assign(n,{target:s}),n}return s[n]=t}return this[e]=t}}I.prototype.extend({...x,...A},{enumerable:!1});const{defineProperties:D}=Object,U=({target:e,key:t,value:r,receiver:s,type:a,succeed:i})=>{const o=s[t];let l=r;if(P(l)){if(o===r)return!0;l._owner.push(s)}else if(n(r)){const n=Object.getOwnPropertyDescriptor(e,t);n&&!n.hasOwnProperty("value")||(l=new I(r),l._owner.push(s))}const c=o===r;!c&&P(o)&&F(o,s);const h=i(l);return!c&&!e.__unupdate&&k({type:a||"set",target:s,currentTarget:s,name:t,value:r,oldValue:o}),h},F=(e,t)=>{if(P(e)){const r=e._owner.indexOf(t);r>-1?e._owner.splice(r,1):console.error({desc:"This data is wrong, the owner has no boarding object at the time of deletion",target:t,mismatch:e})}},q={set(e,t,r,n){if("symbol"==typeof t)return Reflect.set(e,t,r,n);if(/^_/.test(t))return e.hasOwnProperty(t)?Reflect.set(e,t,r,n):D(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0;try{return U({target:e,key:t,value:r,receiver:n,succeed:r=>Reflect.set(e,t,r,n)})}catch(e){const s=new Error(`failed to set ${t} \n ${e.stack}`,{cause:e});throw Object.assign(s,{key:t,value:r,target:n}),s}},deleteProperty:(e,t)=>/^_/.test(t)||"symbol"==typeof t?Reflect.deleteProperty(e,t):U({target:e,key:t,value:void 0,receiver:e[N],type:"delete",succeed:()=>Reflect.deleteProperty(e,t)})},B={set:(e,t,r,n)=>/\D/.test(String(t))?e[t]===r||("html"===t?Reflect.set(e,t,r,n):q.set(e,t,r,n)):Reflect.set(e,t,r,n),get:(e,t,r)=>/\D/.test(String(t))?Reflect.get(e,t,r):Pe(e.ele.children[t]),ownKeys(e){let t=Reflect.ownKeys(e),r=e.ele.children.length;for(let e=0;e<r;e++)t.push(String(e));return t},getOwnPropertyDescriptor:(e,t)=>"string"!=typeof t||/\D/.test(t)?Reflect.getOwnPropertyDescriptor(e,t):{enumerable:!0,configurable:!0}},W={beforeRender(){},render(){}},J=e=>e.__revokes||(e.__revokes=[]),z=(e,t)=>J(e).push(t),V=(e,t,r)=>{const n=`\nconst isRevokedErr = ${u.toString()}\nconst [$event] = $args;\nconst {data, errCall} = this;\ntry{\n  with(data){\n    return ${e};\n  }\n}catch(error){\n  if(isRevokedErr(error)){\n    return;\n  }\n  if(data.ele && !data.ele.isConnected){\n    return;\n  }\n  if(errCall){\n    const result = errCall(error);\n    if(result !== false){\n      console.error(error);\n    }\n  }else{\n    console.error(error);\n  }\n}\n`;return new Function("...$args",n).bind({data:t,...r})};function K({data:e,target:t,template:r,temps:n,isRenderSelf:s,...a}){const i=r&&r.innerHTML;i&&(t.innerHTML=i),W.beforeRender({target:t});const o=_(t,"xtext"),l=[],c=J(t);_(t,"style").forEach((t=>{const r=t.innerHTML;if(/data\(.+\)/.test(r)){const n=Array.from(new Set(r.match(/data\(.+?\)/g))).map((t=>{const r=t.replace(/data\((.+)\)/,"$1");return{dataExpr:t,func:V(r,e)}})),s=()=>{let e=r;n.forEach((({dataExpr:t,func:r})=>{e=e.replace(t,r())})),t.innerHTML!==e&&(t.innerHTML=e)};l.push(s);const a=()=>{n.length=0,g(l,s),g(J(t),a),g(c,a)};z(t,a),c.push(a)}})),o.forEach((t=>{const r=document.createTextNode(""),{parentNode:n}=t;n.insertBefore(r,t),n.removeChild(t);const s=V(t.getAttribute("expr"),e),a=()=>{const e=s();r.textContent!==String(e)&&(r.textContent=e)};l.push(a);const i=()=>{g(c,i),g(l,a),g(J(r),i)};c.push(i),z(r,i)}));const h=_(t,"[x-bind-data]");if(s&&m(t,"[x-bind-data]")&&h.unshift(t),h.forEach((r=>{const n=JSON.parse(r.getAttribute("x-bind-data")),s=Pe(r);for(let[a,i]of Object.entries(n))i.forEach((n=>{try{const{always:i}=s[a];let o,h=[];const u=()=>{const[r,i]=n,o=V(i,e,{errCall:e=>{const r=`Rendering of target element failed: ${s.ele.outerHTML} \n  ${e.stack}`;return console.error(r),console.error({stack:r,element:s.ele,target:t,error:e}),!1}});h=[r,o];const l=s[a](...h,{actionName:a,target:s,data:e,beforeArgs:n,args:h});return W.render({step:"refresh",args:n,name:a,target:s}),l};let d=()=>{const{revoke:t}=s[a];t&&t({actionName:a,target:s,data:e,beforeArgs:n,args:h,result:o}),g(c,d),g(J(r),d),g(l,u),d=null};i?l.push(u):o=u(),c.push(d),r!==t&&z(r,d)}catch(e){throw new Error(`Execution of the ${a} method reports an error: ${a}:${n[0]}="${n[1]}"  \n ${e.stack}`,{cause:e})}}));r.removeAttribute("x-bind-data"),r._bindingRendered=!0,r.dispatchEvent(new Event("binding-rendered"))})),t.__render_temps||function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(n)||(t.__render_temps=n),l.length){if(t.__render_data&&t.__render_data!==e){const r=new Error("An old listener already exists and the rendering of this element may be wrong");throw Object.assign(r,{element:t,old:t.__render_data,new:e}),r}t.__render_data=e,l.forEach((e=>e()));const r=e.watchTick((t=>{l.length?l.forEach((e=>e())):e.unwatch(r)}))}W.render({step:"init",target:t})}const G=e=>{const{tagName:t}=e;if("TEMPLATE"!==t){if(t){const t={};Array.from(e.attributes).forEach((r=>{const n=/(.*):(.+)/.exec(r.name);if(!n)return;let[,s,a]=n;s||(s="prop");(t[s]||(t[s]=[])).push([a,r.value]),e.removeAttribute(r.name)}));Object.keys(t).length&&e.setAttribute("x-bind-data",JSON.stringify(t))}Array.from(e.children).forEach(G)}},X=(e,t,r)=>{const n=Array.from(e.content.querySelectorAll(t));return r&&n.forEach(r),n};let Y;const Z=t=>{let r={};const n={};X(t,"code",(t=>{const r=e();t.setAttribute("code-id",r),n[r]=t.innerHTML,t.innerHTML=""})),t.innerHTML=t.innerHTML.replace(/{{(.+?)}}/g,((e,t)=>`<xtext expr="${t}"></xtext>`));const s=t.getAttribute("name");if(s){const e=t.content.children;if(e.length>1){Y||(console.warn("Only one child element can be contained within a template element. If multiple child elements appear, the child elements will be rewrapped within a <div> element"),Y=1);const r=`wrapper-${s}`;t.innerHTML=`<div ${r} style="display:contents">${t.innerHTML}</div>`,console.warn(`The template "${s}" contains ${e.length} child elements that have been wrapped in a div element with attribute "${r}".`)}r[s]=t,t.remove()}X(t,"x-fill:not([name])",(t=>{if(t.querySelector("x-fill:not([name])"))throw new Error(`Don't fill unnamed x-fills with unnamed x-fill elements!!!\n${t.outerHTML}`);if(t.innerHTML.trim()){const r=`t${e()}`;t.setAttribute("name",r);const n=document.createElement("template");n.setAttribute("name",r),n.innerHTML=t.innerHTML,t.innerHTML="",t.appendChild(n)}})),X(t,"x-if,x-else-if,x-else",(e=>{const t=e.children[0];t&&"TEMPLATE"===t.tagName||(e.innerHTML=`<template condition>${e.innerHTML}</template>`)})),X(t,"template",(e=>{const t=Z(e);Object.keys(t).forEach((e=>{if(r[e])throw new Error(`Template "${e}" already exists`)})),r={...r,...t}})),Array.from(t.content.children).forEach((e=>G(e)));for(let[e,r]of Object.entries(n))X(t,`[code-id="${e}"]`,(e=>{e.removeAttribute("code-id"),e.innerHTML=r}));return r},Q=e=>d(e)?e():e,ee={prop(...e){let[t,r]=e;if(1===e.length)return this[t];r=Q(r),t=f(t),this.set(t,r)},attr(...e){let[t,r]=e;if(1===e.length)return this.ele.getAttribute(t);r=Q(r),null===r?this.ele.removeAttribute(t):this.ele.setAttribute(t,r)},class(...e){let[t,r]=e;if(1===e.length)return this.ele.classList.contains(t);r=Q(r),r?this.ele.classList.add(t):this.ele.classList.remove(t)}};ee.prop.always=!0,ee.attr.always=!0,ee.class.always=!0,ee.prop.revoke=({target:e,args:t,$ele:r,data:n})=>{const s=t[0];e.set(s,null)};const te={sync(e,t,r){if(!r)throw new Error("Sync is only allowed within the renderer");[e,t]=r.beforeArgs,e=f(e),t=f(t);const{data:n}=r;if(n.get(t)instanceof Object){const e=`Object values cannot be synchronized using the sync function : ${t}`;throw console.log(e,n),new Error(e)}this[e]=n.get(t);const s=this.watch((r=>{if(r.hasModified(e))try{const r=this.get(e);n.set(t,r)}catch(e){}})),a=n.watch((r=>{if(r.hasModified(t))try{const r=n.get(t);this.set(e,r)}catch(e){}}));return()=>{this.unwatch(s),h(n)||n.unwatch(a)}}};function re(e,t,r){let n;if(r){const s=r.beforeArgs[1];/[^\d\w_\$\.]/.test(s)||(t=r.data.get(s).bind(r.data)),n=()=>this.ele.removeEventListener(e,t)}return{revoker:n,name:e,func:t}}te.sync.revoke=e=>{e.result()};const ne={on(...e){const{revoker:t,name:r,func:n}=re.call(this,...e);return this.ele.addEventListener(r,n),t||this},one(...e){const{revoker:t,name:r,func:n}=re.call(this,...e);let s=e=>{this.off(r,s),n(e)};return this.ele.addEventListener(r,s),t||this},off(e,t){return this.ele.removeEventListener(e,t),this},emit(e,t){const r={...t};let n,s;return r.hasOwnProperty("data")&&(n=r.data,delete r.data),e instanceof Event?s=e:e&&(s=new Event(e,{bubbles:!0,...r})),n&&(s.data=n),this.ele.dispatchEvent(s),this}};ne.on.revoke=e=>{e.result()},ne.one.revoke=e=>{e.result()};const se=(e,t,r,...n)=>{const{children:s}=e;t<0&&(t+=e.children.length),void 0===r&&(r=e.children.length-t);const a=[];for(let e=t,n=t+r;e<n;e++){const t=s[e];a.push(t)}if(a.forEach((e=>e&&e.remove())),n.length){const r=document.createDocumentFragment();n.forEach((e=>r.append(Ie(e).ele)));const a=s[t];a?e.insertBefore(r,a):e.appendChild(r)}return a},ae=["push","pop","shift","unshift","splice","reverse","sort","fill","copyWithin"],ie={push(...e){const{ele:t}=this;return se(t,t.children.length,0,...e),k({type:"array",currentTarget:this,target:this,args:e,name:"push"}),t.children.length},pop(...e){const{ele:t}=this,r=se(t,t.children.length-1,1,...e);return k({type:"array",currentTarget:this,target:this,args:e,name:"pop"}),Pe(r[0])},shift(...e){const{ele:t}=this,r=se(t,0,1,...e);return k({type:"array",currentTarget:this,target:this,args:e,name:"shift"}),Pe(r[0])},unshift(...e){const{ele:t}=this;return se(t,0,0,...e),k({type:"array",currentTarget:this,target:this,args:e,name:"unshift"}),t.children.length},splice(...e){const t=se(this.ele,...e);return k({type:"array",currentTarget:this,target:this,args:e,name:"splice"}),t.map(Pe)},reverse(...e){const t=Array.from(this.ele.childNodes);oe.reverse.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.__internal=1,r.append(e)})),this.ele.append(r),t.forEach((e=>{delete e.__internal})),k({type:"array",currentTarget:this,target:this,args:e,name:"reverse"}),this},sort(...e){const t=Array.from(this.ele.children).map(Pe);oe.sort.call(t,...e);const r=document.createDocumentFragment();return t.forEach((e=>{e.ele.__internal=1,r.append(e.ele)})),this.ele.append(r),t.forEach((e=>{delete e.ele.__internal})),k({type:"array",currentTarget:this,target:this,args:e,name:"sort"}),this}},oe=Array.prototype;Object.keys(Object.getOwnPropertyDescriptors(oe)).forEach((e=>{if("constructor"===e||"length"===e||ae.includes(e))return;const t=oe[e];d(t)&&(ie[e]=function(...e){return t.apply(Array.from(this.ele.children).map(Pe),e)})}));class le{}for(let[e,t]of Object.entries(ie))Object.defineProperty(le.prototype,e,{value:t});const ce=e=>new I(e);Object.assign(ce,{is:P});const{defineProperty:he,assign:ue}=Object,de=(e,t)=>{const{ele:r}=t;e.forEach((e=>{if(e in r){let n=!1;he(t,e,{enumerable:!0,get:()=>{let t=r[e];return n&&(/\D/.test(t)?n=!1:t=Number(t)),t},set:t=>{n="number"==typeof t,r[e]=t}})}}))},fe=new Set(["input","textarea","select","option","button","label","fieldset","legend","form"]),pe=(e,t={})=>{const{name:r,type:n}=t,{ele:s}=e;let a=s[r];e.on(n,(()=>{k({type:"set",target:e,currentTarget:e,name:r,value:s[r],oldValue:a}),a=s[r]}))},me=e=>{switch(e.attr("type")){case"file":de(["multiple","files"],e),pe(e,{name:"files",type:"change"});break;case"checkbox":de(["checked","multiple","value"],e),pe(e,{name:"checked",type:"change"});break;case"radio":de(["checked","value"],e),pe(e,{name:"checked",type:"change"});break;default:de(["placeholder","value"],e),pe(e,{name:"value",type:"input"})}},ge=(e,t)=>{const r={};return e.all(t).forEach((e=>{const{name:t,tag:n,ele:s}=e;if("input"===n)switch(e.type){case"checkbox":t in r||(r[t]=[]),s.checked&&r[t].push(s.value);break;case"radio":s.checked&&(r[t]=s.value);break;case"file":r[t]=s.files;break;default:r[t]=s.value}else if("textarea"===n)r[t]=s.value;else if("select"===n){const e=_(s,"option:checked");if(s.multiple)r[t]=e.map((e=>e.value||e.textContent));else{const[n]=e;r[t]=n.value||n.textContent}}else r[t]=e.value})),r};var _e={formData(e,t={wait:200}){const r=ce({});ue(r,ge(this,e||"input,select,textarea"));const n=this.watchTick((t=>{const n=ge(this,e||"input,select,textarea");!function(e,t){for(let r of Object.keys(e))t.hasOwnProperty(r)||delete e[r];for(let[r,n]of Object.entries(t))e[r]=n}(r,n)}),t.wait),s=r.watchTick((t=>{!function(e,t,r){const n=e.all(t);Object.keys(r).forEach((e=>{const t=n.filter((t=>t.attr("name")===e));if(0===t.length)return;const s=r[e],a=t[0],i=a.attr("type");if(1===t.length){let e=!0;if("input"!==a.tag||"radio"!==i&&"checkbox"!==i||(e=!1),e)return void(a.value!==s&&(a.value=s))}t.forEach((e=>{switch(e.attr("type")){case"radio":e.value===s?e.checked=!0:e.checked=!1;break;case"checkbox":e.checked=s.includes(e.value)}}))}))}(this,e||"input,select,textarea",r)})),a=this,i=r.revoke;return r.extend({revoke(){a.unwatch(n),r.unwatch(s),i.call(this)}}),r}};const ye={set:(e,t,r,n)=>(e._ele.style[t]=r,Reflect.set(e,t,r,n),!0),get(e,t,r){if("length"===t)return 0;const{style:n}=e._ele;return Array.from(n).includes(t)?n[t]:getComputedStyle(e._ele)[t]}};class we{constructor(e){const t={};Object.defineProperty(t,"_ele",{enumerable:!1,get:()=>e.ele});const{style:r}=e.ele;return Array.from(r).forEach((e=>{t[e]=r[e]})),e._css=new Proxy(t,ye)}}var be={get css(){return new we(this)},set css(e){if("string"==r(e))return void(this.ele.style=e);let{style:t}=this,n=Object.keys(e);Array.from(t).forEach((e=>{n.includes(e)||(t[e]="")})),Object.assign(t,e)}};const ve={},Ee=({defaults:e,ele:t,template:r,temps:n})=>{let s;try{const a={...$e(e.data),...e.attrs};e.attrs&&Object.keys(e.attrs).forEach((e=>{const r=t.getAttribute(p(e));null!=r&&(a[e]=r)})),s=Pe(t),e.proto&&s.extend(e.proto,{enumerable:!1});for(let[e,t]of Object.entries(a))s.hasOwnProperty(e)||(s[e]=t);if(e.temp){const e=t.attachShadow({mode:"open"});e.innerHTML=r.innerHTML,K({target:e,data:s,temps:n})}e.ready&&e.ready.call(s)}catch(e){throw new Error(`Render element error: ${t.tagName} \n  ${e.stack}`,{cause:e})}if(e.watch){const t=Object.entries(e.watch);s.watchTick((e=>{for(let[r,n]of t){const t=r.split(",");t.length>=2?t.some((t=>e.hasModified(t)))&&n.call(s,t.map((e=>s[e])),{watchers:e}):e.hasModified(r)&&n.call(s,s[r],{watchers:e})}}));for(let[e,r]of t){const t=e.split(",");t.length>=2?r.call(s,t.map((e=>s[e])),{}):r.call(s,s[e],{})}}},ke=(e={})=>{const t={tag:"",temp:"",data:{},proto:{},...e};let n,s,a;try{if(function(e){if("-"===e.charAt(0)||"-"===e.charAt(e.length-1))throw new Error(`The string "${e}" cannot start or end with "-"`);for(let t=0;t<e.length-1;t++)if("-"===e.charAt(t)&&"-"===e.charAt(t+1))throw new Error(`The string "${e}" cannot have consecutive "-" characters`);if(!e.includes("-"))throw new Error(`The string "${e}" must contain at least one "-"`)}(t.tag),t.data=$e(t.data),a=(i=f(t.tag)).charAt(0).toUpperCase()+i.slice(1),ve[a])throw new Error(`Component ${a} already exists`);n=document.createElement("template"),n.innerHTML=t.temp,s=Z(n)}catch(e){throw new Error(`Register Component Error: ${t.tag} \n  ${e.stack}`,{cause:e})}var i;const o=e=>{let t;return t=e instanceof Array?[...e]:Object.keys(e),t},l=ve[a]=class extends HTMLElement{constructor(...e){super(...e);const a=Pe(this);if(t.created&&t.created.call(a),t.attrs){const e=o(t.attrs);a.watchTick((t=>{e.forEach((e=>{if(t.hasModified(e)){const t=a[e],n=p(e),s=this.getAttribute(n);if(null==t)this.removeAttribute(n);else if(s!==t){let e=t;const a=r(t);if("number"===a&&s===String(t))return;if("object"===a&&(e=JSON.stringify(e),e===s))return;this.setAttribute(n,e)}}}))})),e.forEach((e=>{null!==a[e]&&void 0!==a[e]&&a[e]!==t.attrs[e]&&this.setAttribute(p(e),a[e])}))}Ee({defaults:t,ele:this,template:n,temps:s})}connectedCallback(){xe(this)||t.attached&&t.attached.call(Pe(this))}disconnectedCallback(){xe(this)||t.detached&&t.detached.call(Pe(this))}attributeChangedCallback(e,t,r){const n=Pe(this);/[^\d.]/.test(r)||"number"!=typeof n[e]||(r=Number(r)),n[f(e)]=r}static get observedAttributes(){return o(t.attrs||{}).map((e=>p(e)))}};if("loading"!==document.readyState)customElements.define(t.tag,l);else{const e="readystatechange";let r;document.addEventListener(e,r=()=>{customElements.define(t.tag,l),document.removeEventListener(e,r)})}};function xe(e){let t=e;for(;t;){if(t.__internal)return!0;if(t=t.parentNode||t.host,!t||t.tagName&&"BODY"===t.tagName)break}return!1}function $e(e){if(e instanceof Set||e instanceof Map)throw new Error("The data of the registered component should contain only regular data types such as String, Number, Object and Array. for other data types, please set them after ready.");if(e instanceof Function)throw new Error("Please write the function in the 'proto' property object.");if("object"!=typeof e||null===e)return e;const t=Array.isArray(e)?[]:{};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=$e(e[r]));return t}class Te extends Comment{constructor(e){const t="Fake Node"+(e?": "+e:"");super(` ${t} --end `),this._mark=e,this._inited=!1;const r=new Comment(` ${t} --start `);r.__fake_end=this,Object.defineProperty(this,"_start",{value:r})}init(){this._inited||(this.parentNode.insertBefore(this._start,this),this._inited=!0)}querySelector(e){return this.__searchEl(e,"find")}querySelectorAll(e){return this.__searchEl(e)}__searchEl(e,t="filter"){const r=this.parentNode;if(!r)return[];const n=this.children;return Array.from(r.querySelectorAll(e))[t]((e=>{let t=e;for(;;){if(n.includes(t))return!0;if(t=t.parentNode,!t)break}}))}insertBefore(e,t){const{parentNode:r}=this;Array.from(r.children).includes(t)?r.insertBefore(e,t):r.insertBefore(e,this)}appendChild(e){this.parentNode.insertBefore(e,this)}get children(){const e=[];let t=this;for(;;){if(t=t.previousSibling,!t)throw new Error("This is an unclosed FakeNode");if(t instanceof HTMLElement)e.unshift(t);else if(t===this._start)break}return e}get childNodes(){const e=[];let t=this;for(;;){if(t=t.previousSibling,!t)throw new Error("This is an unclosed FakeNode");if(t===this._start)break;e.unshift(t)}return e}set innerHTML(e){this.childNodes.forEach((e=>{e.remove()}));const t=document.createElement("template");t.innerHTML=e,Array.from(t.content.childNodes).forEach((e=>{this.appendChild(e)}))}get innerHTML(){const{children:e}=this;let t="";return e.forEach((e=>{t+=e.outerHTML+"\n"})),t}get nextElementSibling(){let e=this.nextSibling;return e?e.__fake_end?e.__fake_end:(!e||e instanceof Element||(e=e.nextElementSibling),e):null}get previousElementSibling(){const{_start:e}=this;let t=e.previousSibling;return t?t instanceof Te?t:e.previousElementSibling:null}}const Ae=e=>{if(e.parentNode){const t=e.parentNode;Array.from(e.content.children).forEach((r=>{t.insertBefore(r,e)})),e.remove()}};if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))W.beforeRender=({target:e})=>{let t=[];for(;t=Array.from(e.querySelectorAll('template[is="replace-temp"]')),t.length;)t.forEach((e=>{Ae(e)}))};else{class e extends HTMLTemplateElement{constructor(){super(),this.init()}init(){Ae(this)}connectedCallback(){this.init()}}customElements.define("replace-temp",e,{extends:"template"})}const je={data:{value:null,__rendered:!1},watch:{value(){this._bindend&&this.refreshValue()}},proto:{refreshValue(){clearTimeout(this._timer),this._timer=setTimeout((()=>{const e=[this,...this._others];let t=!1;e.forEach((e=>{t?e._clearContent():e.value||"x-else"===e.tag?(t=!0,e._renderContent()):e._clearContent()})),this._fake.parentNode&&Pe(this._fake.parentNode).refresh()}),0)},_renderContent(){if(this.__rendered)return;this.__rendered=!0;const e=Oe(this._fake);if(!e)return;const{target:t,data:r,temps:n}=e;h(r)||(this._fake.innerHTML=this.__originHTML,K({target:t,data:r,temps:n}),this.emit("rendered",{bubbles:!1}))},_clearContent(){this.__rendered&&(this.__rendered=!1,De(this._fake),this._fake.innerHTML="",this.emit("clear",{bubbles:!1}))},init(){if(this._bindend)return;this._bindend=!0;const e=this._fake=new Te(this.tag);if(this.before(e),e.init(),this.remove(),"x-if"===this.tag){const t=this._others=[];let r=e;for(;r=r.nextElementSibling,r;)switch(r.tagName){case"X-ELSE":{const e=Pe(r);return e.init?e.init():e._if_ready=1,void t.push(e)}case"X-ELSE-IF":{const e=Pe(r);e._xif=this,t.push(e);break}}}}},created(){this.__originHTML=this.$("template[condition]").html,this.html=""},ready(){this.ele._bindingRendered?this.init():this.one("binding-rendered",(()=>this.init()))}};ke({tag:"x-if",...je}),ke({tag:"x-else-if",...je,watch:{value(){this._bindend&&this._xif&&this._xif.refreshValue()}}}),ke({tag:"x-else",...je,watch:{},ready(){this._if_ready&&this.init()}});const Oe=e=>{for(;e&&!e.__render_data;)e=e.parentNode;return e?{target:e,data:e.__render_data,temps:e.__render_temps}:null};ke({tag:"x-fill",data:{value:null},watch:{value(e,t){this.refreshValue(t?.watchers)}},proto:{refreshValue(e){const t=this.value;if(!this._bindend)return;const r=this._fake.children;if(!t)return r.forEach((e=>De(e))),void(this._fake.innerHTML="");if(!(t instanceof Array))return console.warn(`The value of x-fill component must be of type Array, and the type of the current value is ${getType(t)}`),void(r&&r.forEach((e=>{De(e),e.remove()})));const n=Oe(this._fake);if(!n)return;const{data:s,temps:a}=n,i=a[this._name],o=this.attr("fill-key")||"xid";if(r.length){if(e){if(!e.some((e=>e.path.length<=1)))return}const n=t.slice(),l=new Set(n.map((e=>{const t=e[o];return void 0===t?e:t}))),{parentNode:c}=this._fake;if("xid"!==o&&n.length!==l.size){const e="fill key duplicates";console.error(e),console.log(e,",its parent node is:",c,"host: ",Pe(c)?.host?.ele)}const h=[];for(let e=0,t=r.length;e<t;e++){const n=r[e],s=n._data_xid||n;l.has(s)?h.push(s):(De(n),n.remove(),r.splice(e,1),t--,e--)}let u=this._fake._start;const d=[];let f=0;for(;u;){if(u===this._fake){n.length&&n.forEach((e=>{const t=Se(e,a,i,s.$host||s,f,o);f++,c.insertBefore(t.ele,u)}));break}if(!(u instanceof Element)){u=u.nextSibling;continue}const e=n.shift(),t=e instanceof Object,l=Pe(u).__item;if(void 0===e&&!n.length){d.push(u),u=u.nextSibling;continue}const p=h.indexOf(t?e[o]:e);if(p>-1){const n=r[p];(t?e[o]!==l.$data[o]:e!==l.$data)&&(n.__internal=1,c.insertBefore(n,u),delete n.__internal,u=n);const s=Pe(n);s.__item.$data!==e&&(s.__item.$data=e),s.__item.$index=f}else{const t=Se(e,a,i,s.$host||s,f,o);c.insertBefore(t.ele,u),u=t.ele}f++,u=u.nextSibling}d.length&&d.forEach((e=>{De(e),e.remove()}))}else{const e=document.createDocumentFragment();t.forEach(((t,r)=>{const n=Se(t,a,i,s.$host||s,r,o);e.appendChild(n.ele)})),this._fake.appendChild(e)}this._fake.parentNode&&Pe(this._fake.parentNode).refresh(),this.emit("rendered",{bubbles:!1})},init(){if(this._bindend)return;this._bindend=!0;const e=this._fake=new Te("x-fill");this.before(e),e.init(),this.remove(),this.refreshValue()}},ready(){if(this._name=this.attr("name"),!this._name){const e="The target element does not have a template name to populate";throw console.log(e,this.ele),new Error(e)}this.ele._bindingRendered?this.init():this.one("binding-rendered",(()=>this.init()))}});const Se=(e,t,r,n,s,a)=>{const i=Ie(r.innerHTML),o=new I({$data:e,$ele:i,$host:n,$index:s});K({target:i.ele,data:o,temps:t,$host:n,isRenderSelf:!0});const l=i.ele.__revokes,c=()=>{g(l,c),o.revoke()};return l.push(c),i.__item=o,i.ele._data_xid=e[a]||e,i},{defineProperties:Le}=Object,Me=({_this:e,ele:t,proxySelf:r})=>{const n={owner:{get(){const{parentNode:r}=t,{_owner:n}=e,s=r?[Pe(r),...n]:[...n];return new Set(s)}},ele:{get:()=>t}},s=t.tagName&&t.tagName.toLowerCase();s&&(n.tag={enumerable:!0,value:s}),Le(e,n),(e=>{const{tag:t}=e;if(fe.has(t))switch(de(["type","name","disabled"],e),t){case"input":me(e);break;case"textarea":de(["value"],e),pe(e,{name:"value",type:"input"});break;case"option":de(["selected","value"],e);break;case"select":{const{ele:t}=e;e.__unupdate=1,e.value=t.value,delete e.__unupdate,e.watch((()=>{t.value=e.value})),e.on("change",(()=>{e.value=t.value}))}}})(r)};class Ne extends le{constructor({ele:e}){super();const t=H.call(this,{},B);return Me({_this:this,ele:e,proxySelf:t}),e.__xhear__=t,t}get length(){return this.ele&&this.ele.children.length}$(e){let{ele:t}=this;t instanceof HTMLTemplateElement&&(t=t.content);const r=t.querySelector(e);return r?Pe(r):null}all(e){return _(this.ele,e).map(Pe)}extend(e,t){return c(this,e,t)}get text(){return this.ele.textContent}set text(e){this.ele.textContent=e}get html(){return this.ele.innerHTML}set html(e){this.ele.innerHTML=e}get classList(){return this.ele.classList}get data(){return this.ele.dataset}get shadow(){return Pe(this.ele.shadowRoot)}get root(){const e=this.ele.getRootNode();return e?Pe(e):null}get host(){let e=this.ele.getRootNode(),{host:t}=e;return t instanceof Node?Pe(t):null}get parent(){let{parentNode:e}=this.ele;return e&&e!==document?Pe(e):null}get parents(){const e=[];let t=this;for(;t.parent;)t=t.parent,e.push(t);return e}get next(){const e=this.ele.nextElementSibling;return e?Pe(e):null}after(e){const{next:t}=this;t?t.before(e):this.parent.push(e)}get nexts(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r>t))}get prev(){const e=this.ele.previousElementSibling;return e?Pe(e):null}before(e){const t=Ie(e);this.parent.ele.insertBefore(t.ele,this.ele)}get prevs(){const{parent:e}=this,t=this.index;return e.filter(((e,r)=>r<t))}get siblings(){return this.parent.filter((e=>e!==this))}get index(){let{parentNode:e}=this.ele;return e?Array.prototype.indexOf.call(e.children,this.ele):null}get style(){return this.ele.style}get width(){return parseInt(getComputedStyle(this.ele).width)||0}get height(){return parseInt(getComputedStyle(this.ele).height)||0}get clientWidth(){return this.ele.clientWidth}get clientHeight(){return this.ele.clientHeight}get offsetWidth(){return this.ele.offsetWidth}get offsetHeight(){return this.ele.offsetHeight}get outerWidth(){let e=getComputedStyle(this.ele);return this.ele.offsetWidth+parseInt(e["margin-left"])+parseInt(e["margin-right"])}get outerHeight(){let e=getComputedStyle(this.ele);return this.ele.offsetHeight+parseInt(e["margin-top"])+parseInt(e["margin-bottom"])}is(e){return m(this.ele,e)}remove(){const{parent:e}=this;e&&e.splice(e.indexOf(this),1)}clone(e=!0){return Pe(this.ele.cloneNode(e))}wrap(e){const t=Ie(e),{ele:r}=this;if(!r.parentNode)throw new Error("The target has a sibling element, so you can't use unwrap");return r.parentNode.insertBefore(t.ele,r),r.__internal=1,t.ele.appendChild(r),delete r.__internal,this}unwrap(){const{ele:e}=this,t=e.parentNode;if(t.children.length>1)throw new Error("The element itself must have a parent");return e.__internal=1,t.parentNode.insertBefore(e,t),t.remove(),delete e.__internal,this}}const Re=I.prototype,Ce=Ne.prototype;Ce.extend({get:Re.get,set:Re.set,toJSON:Re.toJSON,toString:Re.toString,...x,...ne,...ee,...te,..._e},{enumerable:!1}),Ce.extend(be);const Pe=e=>e?e.__xhear__?e.__xhear__:new Ne({ele:e}):null,He=document.createElement("template"),Ie=(e,t)=>{if(e instanceof Ne)return e;if(e instanceof Node||e===window)return Pe(e);switch(r(e)){case"object":return(e=>{const t={...e};if(!e.tag)return null;const r=document.createElement(e.tag);delete t.tag;const n=Pe(r);return Object.assign(n,t),n})(e);case"string":return(e=>{He.innerHTML=e;const t=He.content.children[0]||He.content.childNodes[0];return He.innerHTML="",Pe(t)})(e)}},De=e=>{e.__revokes&&Array.from(e.__revokes).forEach((e=>e&&e())),e.childNodes&&Array.from(e.childNodes).forEach((e=>{De(e)}));const t=e?.shadowRoot?.__revokes;t&&[...t].forEach((e=>e()))};function Ue(e){if("string"===r(e)&&!/<.+>/.test(e)){const t=document.querySelector(e);return Pe(t)}return Ie(e)}function Fe(e,t,r,n){let s=e.host.root.$(`[inject-host="${t}"]`);if(s)return s.ele.__items.add(n),void(n.__host_link=s);s=r(),s.attr("inject-host",t),s.ele.__items=new Set([n]),n.__host_link=s;const{root:a}=e.host;a.ele===document?document.head.appendChild(s.ele):a.root.push(s)}function qe(e){if(e.__inited&&e.__host_link){const t=e.__host_link.ele.__items;t.delete(e),t.size||e.__host_link.remove(),delete e.__inited}}Object.defineProperties(Ue,{extensions:{value:{}}}),Object.assign(Ue,{stanz:ce,render:K,convert:Z,register:ke,nextTick:l,fn:Ne.prototype,all:e=>_(document,e).map(Pe),frag:()=>Ue(document.createDocumentFragment())}),Ue.register({tag:"inject-host",temp:"<slot></slot>",data:{},proto:{init(){this.ele.isConnected&&this.forEach((e=>this._init(e)))},_init(e){if(!e.ele.__inited)switch(e.tag){case"link":this._initLink(e);break;case"style":this._initStyle(e);break;case"x-if":case"x-else-if":case"x-else":case"x-fill":break;default:console.log("This element will be invalidated within the inject-host",e)}},_initLink(e){const t=e.attr("href"),r=e.attr("rel");if("stylesheet"!==r&&"host"!==r)throw new Error('The "rel" attribute of the "link" tag within "inject-host" can only use "stylesheet" as its value.');let{ele:n}=e;"host"!==r&&(e.attr("rel","host"),e.attr("href",t)),n.__inited=!0,n._revoke=()=>{qe(n),n._revoke=null},Fe(this,t,(()=>{const t=e.clone();return t.attr("rel","stylesheet"),t}),n)},async _initStyle(e){if(/data\(.+?\)/.test(e.html)){const t="Please do not use the data() method on style elements within inject-host, as it may cause serious performance crises.";return console.log(t,e.ele),void console.error(new Error(t))}const t=new Comment(e.html);t.__inited=!0,t._revoke=()=>{qe(e.ele),delete t.__inited,delete e.ele.__inited,t._revoke=null,e.ele._revoke=null},e.html="",e.push(t),e.ele.__inited=!0,e.ele._revoke=t._revoke;Fe(this,function(e){let t=0,r=e.length;for(let n=0;n<r;n++){t=(t<<5)-t^e.charCodeAt(n),t=t<<13|t>>>19,t=7*t-3*t}return t.toString(36)+"--"+r}(t.data),(()=>Ue(`<style>${t.data}</style>`)),e.ele)}},attached(){(this._obs=new MutationObserver((e=>{for(let t of e)if("attributes"===t.type){if("x-bind-data"===t.attributeName)continue;const{target:e}=t;e.__inited&&(e._revoke(),this._init(Pe(e)))}else"childList"===t.type&&(t.removedNodes.forEach((e=>{e.__inited&&e._revoke()})),t.addedNodes.forEach((e=>{if(!e.__inited){if(e instanceof Text&&"STYLE"===e.parentElement.tagName&&this.init(e.parentNode),e.__inited)return;if(e instanceof Text||e instanceof Comment)return;this._init(Pe(e))}})))}))).observe(this.ele,{attributes:!0,childList:!0,subtree:!0}),this.init()},detached(){this.forEach((e=>qe(e.ele))),this._obs.disconnect()}});class Be{constructor(){this._middlewares=new Map}use(e){const t=Math.random().toString(32).slice(2);return this._middlewares.set(t,e),t}unuse(e){return this._middlewares.delete(e)}async run(e){let t=-1;const r=Array.from(this._middlewares.values()),n=async()=>{t++,t<r.length&&await r[t](e,n)};await n()}}const We=new Map,Je=async(e,t)=>{const r=new URL(e),n=t.includes("-direct")?e:`${r.origin}${r.pathname}`;let s=We.get(n);s||(s=fetch(n),We.set(n,s));return(await s).clone()},ze={},Ve=(e,t)=>{(ze[e]||(ze[e]=new Be)).use(t)},Ke=(e,t)=>{e instanceof Function&&(t=e,e=["js","mjs"]),e instanceof Array?e.forEach((e=>{Ve(e,t)})):Ve(e,t)};Ke(["mjs","js"],(async(e,t)=>{if(!e.result){const{url:t,params:r}=e,n=new URL(t),s=/^blob:/.test(t)||/^data:/.test(t);try{s||r.includes("-direct")?e.result=await import(t):e.result=await import(`${n.origin}${n.pathname}`)}catch(r){const n=Ge(`Failed to load module ${e.realUrl||t}`,r);throw s&&console.log("Failed to load module:",e),n}}await t()})),Ke(["txt","html","htm"],(async(e,t)=>{if(!e.result){const{url:t,params:r}=e;let n;try{n=await Je(t,r)}catch(e){throw Ge(`Load ${t} failed`,e)}if(!/^2.{2}$/.test(n.status))throw new Error(`Load ${t} failed: status code ${n.status}`);e.result=await n.text()}await t()})),Ke("json",(async(e,t)=>{if(!e.result){const{url:t,params:r}=e;e.result=await Je(t,r).then((e=>e.json()))}await t()})),Ke("wasm",(async(e,t)=>{if(!e.result){const{url:t,params:r}=e,n=await Je(t,r).then((e=>e.arrayBuffer())),s=await WebAssembly.compile(n),a=new WebAssembly.Instance(s);e.result=a.exports}await t()})),Ke("css",(async(e,t)=>{if(!e.result){const{url:t,element:r,params:n}=e;if(r){const e=document.createElement("link");e.rel="stylesheet",e.href=t;const n=r.getRootNode();let s;n===document?n.head.append(e):n.appendChild(e),r.addEventListener("disconnected",s=t=>{e.remove(),r.removeEventListener("disconnected",s)})}else e.result=await Je(t,n).then((e=>e.text()))}await t()}));const Ge=(e,t)=>new Error(`${e} \n  ${t.toString()}`,{cause:t}),Xe={};const Ye=(e,t)=>{if(e.startsWith("http://")||e.startsWith("https://"))return e;const[r,...n]=e.split(" ");let s=r;if(/^@/.test(r)){const[e,...t]=r.split("/");if(!Xe[e])throw new Error(`No alias defined ${e}`);s=[Xe[e].replace(/\/$/,""),...t].join("/")}if("undefined"!=typeof location){const e=t?new URL(t,location.href):location.href;s=new URL(s,e).href}return n.length?`${s} ${n.join(" ")}`:s},Ze=Symbol("loaded"),Qe=async(e,t)=>{const r=new URL(e),{pathname:n}=r;let s,a=null;t.params&&t.params.forEach((e=>{/^\..+/.test(e)?s=e.replace(/^\.(.+)/,"$1"):/^\-\-real/.test(e)&&(a=e.replace(/^\-\-real\:/,""))})),s||(s=n.slice(2+(n.lastIndexOf(".")-1>>>0)));const i={url:e,result:null,realUrl:a,...t},o=ze[s];if(o)await o.run(i);else{const t=await fetch(e),r=t.headers.get("Content-Type"),n=[["application/javascript","js"],["application/json","json"],["text/html","html"],["text/xml","xml"]].find((e=>r.includes(e[0])));let s;n&&(s=ze[n[1]]),s?await s.run(i):i.result=t}if(t&&t.element){const{element:e}=t;e[Ze]=!0;const r=new Event("load");e.dispatchEvent(r)}return t.params&&t.params.includes("-ctx")?i:i.result};function et(e,t){return((e,t)=>(e||(e={url:document.location.href}),r=>{let[n,...s]=r.split(" ");const a=Ye(n,e.url);return Qe(a,{params:s,...t})}))(e,t)}Object.assign(et,{use:Ke});class tt extends HTMLElement{constructor(...e){super(...e),this[Ze]=!1,Object.defineProperties(this,{loaded:{get:()=>this[Ze]}}),this._init()}_init(){if(this.__initSrc||this.attributes.hasOwnProperty("pause"))return;let e=this.getAttribute("src");if(!e)return;this.__initSrc=e;lm(void 0,{element:this})(e),Object.defineProperties(this,{src:{configurable:!0,value:e}})}connectedCallback(){const e=new CustomEvent("connected");e.root=this._root=this.getRootNode(),this.dispatchEvent(e)}disconnectedCallback(){const e=new CustomEvent("disconnected");e.root=this._root,delete this._root,this.dispatchEvent(e)}attributeChangedCallback(e,t,r){"src"===e?r&&null===t?this._init():this.__initSrc&&t&&r!==this.__initSrc&&(console.warn(`${this.tagName.toLowerCase()} change src is invalid, only the first change will be loaded`),this.setAttribute("src",this.__initSrc)):"pause"===e&&null===r&&this._init()}static get observedAttributes(){return["src","pause"]}}class rt extends tt{constructor(...e){super(...e)}}const nt=()=>{customElements.define("load-module",tt),customElements.define("l-m",rt),window.removeEventListener("load",nt)};"complete"===document.readyState?nt():window.addEventListener("load",nt),et.config=async function(e){const{alias:t}=e;return t&&Object.entries(t).forEach((([e,t])=>{if(/^@.+/.test(e)){if(Xe[e])throw new Error(`Alias already exists: '${e}'`);if(/^\./.test(t))throw new Error(`The address does not match the specification, please use '/' or or the beginning of the protocol: '${t}'`);Xe[e]=t}})),!0},et.path=Ye,Object.freeze(et),window.lm=et;const st=Ye;function at(e,t){_(e,"[href],[src]").forEach((e=>{["href","src"].forEach((r=>{const n=e.getAttribute(r);/^#/.test(n)||n&&!/^(https?:)?\/\/\S+/.test(n)&&e.setAttribute(r,st(n,t))}))})),_(e,"template").forEach((e=>{at(e.content,t)}))}function it(e,t){const r=document.createElement("template");return r.innerHTML=e,at(r.content,t),_(r.content,"style").forEach((e=>{const r=e.innerHTML;e.innerHTML=r.replace(/url\((.+)\)/g,((e,r)=>`url(${st(r,t)})`))})),r.innerHTML}const ot=Symbol("loadError"),lt=async e=>{const t=lm({url:e}),r=[];let n,s,a,i=e;for(;;){try{let e=i;const[r]=i.split(" "),s=new URL(r);/\/$/.test(s.pathname)&&(e+=" .html"),n=await t(e)}catch(e){let t;t=s?new Error(`${s} request to parent page(${i}) fails; \n  ${e.stack}`,{cause:e}):new Error(`Request for ${i} page failed; \n  ${e.stack}`,{cause:e}),a=t,console.error(a)}if(a){r.unshift({src:e,ISERROR:ot,error:a});break}if(r.unshift({src:i,defaults:n}),!n.parent)break;s=i,i=st(n.parent,i)}return r},ct=(e,t)=>{const r=document.createElement("div");r.innerHTML=`<o-page src="${e}" data-pause-init="1"></o-page>`;const n=Pe(r.children[0]);return l((async()=>{n._renderDefault||await ht(n),n._renderDefault(t),n.attr("data-pause-init",null)})),n},ht=e=>{if(!e._rendered)return new Promise((t=>{const r=setInterval((()=>{e._rendered&&(clearInterval(r),t())}),500)}))},ut=W.render;W.render=e=>{ut&&ut(e);const{step:t,name:r,target:n}=e,{link:s}=Ue.extensions;if("init"===t)n.host&&s&&Ue(n).all("a").forEach((e=>s(e)));else if("attr"===r&&"refresh"===t&&""===n.attr("olink")){const e=n.parents.pop()||n;if(e.__fixLinkTimer)return;e.__fixLinkTimer=l((()=>{const{host:t}=n;t&&"o-page"===t.tag&&at(e.ele,t.src),s&&Ue(e).all("a").forEach((e=>s(e))),delete e.__fixLinkTimer}))}};const dt=e=>{const t=Ue(e);t.on("click",(e=>{if(e.__processed)return;const r=Ue(e.target);let n=[r,...r.parents].find((e=>"a"===e.tag));if(n&&(n=n.ele),!n)return;if(!n.getAttribute("target")&&!n.getAttribute("download")&&n.attributes.hasOwnProperty("olink"))if(t.app){if(e.metaKey||e.shiftKey)return;if(e.defaultPrevented)return;e.preventDefault();let r=!1;if(e.preventDefault=()=>{r=!0},e.__processed=!0,"A"===n.tagName){const e=n.getAttribute("origin-href");setTimeout((()=>{const s=e||n.href;s&&!r&&t.app.goto(s)}))}}else console.warn("olink is only allowed within o-apps")}))},ft=async(e,t,r=!0)=>{const n=new File([e],"genfile",{type:"js"===t?"text/javascript":"application/json"});if(!r)return URL.createObjectURL(n);return await new Promise((e=>{const t=new FileReader;t.onload=t=>{e(t.target.result)},t.readAsDataURL(n)}))},pt=new Map;async function mt(e,t,r=!0){let n=pt.get(t);if(n)return n;let s=!0;Ue.hasOwnProperty("debugMode")&&(s=Ue.debugMode);const a=Ue("<template></template>");a.html=e;const i=a.$("title"),o=a.$(`template[${r?"page":"component"}]`),l=o.$("script");l&&l.remove();let c="";!!o.html.replace(/\<\!\-\-[\s\S]*?\-\-\>/g,"").trim()&&(c="<style>*:not(:defined){display:none;}</style>"+o.html.replace(/\s+$/,"").replace(/`/g,"\\`").replace(/\$\{/g,"\\${"));const h=`\n  export const type = ${r?"ofa.PAGE":"ofa.COMP"};\n  ${r&&i?`export const title = '${i.text}';`:""}\n  export const temp = \`${c}\`;`;let u="";l&&(u=l.html.split(/;/g).map((e=>{const r=e.trim();return/^import[ \{'"]/.test(r)?e.replace(/['"]([\s\S]+)['"]/,((e,r)=>`"${st(r,t)}"`)):e})).join(";"));const d=`${h};\n${u}`;let f="";s&&(f=`//# sourceMappingURL=${await(async(e,t,r)=>{const n=t.split("\n");let s="";for(let e=0;e<=r;e++)s+=";";const a=n.findIndex((e=>"<script>"===e.trim())),i=n.findIndex((e=>"<\/script>"===e.trim()));let o=0,l=0;for(let e=a+1;e<i;e++){const t=n[e];let r="";Array.from(t).forEach(((t,n)=>{const s=`AA${_t(e-o)}${_t(n-l)}`;r?r+=`,${s}`:r=s,o=e,l=n})),s+=`${r};`}const c=JSON.stringify([t]).replace(/^\[/,"").replace(/\]$/,""),h=`{"version": 3,\n    "file": "${e.replace(/\?.+/,"").replace(/.+\/(.+?)/,"$1").replace(".html",".js")}",\n    "sources": ["${e.replace(/\?.+/,"")}"],\n    "sourcesContent":[${c}],\n    "mappings": "${s}"}`;return await ft(h,null)})(t,e,h.split("\n").length)}`);const p=`${d}\n${f}`,m=navigator.userAgent.includes("Firefox");return n=ft(p,"js",!m),pt.set(t,n),n}const gt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function _t(e){let t="",r=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{let e=31&r;r>>>=5,r>0&&(e|=32),t+=gt[e]}while(r>0);return t}const yt=Symbol("Page");Object.defineProperty(Ue,"PAGE",{value:yt}),et.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +page *>/.test(r)&&!n.includes("-ignore-temp")){try{const t=await mt(r,e.url);e.result=await et()(`${t} .mjs --real:${e.url}`)}catch(t){throw new Error(`Error loading Page module: ${e.url}\n ${t.stack}`,{cause:t})}e.resultContent=r}await t()})),et.use(["js","mjs"],(async(e,t)=>{const{result:r,url:n,realUrl:s}=e;if("object"!=typeof r||r.type!==yt)return void await t();const a=await bt(r,s||n);let i=a.temp;/<.+>/.test(i)||(i=i?st(i,n):n.replace(/\.m?js.*/,".html"),await(async(e,{self:t,desc:r,...n})=>{try{await e()}catch(e){const s=new Error(`${r}\n  ${e.stack}`,{cause:e});throw t.emit("error",{data:{error:s,...n}}),s}})((async()=>{a.temp=await fetch(i).then((e=>e.text()))}),{targetModule:"undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:document.currentScript&&document.currentScript.src||new URL("ofa.min.js",document.baseURI).href,desc:`${n} module request for ${i} template page failed`})),e.result=a,await t()})),setTimeout((()=>{Ue.register({tag:"o-page",attrs:{src:null},data:{pageIsReady:null},watch:{async src(e){if(!e)return;if(!e.startsWith("//")&&!/[a-z]+:\/\//.test(e))return e=st(e),void(this.src=e);if(this.__init_src){if(this.__init_src!==e)throw Error("A page that has already been initialized cannot be set with the src attribute");return}if(this.__init_src=e,this._defaults||this.attr("data-pause-init"))return;const t=await lt(e);if(this._defaults)return;const r=t.pop();if(t.forEach(((e,t)=>{const r=ct(e.src,e.defaults);if(this.parent)this.wrap(r);else{(this.__need_wraps||(this.__need_wraps=[])).push(r)}})),r.ISERROR===ot){const t=vt(e,r,this?.app?._module?.fail);this._renderDefault({type:yt,temp:t})}else this._renderDefault(r.defaults)}},attached(){const e=this.__need_wraps;e&&(e.forEach((e=>{this.wrap(e)})),delete this.__need_wraps),this.__not_run_attached&&(this._defaults.attached&&this._defaults.attached.call(this),delete this.__not_run_attached)},detached(){const{_defaults:e}=this;e&&e.detached&&e.detached.call(this)},proto:{async _renderDefault(e){const{src:t}=this;if(this._defaults)throw new Error("The current page has already been rendered");if(this._defaults=e,e.pageAnime&&(this._pageAnime=e.pageAnime),!e||e.type!==yt){const e=new Error(`The currently loaded module is not a page \nLoaded string => '${t}'`);throw this.emit("error",{data:{error:e}}),this.__reject(e),e}const r=document.createElement("template");r.innerHTML=it(e.temp,t);const n=Z(r);try{Ee({defaults:e,ele:this.ele,template:r,temps:n})}catch(e){const r=new Error(`Failed to render page:${t} \n ${e.stack}`,{cause:e});console.error(r)}await wt(this,e.loaded),dt(this.shadow),this.emit("page-loaded"),this.__resolve(),this.pageIsReady=1;const{app:s}=this;s&&!s.appIsReady&&l((()=>{s.appIsReady=1})),this.ele.isConnected?e.attached&&e.attached.call(this):this.__not_run_attached=1},back(){this.app.back()},goto(e){this.app.goto(st(e,this.src))},replace(e){this.app.replace(st(e,this.src))},get pageAnime(){const{app:e,_pageAnime:t}=this,{pageAnime:r}=e?._module||{};return n={...r,...t||{}},JSON.parse(JSON.stringify(n));var n},set pageAnime(e){this._pageAnime=e}},ready(){this._rendered=new Promise(((e,t)=>{this.__resolve=()=>{delete this.__resolve,delete this.__reject,e()},this.__reject=()=>{delete this.__resolve,delete this.__reject,t()}}))}})}));const wt=async(e,t)=>{const r=e.ele.shadowRoot;if(r){const e=_(r,"l-m,load-module").map((e=>new Promise((t=>{e.addEventListener("load",(e=>{t()}))}))));_(r,"link").forEach((t=>{"stylesheet"===t.rel&&e.push(new Promise((e=>{let r=()=>{clearInterval(n),t.removeEventListener("load",r),t.removeEventListener("error",r),e()};const n=setInterval((()=>{t.parentNode||r()}),100);t.sheet?r():(t.addEventListener("load",r),t.addEventListener("error",r))})))})),await Promise.all(e)}t&&t.call(e)},bt=async(e,t)=>{let r={};const{default:n}=e,s=et({url:t});d(n)?r=await n({load:s,url:t,get query(){const e=new URL(t);return Object.fromEntries(Array.from(e.searchParams.entries()))}}):n instanceof Object&&(r={...n});return{proto:{},...e,...r}},vt=(e,t,r)=>{let n;return n=r?r({src:e,error:t.error}):`<div style="padding:20px;color:red;">${t.error.stack.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;")}</div>`,n},Et=Symbol("Component"),kt=Symbol("PATH");Object.defineProperty(Ue,"COMP",{value:Et});const xt={};et.use(["html","htm"],(async(e,t)=>{const{result:r,params:n}=e;if(r&&/<template +component *>/.test(r)&&!n.includes("-ignore-temp")){try{const t=await mt(r,e.url,!1);e.result=await et()(`${t} .mjs --real:${e.url}`)}catch(t){throw new Error(`Error loading Component module: ${e.url}\n ${t.toString()}`,{cause:t})}e.resultContent=r}await t()})),et.use(["js","mjs"],(async(e,t)=>{const{result:r,url:n,realUrl:s}=e;if("object"!=typeof r||r.type!==Et)return void t();let a={};const{default:i}=r,o=s||n;d(i)?a=await i({load:et({url:o})}):i instanceof Object&&(a={...i});const{tag:l,temp:c}={...r,...a};let h=l;const u=o.match(/\/([^/]+)\.m?(js|htm|html)$/);h||u&&(h=p(u[1]));const f=xt[h];if(f){if(o!==f)throw new Error(`${h} components have been registered`);return void await t()}xt[h]=o;let m,g="";/<.+>/.test(c)?(m=o,g=c):""!==c&&(m=st(c||`${u[1]}.html`,o),g=await fetch(m).then((e=>e.text())));const _={...r,...a},y=_.ready,{loaded:w}=_;_.ready=async function(...e){y&&y.apply(this,e),w&&wt(this,w),this.shadow&&dt(this.shadow)};const b=_.created;_.created=function(...e){this[kt]=o,b&&b.call(this,...e)};const v=it(g,o||m);Ue.register({..._,tag:h,temp:v}),await t()}));const $t="_history",Tt=async({src:e,app:t})=>{const{loading:r,fail:n}=t._module||{};let s;if(r){if(s=Ie(r()),!s){const e="loading function returns no content";throw console.log(e,":",r),new Error(e)}t.push(s)}const a=[];{const{current:e}=t;if(e){a.push(e);for(let t of e.parents){if("o-page"!==t.tag)break;a.unshift(t)}}}const i=await lt(e);let o=t;const l=[],c=[];let h,u,d,f=!0;return i.forEach(((e,t)=>{const r=a[t];if(f){if(!r||r.src!==e.src)return f=!1,c.push(e),void(h=r);l.push(r),o=r}else c.push(e)})),a.length>i.length&&!h&&a.some(((e,t)=>{const r=i[t];if(!r||r.src!==e.src)return h=e,!0})),c.forEach((e=>{const{ISERROR:t}=e;let r;if(t){const t=vt(e.src,e,n);r=ct(e.src,{type:Ue.PAGE,temp:t})}else r=ct(e.src,e.defaults);if(u){if(!d)return u.push(r),void(d=r);d.push(r),d=r}else u=r})),u&&o.push(u),s&&s.remove(),{current:u,old:h,publics:l}},At=(e,t,r)=>{if(t&&t.length){const{current:n}=e;t.forEach((e=>{const{routerChange:t}=e._defaults;t&&t.call(e,{type:r,current:n})}))}};Ue.register({tag:"o-app",temp:"<style>:host{position:relative;display:block}::slotted(*){display:block;width:100%;height:100%;}</style><slot></slot>",attrs:{src:null},data:{[$t]:[],appIsReady:null},watch:{async src(e){if(this.__init_src){if(this.__init_src!==e)throw new Error("The App that has already been initialized cannot be set with the src attribute");return}if(!e)return;this.__init_src=e;let t=e;!e||e.startsWith("//")||/[a-z]+:\/\//.test(e)||(t=st(e));const r=lm(),n=await r(t),s=await bt(n,t);if(this._module=s,this.extend(s.proto),s.ready&&s.ready.call(this),!this._settedRouters&&!this.$("o-page")&&!this._initHome&&s.home){const e=new URL(s.home,t).href;this.push(`<o-page src="${e}"></o-page>`)}}},proto:{async back(e=1){if(!this[$t].length)return void console.warn("It's already the first page, can't go back");const{_noanime:t}=this;e=e<this[$t].length?e:this[$t].length;const r=this[$t].splice(-e)[0];let{current:n,old:s,publics:a}=await Tt({src:r.src,app:this});!t&&n&&await Ot({page:n,key:"previous"}),s&&(s=Mt(s)),this.emit("router-change",{data:{name:"back",delta:e}}),At(this,a,"back"),!t&&s&&await St({page:s,key:"next"}),s&&s.remove()},async _navigate({type:e,src:t}){const{_noanime:r}=this,{current:n}=this;t=st(t),jt(this,t),n||(this._initHome=t);let{current:s,old:a,publics:i}=await Tt({src:t,app:this});s&&(!r&&s&&await Ot({page:s,key:"next"}),a&&(a=Mt(a)),"goto"===e&&n&&this[$t].push({src:n.src}),this.emit("router-change",{data:{name:e,src:t}}),At(this,i,e),n&&a&&(r||await St({page:a,key:"previous"}),a.remove()))},goto(e){return this._navigate({type:"goto",src:e})},replace(e){return this._navigate({type:"replace",src:e})},get current(){return this.all("o-page").reverse().find((e=>{let t=e;for(;"o-page"===t.tag;){if(t.data.willRemoved)return!1;t=t.parent}return!0}))},get routers(){let{current:e}=this;if(!e)return[];return[...this[$t],{src:e.src}]},set routers(e){e=e.map((e=>(jt(this,e.src),{src:e.src}))),this._settedRouters=1,this.html="";const t=e.slice(),r=t.pop();this[$t].length=0,this[$t].push(...t),this.push({tag:"o-page",src:r.src})}}});const jt=(e,t)=>{const r=e?._module?.access;if(new URL(t).origin!==location.origin&&!r){const t="To jump across domains, the access function must be set";throw console.log(t,e.ele,e?._module),new Error(t)}if(r){const e=r(t);if(!0!==e){if(e instanceof Error)throw e;throw new Error(`Access to current address is not allowed: ${t}`)}}},Ot=async({page:e,key:t})=>{e._rendered||await ht(e);const{pageAnime:r}=e,n=r[t];n&&(e.css={...e.css,...n},Lt((()=>{e.css={...e.css,transition:"all ease .3s",...r.current||{}}})))},St=({page:e,key:t})=>new Promise((r=>{const n=e.pageAnime[t];n?Lt((()=>{e.one("transitionend",r),e.css={...e.css,transition:"all ease .3s",...n}})):r()})),Lt=e=>requestAnimationFrame((()=>{setTimeout(e,5)})),Mt=e=>(e.css={position:"absolute",width:`${e.width}px`,height:`${e.height}px`},e.data.willRemoved=1,e),Nt=Ue.fn.attr;function Rt(...e){let[t,r,n]=e;d(r)&&(r=r());const{host:s}=this;if(s&&["href","src"].includes(t)&&/^\./.test(r)){const{PATH:e}=s;if(e){const{href:n}=new URL(r,e);return Nt.call(this,t,n)}}return Nt.call(this,...e)}Rt.always=Nt.always,Ue.fn.extend({get app(){let e=this;for(;e&&"o-app"!==e;){if("o-page"===e.tag){const t=e.parents.find((e=>"o-app"===e.tag));if(t){e=t;break}}if(e=e.host,!e)break}return e},get PATH(){return this[kt]||this.src||null},attr:Rt});return Ue.version="ofa.js@4.4.16".replace("ofa.js@",""),document.currentScript&&Object.defineProperty(Ue,"debugMode",{get:()=>s.value}),"undefined"!=typeof window&&(window.$=Ue),Object.defineProperty(globalThis,"ofa",{value:Ue}),Ue}));
//# sourceMappingURL=ofa.min.js.map
